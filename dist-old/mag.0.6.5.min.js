/*
* MagnumJS - By Michael Glazer April 2015
* https://github.com/magnumjs/mag.js
*/
!function(e,t,n,r){function o(e){if(""!==e.id)return'id("'+e.id+'")';if(e===n.body)return e.tagName;for(var t=0,r=e.parentNode.childNodes,i=0;i<r.length;i++){var a=r[i];if(a===e)return o(e.parentNode)+"/"+e.tagName+"["+(t+1)+"]";1===a.nodeType&&a.tagName===e.tagName&&t++}}function i(e,t,n){var r,c,u;if(e){null==t&&(t={_text:""});var s=l(e);if(u="[object Array]"===Object.prototype.toString.call(t)){if(p[n]&&0===s.length&&(p[n].parent.insertAdjacentHTML("beforeend",p[n].node),s=l(p[n].parent.children)),0===s.length)return;for(c=s[0].parentNode,p[n]||(p[n]={node:s[0].cloneNode(!0).outerHTML,parent:c});s.length<t.length;)p[n]?(c.insertAdjacentHTML("beforeend",p[n].node),r=c.lastChild):r=s[0].cloneNode(!0),s.push(r),c&&c.appendChild(r);for(;s.length>t.length;)r=s.pop(),(c=r.parentNode)&&c.removeChild(r)}for(n=0;n<s.length;n++)r=o(s[n]),u?!s[n]||d[r]&&d[r]===JSON.stringify(t[n])||(i(s[n],t[n]),d[r]=JSON.stringify(t[n])):a(s[n],t);return e}}function a(e,t){var n;if("function"!=typeof t){if("object"!=typeof t)return a(e,{_text:t});for(var l in t){var u=t[l];u===r&&(u=""),"_"===l[0]&&(n=n||{},n[l.substr(1)]=u)}var s=o(e);if(n){if(d[s]&&d[s]===JSON.stringify(n))return;c(e,n),d[s]=JSON.stringify(n)}var h=0;for(l in t)if(u=t[l],"_"!==l[0]){if(n=f(e,l),"function"==typeof u&&"fun"==u.type)try{u=u()}catch(p){}i(n,u,s),h++}}}function l(e){var t;if(null==e.length&&(e=[e]),"[object Array]"!==Object.prototype.toString.call(e)){t=[];for(var n=0;n<e.length;n+=1)e[n]&&t.push(e[n]);e=t}return e}function c(n,r){u(n,r.text),s(n,r.html),n._events=n._events||[];for(var o in r)if("text"!==o&&"html"!==o)if(0==o.indexOf("on")){if(-1===n._events.indexOf(o)){var i=function(t,n,r){t.call(n,r),e.redraw()}.bind(null,r[o],n);n.addEventListener(o.substr(2),i),n._events.push(o)}}else"config"==o?t.push(function(e,t){return function(){return e.apply(e,t)}}(r[o],[n,!0])):null===r[o]?n.removeAttribute(o):n.setAttribute(o,""+r[o])}function u(e,t){var n,r;if(e&&null!=t){if(!r){r=[];for(var o=0;o<e.childNodes.length;o+=1)n=e.childNodes[o],n.nodeType===h&&r.push(n)}for(;e.firstChild;)e.removeChild(e.firstChild);for("input"===e.nodeName.toLowerCase()?e.setAttribute("value",""+t):e.appendChild(e.ownerDocument.createTextNode(""+t)),o=0;o<r.length;o+=1)e.appendChild(r[o])}}function s(e,t){e&&null!=t&&(e.innerHTML=t)}function f(e,t,n){for(var r=e.childNodes,o=[],i=0;i<r.length;i+=1)r[i].nodeType===h&&o.push(r[i]);if(r=[],i=t,!(e.queryCache||{})[t]){e.queryCache=(e.queryCache||{})[t]=[];var a="$"===t[0];"$"===i[0]&&(i=i.substr(1));for(var l=0;l<o.length;l+=1){var c=o[l],u=i,s=" "+c.className+" ";(c.id===u||-1<s.indexOf(" "+u+" ")||c.name===u||c.nodeName.toLowerCase()===u.toLowerCase()||c.getAttribute("data-bind")===u)&&r.push(o[l])}if(!r.length||a)for(l=0;l<o.length&&(r=r.concat(f(o[l],t,!0)),!r.length||a);l++);!n&&!r.length,e.queryCache[t]=r}return e.queryCache[t]}var h=1,d=[],p={},d=[];e.fill={fill:i,configs:t},window.mag=e}(window.mag||{},[],document),function(e){function t(){_=null;for(var e=0;e<b.length;e++)b[e]();b.length=0}var n={noMore:!1,useDirtyCheck:!1},r=[],o=[],i=[],a=!1;try{a=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(l){}var c=function(e){var t={};return e&&"[object Function]"==t.toString.call(e)},u=function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=function(e){return"[object Object]"==={}.toString.apply(e)},f=function(e){if(null==e||"object"!=typeof e)return e;var t,n=e.constructor();for(t in e)n[t]=e[t];return n},h=function(e,t,n,r){try{Object.observe(e,function(e){e.forEach(function(e){e.name===t&&r(e.object[e.name])})})}catch(o){try{Object.defineProperty(e,t,{get:n,set:function(e){r.call(this,e,!0)},enumerable:!0,configurable:!0})}catch(i){try{Object.prototype.__defineGetter__.call(e,t,n),Object.prototype.__defineSetter__.call(e,t,function(e){r.call(this,e,!0)})}catch(a){p(e,t,r)}}}},d=function(e,t,n){try{Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!1,value:n})}catch(r){e[t]=n}},p=function(e,t,n){o[o.length]={prop:t,object:e,orig:f(e[t]),callback:n}},g=function(e,t,n,r){if("string"!=typeof e&&(e instanceof Object||u(e))){if(u(e)){if(C(e,"__watchall__",t,n),void 0===n||n>0)for(var o=0;o<e.length;o++)g(e[o],t,n,r)}else{var i=[];for(o in e)"$val"==o||!a&&"watchers"===o||Object.prototype.hasOwnProperty.call(e,o)&&i.push(o);v(e,i,t,n,r)}r&&q(e,"$$watchlengthsubjectroot",t,n)}},v=function(e,t,n,r,o){if("string"!=typeof e&&(e instanceof Object||u(e)))for(var i=0;i<t.length;i++)w(e,t[i],n,r,o)},w=function(e,t,n,r,o){"string"!=typeof e&&(e instanceof Object||u(e))&&(c(e[t])||(null==e[t]||void 0!==r&&0>=r||g(e[t],n,void 0!==r?r-1:r),C(e,t,n,r),o&&(void 0===r||r>0)&&q(e,t,n,r)))},m=function(e,t){if(!(e instanceof String)&&(e instanceof Object||u(e)))if(u(e)){for(var n=["__watchall__"],r=0;r<e.length;r++)n.push(r);y(e,n,t)}else{var o=function(e){var n,r=[];for(n in e)e.hasOwnProperty(n)&&(e[n]instanceof Object?o(e[n]):r.push(n));y(e,r,t)};o(e)}},y=function(e,t,n){for(var r in t)t.hasOwnProperty(r)&&$(e,t[r],n)},b=[],_=null,j=function(e){null==_&&(_||(_=setTimeout(t))),b[b.length]=e},O=function(e,n,r,o){var i=null,a=-1,l=u(e);g(e,function(r,o,c,u){var s=(_||(_=setTimeout(t)),_);if(a!==s&&(a=s,i={type:"update"},i.value=e,i.splices=null,j(function(){n.call(this,i),i=null})),l&&e===this&&null!==i){if("pop"===o||"shift"===o)c=[],u=[u];else if("push"===o||"unshift"===o)c=[c],u=[];else if("splice"!==o)return;i.splices||(i.splices=[]),i.splices[i.splices.length]={index:r,deleteCount:u?u.length:0,addedCount:c?c.length:0,added:c,deleted:u}}},1==r?void 0:0,o)},N=function(e,t,n,r,o){e&&t&&(w(e,t,function(e,t,i,a){e={type:"update"},e.value=i,e.oldvalue=a,(r&&s(i)||u(i))&&O(i,n,r,o),n.call(this,e)},0),(r&&s(e[t])||u(e[t]))&&O(e[t],n,r,o))},C=function(e,t,r,o){var i=!1,a=u(e);for(e.watchers||(d(e,"watchers",{}),a&&L(e,function(n,r,i,a){if(k(e,n,r,i,a),0!==o&&i&&(s(i)||u(i))){var l,c;for(n=e.watchers[t],(l=e.watchers.__watchall__)&&(n=n?n.concat(l):l),c=n?n.length:0,l=0;c>l;l++)if("splice"!==r)g(i,n[l],void 0===o?o:o-1);else for(a=0;a<i.length;a++)g(i[a],n[l],void 0===o?o:o-1)}})),e.watchers[t]||(e.watchers[t]=[],a||(i=!0)),a=0;a<e.watchers[t].length;a++)if(e.watchers[t][a]===r)return;if(e.watchers[t].push(r),i){var l=e[t];r=function(){return l},i=function(r,i){var a=l;if(l=r,0!==o&&e[t]&&(s(e[t])||u(e[t]))&&!e[t].watchers){var c,f=e.watchers[t].length;for(c=0;f>c;c++)g(e[t],e.watchers[t][c],void 0===o?o:o-1)}return e.watchers&&(e.watchers.__wjs_suspend__||e.watchers["__wjs_suspend__"+t])?void x(e,t):void(n.noMore||a!==r&&(i?k(e,t,"set",r,a):A(e,t,"set",r,a),n.noMore=!1))},n.useDirtyCheck?p(e,t,i):h(e,t,r,i)}},A=function(e,t,n,r,o){if(void 0!==t){var i,a=e.watchers[t];(i=e.watchers.__watchall__)&&(a=a?a.concat(i):i),i=a?a.length:0;for(var l=0;i>l;l++)a[l].call(e,t,n,r,o)}else for(t in e)e.hasOwnProperty(t)&&A(e,t,n,r,o)},S="pop push reverse shift sort slice unshift splice".split(" "),T=function(e,t,n,r){d(e,n,function(){var o,i,a,l;if(o=0,"splice"===n){var c=arguments[0];for(a=e.slice(c,c+arguments[1]),i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];o=c}else i=0<arguments.length?arguments[0]:void 0;return l=t.apply(e,arguments),"slice"!==n&&("pop"===n?(a=l,o=e.length):"push"===n?o=e.length-1:"shift"===n?a=l:"unshift"!==n&&void 0===i&&(i=l),r.call(e,o,n,i,a)),l})},L=function(e,t){if(c(t)&&e&&!(e instanceof String)&&u(e))for(var n,r=S.length;r--;)n=S[r],T(e,e[n],n,t)},$=function(e,t,n){if(e.watchers[t])if(void 0===n)delete e.watchers[t];else for(var i=0;i<e.watchers[t].length;i++)e.watchers[t][i]==n&&e.watchers[t].splice(i,1);for(i=0;i<r.length;i++){var a=r[i];a.obj==e&&a.prop==t&&a.watcher==n&&r.splice(i,1)}for(n=0;n<o.length;n++)i=o[n],a=i.object.watchers,(i=i.object==e&&i.prop==t&&a&&(!a[t]||0==a[t].length))&&o.splice(n,1)},x=function(e,t){j(function(){delete e.watchers.__wjs_suspend__,delete e.watchers["__wjs_suspend__"+t]})},P=null,k=function(e,t,n,r,o){i[i.length]={obj:e,prop:t,mode:n,newval:r,oldval:o},null===P&&(P=setTimeout(J))},J=function(){var e=null;P=null;for(var t=0;t<i.length;t++)e=i[t],A(e.obj,e.prop,e.mode,e.newval,e.oldval);e&&(i=[])},q=function(e,t,n,o){var i;i=f("$$watchlengthsubjectroot"===t?e:e[t]),r.push({obj:e,prop:t,actual:i,watcher:n,level:o})};n.watch=function(){c(arguments[1])?g.apply(this,arguments):u(arguments[1])?v.apply(this,arguments):w.apply(this,arguments)},n.unwatch=function(){c(arguments[1])?m.apply(this,arguments):u(arguments[1])?y.apply(this,arguments):$.apply(this,arguments)},n.callWatchers=A,n.suspend=function(e,t){e.watchers&&(e.watchers["__wjs_suspend__"+(void 0!==t?t:"")]=!0)},n.onChange=function(){(c(arguments[2])?N:O).apply(this,arguments)},e.watch=n}(window.mag||{}),function(e){var t={modules:[],controllers:[],elements:[],submodule:function(e,t){var n=function(t){return(e.controller||function(){}).apply(this,t)}.bind({},t);return n.$original=e.controller,n={controller:n,view:function(n){1<arguments.length&&(t=t.concat([].slice.call(arguments,1)));var r=e.view.apply(e,t?[n].concat(t):[n]);return t[0]&&null!=t[0].key&&(r.attrs.key=t[0].key),r}},t[0]&&null!=t[0].key&&(n.attrs={key:t[0].key}),n},getArgs:function(e){return t.modules[e].controller&&t.modules[e].controller.$$args?[t.controllers[e]].concat(t.modules[e].controller.$$args):[t.controllers[e]]}};e.mod=t}(window.mag||{}),function(e){var t={roots:[],templates:{},cache:{},callOnload:function(e){for(var t,n=0;t=e.controllers[n];n++)t.onload&&!t.called&&(t.onload.call(null,e.elements[n]),t.called=1)},callConfigs:function(e){for(var t=0,n=e.length;n>t;t++)e[t]()}},n=[];t.redraw=function(e,n,r){e=e||t.module||{},this.fun||(this.fun=i(function(){n.configs.splice(0,n.configs.length),t.doLoop(e,n,r)})),this.fun()},t.doLoop=function(n,r,o){for(var i=0;t.roots[i];i++)e.running=!0,!n.controllers[i]||t.innerLoop(n,r,i,o)},t.innerLoop=function(e,r,o,i){var a=e.elements[o],l=e.getArgs(o);return n[o]&&n[o]===JSON.stringify(l[0])?e=!1:((e.getArgs(o),e.modules[o]).view(a,e.controllers[o]),n[o]=JSON.stringify(l[0]),t.setupWatch(i,l,r,a,o,e),r.fill(a,l[0]),e=void t.callConfigs(r.configs)),e},t.doWatch=function(r,o,i,a){e.running=!0;var l=a.getArgs(i);n[i]&&n[i]===JSON.stringify(l[0])||((a.getArgs(i),a.modules[i]).view(o,a.controllers[i]),n[i]=JSON.stringify(l[0]),r.fill(o,l[0]),t.callConfigs(r.configs),t.callOnload(a),e.running=!1)},t.setupWatch=function(e,n,r,o,a,l){e.watch(n[0],i(t.doWatch.bind(null,r,o,a,l)))};var r=window.cancelAnimationFrame||window.clearTimeout,o=window.requestAnimationFrame||window.setTimeout,i=function(e,t){var n,i,a=t||16;return function(){+new Date-n>a||o===window.requestAnimationFrame?(i>0&&r(i),i=o(function(){n=+new Date,e.apply(this,arguments)},a)):(n=+new Date,e.apply(this,arguments))}};e.render=t}(window.mag||{}),function(e,t){var n,r={},o=e.mod,i=e.render,a=e.fill,l=e.watch;e.running=!1,r.init=function(){};var c=!1;r.redraw=function(){c||(c=!0,i.redraw(o||i.module||{},a,l),c=!1)},r.withProp=function(e,t){return function(n){n=n||event,n=n.currentTarget||this,t(e in n?n[e]:n.getAttribute(e))}},r.prop=function(e){var t=function(){return arguments.length&&(e=arguments[0],r.redraw()),e};return t.type="fun",t.toJSON=function(){return e},t},r.module=function(a,l,c){var u=i.roots.indexOf(a);if(0>u&&(u=i.roots.length),a=t.getElementById(a),!a)return Error("invalid node");var s=a.parentNode,f=t.createElement("span");if(s.replaceChild(f,a),i.roots[u]=a.id,!l.view)return Error("module requires a view");c=n=l=(l=o.submodule(l,[c||{}]))||{};var h=new l.controller;return c===n&&(o.controllers[u]=h,o.modules[u]=l,o.elements[u]=a),r.redraw(),s.replaceChild(a,f),h.onload&&!e.running&&i.callOnload(o),{_html:a.innerHTML}};var u=function(e){return function(){return r[e].apply(this,arguments)}},s=u("init");s.module=u("module"),s.prop=u("prop"),s.redraw=u("redraw"),s.withProp=u("withProp");for(var f in s)e[f]=s[f]}(window.mag||{},document);

/*
* MagnumJS - By Michael Glazer March 2015
* https://github.com/magnumjs/mag.js
*/
var mag=function(e,t,n){function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(e){"function"==typeof a.logger&&a.logger(e)}function a(e,t,n,o){var l,u,s;if(e){null==t&&(t={_text:""});var f=c(e);if(s=r(t)){if(0===f.length)return;u=f[0].parentNode;var h=document.createDocumentFragment();for(f[0].setAttribute("data-clone",n+o);f.length-1<t.length;)l=f[0].cloneNode(!0),l.removeAttribute("data-clone"),f.push(l),u&&h.appendChild(l);for(;f.length>t.length+1;)l=f.pop(),u=l.parentNode,u&&h.removeChild(l);u&&u.appendChild(h)}for(var p=0;p<f.length;p++)s?f[p+1]&&a(f[p+1],t[p]):i(f[p],t);return e}}function i(e,t){var r,o;if("function"!=typeof t){if("object"!=typeof t)return i(e,{_text:t});for(var c in t){var u=t[c];u===n&&(u=""),"_"===c[0]&&(r=r||{},r[c.substr(1)]=u)}r&&l(e,r);var s=0;for(var c in t){var u=t[c];if("_"!==c[0]){if(o=f(e,c),"function"==typeof u&&"fun"==u.type)try{u=u()}catch(h){}a(o,u,c,s),s++}}}}function c(e){var t;if(null==e.length&&(e=[e]),!r(e)){t=[];for(var n=0;n<e.length;n+=1)e[n]&&t.push(e[n]);e=t}return e}function l(e,n){u(e,n.text),s(e,n.html),e._events=e._events||[];for(var r in n)if("text"!==r&&"html"!==r)if(0==r.indexOf("on")){if(-1!==e._events.indexOf(r))continue;e.addEventListener(r.substr(2),n[r]),e._events.push(r)}else{if("config"==r){var o=!0,a=function(e,t){return function(){return e.apply(e,t)}};t.push(a(n[r],[e,o]));continue}null===n[r]?e.removeAttribute(r):e.setAttribute(r,""+n[r])}}function u(e,t){var n,r;if(e&&null!=t){if(!r){r=[];for(var o=0;o<e.childNodes.length;o+=1)n=e.childNodes[o],n.nodeType===v&&r.push(n)}for(;e.firstChild;)e.removeChild(e.firstChild);"input"===e.nodeName.toLowerCase()?e.setAttribute("value",""+t):e.appendChild(e.ownerDocument.createTextNode(""+t));for(var o=0;o<r.length;o+=1)e.appendChild(r[o])}}function s(e,t){e&&null!=t&&(e.innerHTML=t)}function f(e,t,n){var r=h(e),a=[],i=t;if(!(e.queryCache||{})[t]){e.queryCache=(e.queryCache||{})[t]=[];var c="$"===t[0];"$"===i[0]&&(i=i.substr(1));for(var l=0;l<r.length;l+=1)p(r[l],i)&&a.push(r[l]);if(!a.length||c)for(var l=0;l<r.length&&(a=a.concat(f(r[l],t,!0)),!a.length||c);l++);n||a.length||o('FILL - Warning: no matches found for "'+t+'"'),e.queryCache[t]=a}return e.queryCache[t]}function h(e){for(var t=e.childNodes,n=[],r=0;r<t.length;r+=1)t[r].nodeType===v&&n.push(t[r]);return n}function p(e,t){var n=" "+e.className+" ";return e.id===t||n.indexOf(" "+t+" ")>-1||e.name===t||e.nodeName.toLowerCase()===t.toLowerCase()||e.getAttribute("data-bind")===t}var v=1;return e.fill={fill:a,configs:t},e}(window.mag||{},[]),mag=function(e){function t(){O=null;for(var e=0;e<j.length;e++)j[e]();j.length=0}var n={noMore:!1,useDirtyCheck:!1},r=[],o=[],a=[],i=!1;try{i=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(c){}var l=function(e){var t={};return e&&"[object Function]"==t.toString.call(e)},u=function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=function(e){return"[object Object]"==={}.toString.apply(e)},f=function(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)t[n]=e[n];return t},h=function(e,t,n,r){try{Object.observe(e,function(e){e.forEach(function(e){e.name===t&&r(e.object[e.name])})})}catch(o){try{Object.defineProperty(e,t,{get:n,set:function(e){r.call(this,e,!0)},enumerable:!0,configurable:!0})}catch(a){try{Object.prototype.__defineGetter__.call(e,t,n),Object.prototype.__defineSetter__.call(e,t,function(e){r.call(this,e,!0)})}catch(i){v(e,t,r)}}}},p=function(e,t,n){try{Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!1,value:n})}catch(r){e[t]=n}},v=function(e,t,n){o[o.length]={prop:t,object:e,orig:f(e[t]),callback:n}},g=function(){l(arguments[1])?d.apply(this,arguments):u(arguments[1])?w.apply(this,arguments):m.apply(this,arguments)},d=function(e,t,n,r){if("string"!=typeof e&&(e instanceof Object||u(e))){if(u(e)){if($(e,"__watchall__",t,n),void 0===n||n>0)for(var o=0;o<e.length;o++)d(e[o],t,n,r)}else{var o,a=[];for(o in e)"$val"==o||!i&&"watchers"===o||Object.prototype.hasOwnProperty.call(e,o)&&a.push(o);w(e,a,t,n,r)}r&&I(e,"$$watchlengthsubjectroot",t,n)}},w=function(e,t,n,r,o){if("string"!=typeof e&&(e instanceof Object||u(e)))for(var a=0;a<t.length;a++){var i=t[a];m(e,i,n,r,o)}},m=function(e,t,n,r,o){"string"!=typeof e&&(e instanceof Object||u(e))&&(l(e[t])||(null==e[t]||void 0!==r&&0>=r||d(e[t],n,void 0!==r?r-1:r),$(e,t,n,r),o&&(void 0===r||r>0)&&I(e,t,n,r)))},y=function(){l(arguments[1])?_.apply(this,arguments):u(arguments[1])?b.apply(this,arguments):M.apply(this,arguments)},_=function(e,t){if(!(e instanceof String)&&(e instanceof Object||u(e)))if(u(e)){for(var n=["__watchall__"],r=0;r<e.length;r++)n.push(r);b(e,n,t)}else{var o=function(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&(e[r]instanceof Object?o(e[r]):n.push(r));b(e,n,t)};o(e)}},b=function(e,t,n){for(var r in t)t.hasOwnProperty(r)&&M(e,t[r],n)},j=[],O=null,C=function(){return O||(O=setTimeout(t)),O},N=function(e){null==O&&C(),j[j.length]=e},A=function(){var e=l(arguments[2])?x:S;e.apply(this,arguments)},S=function(e,t,n,r){var o,a=null,i=-1,c=u(e),l=function(n,r,o,l){var u=C();if(i!==u&&(i=u,a={type:"update"},a.value=e,a.splices=null,N(function(){t.call(this,a),a=null})),c&&e===this&&null!==a){if("pop"===r||"shift"===r)o=[],l=[l];else if("push"===r||"unshift"===r)o=[o],l=[];else if("splice"!==r)return;a.splices||(a.splices=[]),a.splices[a.splices.length]={index:n,deleteCount:l?l.length:0,addedCount:o?o.length:0,added:o,deleted:l}}};o=1==n?void 0:0,d(e,l,o,r)},x=function(e,t,n,r,o){e&&t&&(m(e,t,function(e,t,a,i){var c={type:"update"};c.value=a,c.oldvalue=i,(r&&s(a)||u(a))&&S(a,n,r,o),n.call(this,c)},0),(r&&s(e[t])||u(e[t]))&&S(e[t],n,r,o))},$=function(e,t,r,o){var a=!1,i=u(e);e.watchers||(p(e,"watchers",{}),i&&T(e,function(n,r,a,i){if(E(e,n,r,a,i),0!==o&&a&&(s(a)||u(a))){var c,l,f,h,p=e.watchers[t];for((h=e.watchers.__watchall__)&&(p=p?p.concat(h):h),f=p?p.length:0,c=0;f>c;c++)if("splice"!==r)d(a,p[c],void 0===o?o:o-1);else for(l=0;l<a.length;l++)d(a[l],p[c],void 0===o?o:o-1)}})),e.watchers[t]||(e.watchers[t]=[],i||(a=!0));for(var c=0;c<e.watchers[t].length;c++)if(e.watchers[t][c]===r)return;if(e.watchers[t].push(r),a){var l=e[t],f=function(){return l},g=function(r,a){var i=l;if(l=r,0!==o&&e[t]&&(s(e[t])||u(e[t]))&&!e[t].watchers){var c,f=e.watchers[t].length;for(c=0;f>c;c++)d(e[t],e.watchers[t][c],void 0===o?o:o-1)}return D(e,t)?void F(e,t):void(n.noMore||i!==r&&(a?E(e,t,"set",r,i):L(e,t,"set",r,i),n.noMore=!1))};n.useDirtyCheck?v(e,t,g):h(e,t,f,g)}},L=function(e,t,n,r,o){if(void 0!==t){var a,i,c=e.watchers[t];(i=e.watchers.__watchall__)&&(c=c?c.concat(i):i),a=c?c.length:0;for(var l=0;a>l;l++)c[l].call(e,t,n,r,o)}else for(var t in e)e.hasOwnProperty(t)&&L(e,t,n,r,o)},P=["pop","push","reverse","shift","sort","slice","unshift","splice"],k=function(e,t,n,r){p(e,n,function(){var o,a,i,c,l=0;if("splice"===n){var u=arguments[0],s=u+arguments[1];for(i=e.slice(u,s),a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];l=u}else a=arguments.length>0?arguments[0]:void 0;return c=t.apply(e,arguments),"slice"!==n&&("pop"===n?(i=c,l=e.length):"push"===n?l=e.length-1:"shift"===n?i=c:"unshift"!==n&&void 0===a&&(a=c),r.call(e,l,n,a,i)),c})},T=function(e,t){if(l(t)&&e&&!(e instanceof String)&&u(e))for(var n,r=P.length;r--;)n=P[r],k(e,e[n],n,t)},M=function(e,t,n){if(e.watchers[t])if(void 0===n)delete e.watchers[t];else for(var r=0;r<e.watchers[t].length;r++){var o=e.watchers[t][r];o==n&&e.watchers[t].splice(r,1)}H(e,t,n),G(e,t)},q=function(e,t){if(e.watchers){var n="__wjs_suspend__"+(void 0!==t?t:"");e.watchers[n]=!0}},D=function(e,t){return e.watchers&&(e.watchers.__wjs_suspend__||e.watchers["__wjs_suspend__"+t])},F=function(e,t){N(function(){delete e.watchers.__wjs_suspend__,delete e.watchers["__wjs_suspend__"+t]})},J=null,E=function(e,t,n,r,o){a[a.length]={obj:e,prop:t,mode:n,newval:r,oldval:o},null===J&&(J=setTimeout(W))},W=function(){var e=null;J=null;for(var t=0;t<a.length;t++)e=a[t],L(e.obj,e.prop,e.mode,e.newval,e.oldval);e&&(a=[],e=null)},I=function(e,t,n,o){var a;a=f("$$watchlengthsubjectroot"===t?e:e[t]),r.push({obj:e,prop:t,actual:a,watcher:n,level:o})},H=function(e,t,n){for(var o=0;o<r.length;o++){var a=r[o];a.obj==e&&a.prop==t&&a.watcher==n&&r.splice(o,1)}},G=function(e,t){for(var n,r=0;r<o.length;r++){var a=o[r],i=a.object.watchers;n=a.object==e&&a.prop==t&&i&&(!i[t]||0==i[t].length),n&&o.splice(r,1)}};return n.watch=g,n.unwatch=y,n.callWatchers=L,n.suspend=q,n.onChange=A,e.watch=n,e}(window.mag||{}),mag=function(e){var t={modules:[],controllers:[],elements:[]};return t.submodule=function(e,t){var n=function(t){return(e.controller||function(){}).apply(this,t)}.bind({},t),r=function(n){arguments.length>1&&(t=t.concat([].slice.call(arguments,1)));var r=e.view.apply(e,t?[n].concat(t):[n]);return t[0]&&null!=t[0].key&&(r.attrs.key=t[0].key),r};n.$original=e.controller;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o},t.getArgs=function(e){var n=t.modules[e].controller&&t.modules[e].controller.$$args?[t.controllers[e]].concat(t.modules[e].controller.$$args):[t.controllers[e]];return n},e.mod=t,e}(window.mag||{}),mag=function(e){function t(e,t,n){var r=(t.getArgs(n),t.modules[n]),o=t.controllers[n];r.view(e,o)}var n={roots:[],templates:{},cache:{}};n.callConfigs=function(){},n.redraw=function(e,r,o){e=e||n.module||{},console.time("Mag.JS:render"),this.fun||(this.fun=a(function(){for(var i,c,l=0;c=n.roots[l];l++)if(e.controllers[l]){var u=e.elements[l];t(u,e,l);var s=e.getArgs(l);o.watch(s[0],a(function(e,a,c){console.time("Mag.JS:re-render");var l=c.getArgs(a);i!==JSON.stringify(l[0])&&(t(e,c,a),r.fill(e,l[0]),o.noMore=!0,n.callConfigs(r.configs),i=JSON.stringify(l[0])),console.timeEnd("Mag.JS:re-render")}.bind(null,u,l,e))),r.fill(u,s[0]),n.callConfigs(r.configs),i=JSON.stringify(s[0])}console.timeEnd("MagnumJS:init"),console.timeEnd("Mag.JS:render")})),this.fun()};var r=window.cancelAnimationFrame||window.clearTimeout,o=window.requestAnimationFrame||window.setTimeout,a=function(e,t){var n,a,i=t||16;return function(){+new Date-n>i||o===window.requestAnimationFrame?(a>0&&r(a),a=o(function(){n=+new Date,e.apply(this,arguments)},i)):(n=+new Date,e.apply(this,arguments))}};return e.render=n,e}(window.mag||{});var mag=function(e,t){"use strict";var n={},r=e.mod,o=e.render,a=e.fill,i=mag.watch;n.init=function(){},n.redraw=function(){o.redraw(r||o.module||{},a,i)},n.prop=function(e){var t=function(){return arguments.length&&(e=arguments[0],n.redraw()),e};return t.type="fun",t.toJSON=function(){return JSON.parse(JSON.stringify(e))},t},n.module=function(e,a,i){console.time("MagnumJS:init");var c=o.roots.indexOf(e);0>c&&(c=o.roots.length);var l=t.getElementById(e);if(!l)throw Error("invalid node");var u=l.parentNode,s=l.cloneNode(!0),f=t.createElement("span");u.replaceChild(f,l);var h=r.submodule(a,[i]);o.roots[c]=e;var p=new h.controller;r.controllers[c]=p,r.modules[c]=h,r.elements[c]=s,n.redraw(),u.replaceChild(s,f),p.onload&&p.onload.call(null,s)};var c=function(e){return function(){return n[e].apply(this,arguments)}},l=c("init");return l.module=c("module"),l.prop=c("prop"),l.redraw=c("redraw"),l}(window.mag||{},document);

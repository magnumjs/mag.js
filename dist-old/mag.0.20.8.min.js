/*
Mag.JS v0.20.8
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(t,e,n){function i(t){if(u[t])return u[t];var n=e.getElementById(t);return n&&(u[t]=n),n}var r={attributes:[],elementMatcher:[]};t.create=function(e,n,i){return function(r,o){return"string"!=typeof r&&(o=r,r=0),t.module(r||e,n,t.utils.merge(i||{},o||{}))}},t.module=function(e,n,r){r=r||{};var o;if(!(o=!t.utils.items.isItem(e))){o=t.utils.items.getItem(e);var u=i(e);o=!t.utils.callLCEvent("onreload",t.mod.getState(o),u,o)}return o&&(o=r.key&&t.utils.items.isItem(e+"."+r.key)?t.utils.items.getItem(e+"."+r.key):t.utils.getItemInstanceId(r.key?e+"."+r.key:e),r.retain||t.mod.clear(o),t.mod.submodule(e,o,n,r),u=i(e),d(o,e),!t.utils.callLCEvent("willload",t.mod.getState(o),u,o,1))?(e=t.mod.getState(o),t.utils.unloaders[o]=t.utils.unloaders[o]||[],e.onunload&&t.utils.unloaders[o].push({controller:e,handler:e.onunload}),t.redraw(u,o,1),t.utils.callLCEvent("didload",t.mod.getState(o),u,o,1),a(o,u,n,t.utils.copyFun(r))):void 0};var o=function(e,n){return 0>n||n!=t.utils.items.getItem(e)?e==t.mod.getId(n)?!0:!1:!0};t.redraw=function(e,i,r){if(!e||n===i)throw Error("Mag.JS - Id or node invalid: "+e,i);o(e.id,i)&&(r&&t.fill.configs.splice(0,t.fill.configs.length),r&&t.mod.clear(i),e=c(e,i,r),fastdom.clear(t.mod.getFrameId(i)),e=fastdom.write(e),t.mod.setFrameId(i,e))},t.hookin=function(t,e,n){r[t].push({context:{},handler:n,key:e})},t.hook=function(e,n,i){for(var o=0,a=r[e].length;a>o;o++)t.utils.callHook(r,n,e,o,i)};var a=function(e,n,i,r){return i=function(e,n,i,r,o){return e=n.cloneNode(1),e.id=n.id+(r.key?"."+r.key:"")+"."+o,t.utils.items.isItem(e.id),n=t.utils.getItemInstanceId(e.id),t.mod.submodule(e.id,n,i,r),d(n,e.id),t.redraw(e,n,1),e}.bind({},e,n,i,r),i.getId=function(t){return t}.bind({},e),i.draw=function(e,n,i){t.redraw(e,n,i)}.bind({},n,e),i.getState=function(e){return t.mod.getState(e)}.bind({},e),i.getProps=function(e){return t.mod.getProps(e)}.bind({},e),i},u=[],d=function(e,n){var r=function(e,r){i(r)?t.redraw(i(r),e):t.utils.items.isItem(n)&&t.clear(e)}.bind({},e,n);t.props.setup(e,t.debounce(r))};t.clear=function(e){fastdom.clear(t.mod.getFrameId(e)),t.utils.items.removeItem(e),t.mod.clear(e),t.props.cached.splice(e,1),t.fill.clearCache(t.mod.getId(e))};var c=function(e,i,r){return function(e,i,r){if(o(e.id,i)&&e){var a=t.mod.getState(i);if(!t.utils.callLCEvent("isupdate",a,e,i)){var u=t.mod.getProps(i),u=t.utils.merge(t.utils.copy(u),t.utils.copy(a));if(t.mod.iscached(i,u)&&!r)e=0;else{if(!t.utils.callLCEvent("willupdate",a,e,i)){t.mod.callView(e,i),t.fill.setId(e.id),t.fill.run(e,a),r=e.id;var d,u=t.fill.configs;for(d in u)-1<d.indexOf('id("'+r+'")/')&&u[d]();d=e.id;for(var c in t.fill.cached)-1<c.indexOf('id("'+d+'")/')&&-1<c.indexOf("-config")&&t.fill.cached[c].configContext&&(t.utils.unloaders[i]=t.utils.unloaders[i]||[],t.utils.unloaders[i].push({controller:t.fill.cached[c].configContext,handler:t.fill.cached[c].configContext.onunload}));t.utils.callLCEvent("didupdate",a,e,i)}e=n}return e}}}.bind({},e,i,r)};t.getNode=i,window.mag=t}(window.mag||{},document),function(t){var e=[],n={cache:[],getState:function(t){return e[t][1]},setState:function(t,n){e[t][1]=n},getView:function(t){return e[t][0]},getProps:function(t){return e[t][2]},setProps:function(t,n){return e[t][2]=n},remove:function(t){e.splice(t,1)},getId:function(t){return e[t]&&e[t][3]},exists:function(t){return void 0!==e[t]?!0:!1},setFrameId:function(t,n){e[t][4]=n},getFrameId:function(t){return e[t][4]},submodule:function(t,i,r,o){return e[i]?(n.setProps(i,o),e[i]):(e[i]=[0,0,0,0,0],n.setProps(i,o),o=function(t,e,i){r.view.call(r,e,n.getProps(t),i)}.bind({},i),e[i][0]=o,e[i][1]=new function(){return(r.controller||function(){}).call(this,n.getProps(i))||this},e[i][3]=t,e[i])},iscached:function(t,e){return n.cache[t]&&n.cache[t]===JSON.stringify(e)?!0:void(n.cache[t]=JSON.stringify(e))},clear:function(t){t>-1&&n.cache[t]&&n.cache.splice(t,1)}},i=[];n.callView=function(e,r){var o=n.getView(r);i[r]||(t.props.attachToArgs(r,n.getState(r),e),i[r]=1),o(n.getState(r),e)},t.mod=n}(window.mag||{}),function(t){function e(n,i){n&&void 0!==Object.observe&&Object.observe(n,function(r){r.forEach(function(r){if("object"==typeof n[r.name]){if("update"==r.type&&r.oldValue&&"function"==typeof r.oldValue.draw&&r.object[r.name]&&!r.object[r.name].draw){var o=r.oldValue.getId();t.utils.callLCEvent("onunload",t.mod.getState(o),t.getNode(t.mod.getId(o)),o,1),t.clear(o)}e(n[r.name],i)}}),i.apply(this,arguments)},o)}function n(t){for(var e in t)if(t[e]&&-1!==["INPUT","SELECT","TEXTAREA"].indexOf(t[e].tagName))return t[e];return!1}var i={},r=[];i.setup=function(n,i){var o=t.mod.getState(n),a=t.mod.getProps(n);r[n]||(e(o,i),e(a,i),r[n]=1)};var o=["add","update","delete"],a=function(e,n){for(var i=1;i<e.length;i+=2){var r=e[i+1];n=t.fill.find(n,e[i]),n=n[r]}return n},u=function(e,i,r,o){return e=(""+r).split("."),3>e.length?(e=parseInt(e.pop()),e=isNaN(e)?0:e,i=t.fill.find(o[e]?o[e]:o,i)):(o=a(e,o),i=t.fill.find(o,i)),(i=n(i))&&!i.eventOnFocus&&(i.addEventListener("focus",function(){this.__magnum__=this.__magnum__||{},this.__magnum__.dirty||(this.__magnum__.dirty=1)},!1),i.eventOnFocus=!0),i},d=function(e,i,r,o){var a=r[i];"_value"===i&&(i=e.split(".").pop());var d=t.fill.find(o,i),d=n(d);if("function"!=typeof a&&d){var c=u.bind({},r,i,e,o);c(),Object.defineProperty(r,i,{configurable:!0,get:function(){var n=c();return n&&"undefined"!==n.value&&n.__magnum__&&n.__magnum__.dirty&&n.value!==a?(a=n.value,t.redraw(o,e,1),n.value):a},set:function(t){var e=c();e&&"undefined"!==e.value&&e.value!==t&&t!==a&&(e.value=t,a=t)}})}},c=function(t,e,n){for(var i in e){var r=e[i];"object"==typeof r?c(t+"."+i,r,n):d.bind({},t,i,e,n)()}};i.attachToArgs=c,i.cached=r,t.props=i}(window.mag||{}),function(t){var e={callHook:function(t,e,n,i,r,o){r.change=!1,t[n][i].key==e&&(o=JSON.stringify({v:r.value,k:r.key}),t[n][i].handler.call(t[n][i].context,r),o!==JSON.stringify({v:r.value,k:r.key})&&(r.change=!0))},unloaders:[],callLCEvent:function(n,i,r,o,a){var u=!1,d={preventDefault:function(){u=!0}};if(i&&i[n]&&(i[n].call(i,d,r,t.mod.getProps(o)),a&&(i[n]=0)),u)for(i=0;n=e.unloaders[o][i];i++)n.controller.onunload&&(n.handler.call(n.controller,r),n.controller.onunload=0);return u},copy:function(t){return JSON.parse(JSON.stringify(t))},copyFun:function(n){var i,r,o;i=Array.isArray(n)?[]:{};for(o in n)r=n[o],i[o]="object"==typeof r?e.copy(r):"function"==typeof r&&"fun"==r.type?t.prop(r()):r;return i},merge:function(t,n){for(var i in n)n[i]&&n[i].constructor==Object&&n.hasOwnProperty(i)&&("object"!=typeof t[i]&&(t[i]={}),t[i])?e.merge(t[i],n[i]):t[i]=n[i];return t}},n={i:[],isItem:function(t){return-1<n.i.indexOf(t)},setItem:function(t){n.i[n.i.length]=t},getItem:function(t){return n.i.indexOf(t)},getItemVal:function(t){return n.i[t]},removeItem:function(t){n.i.splice(n.i.indexOf(t),1)}};e.items=n,e.getItemInstanceIdAll=function(){return n.i},e.getItemInstanceId=function(t){return n.isItem(t)?n.getItem(t):(n.setItem(t),n.getItem(t))},t.utils=e,t.debounce=function(t,e,n){e||(e=16);var i;return function(){var r=this,o=arguments,a=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(r,o)},e),a&&t.apply(r,o)}},t.prop=function(t){var e=function(){return arguments.length&&(t=arguments[0]),t};return e.toJSON=function(){return t},e.type="fun",e},t.withProp=function(t,e){return function(n){n=n||event,n=n.currentTarget||this,e(t in n?n[t]:n.getAttribute(t))}}}(window.mag||{}),function(t,e,n,i){function r(t){return Array.isArray&&Array.isArray(t)||"[object Array]"==={}.toString.call(t)}function o(t,e){return t[C]=t[C]||{},(!t[C].uid||e)&&(t[C].uid=performance.now()),t[C].uid}function a(t,e){var n=o(t,e);if(A[n])n=A[n];else{var i,r=A,a="";i=d(t);var u=t.parentNode&&[].indexOf.call(t.parentNode.children,t);i&&(a+='id("'+i.id+'")'),i=a+("/"+t.tagName+"["+(u+1)+"]"),n=r[n]=i}return n}function u(t,e,n){return t=o(t,n),S[_.id]=S[_.id]||[],S[_.id][t]&&S[_.id][t]==e?1:(S[_.id][t]=e,i)}function d(t){return t.id?t:t.parentNode?d(t.parentNode):i}function c(t){if(""!==t.id)return'id("'+t.id+'")';if(t===n.body)return t.tagName;var e=0;if(t.parentNode)for(var i=t.parentNode.childNodes,r=0;r<i.length;r++){var o=i[r];if(o===t)return c(t.parentNode)+"/"+t.tagName+"["+(e+1)+"]";1===o.nodeType&&o.tagName===t.tagName&&e++}}function l(t){var e=c(t);t.parentNode.removeChild(t),x[e+"-config"]&&x[e+"-config"].configContext&&typeof x[e+"-config"].configContext.onunload===k&&x[e+"-config"].configContext.onunload(x[e+"-config"].configContext,t,e)}function f(t){return(t=t&&parseInt(t.split("[").pop().slice(0,-1)))?parseInt(t)-1:0}function s(t){return t&&-1<t.indexOf("id(")&&t.split('id("')[1].split('")')[0]}function h(t){return t&&t[C]&&t[C].isChildOfArray?t:t.parentNode?h(t.parentNode):i}function p(t,e,n){if(!u(t,e.outerHTML,n)){for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(e)}}function m(t,e,n){var o,a,u=f(n);if(e&&e.nodeType==N)return p(t,e),i;if("function"==typeof e)return(o=h(t.parentNode))&&(u=+o.getAttribute("key").split(C)[1]),(e=e(u))&&e.nodeType&&e.nodeType==N?(p(t,e,1),t[C]=t[C]||{},t[C].isChildOfArray=!0,t[C].dataPass={index:u},i):(u=/<[a-z][\s\S]*>/i.test(e)?"_html":"_text",o={},o[u]=e,m(t,o,n));if("object"!=typeof e)return m(t,{_text:e},n);for(var d in e)u=e[d],u===i?u="":null===u&&-1===["onunload"].indexOf(d)&&I(t,d).forEach(function(t){l(t)}),"_"===d[0]&&(o=o||{},o[d.substr(1)]=u);o&&y(t,o,n);for(d in e)u=e[d],-1===O.indexOf(d)&&"_"!==d[0]&&(a=I(t,d),typeof u===k&&u.toJSON&&(u=u()),r(u)&&(a=I(t,"$"+d)),_.run(a,u,n+"/"+d))}function g(t){var e;if(null==t.length&&(t=[t]),!r(t)){e=[];for(var n=0;n<t.length;n+=1)t[n]&&e.push(t[n]);t=e}return t}function v(e,i,r){return function(e,i,r){var o=h(i),u=o&&c(o),l=f(u),p=a(i),m=f(p);return e=e.call(i,r,m,i,{path:u,data:((o||{})[C]||[]).dataPass,node:o,index:l}),p=s(p),i=n.getElementById(p),r=d(i.parentNode),r&&setTimeout(function(e){t.redraw(e,t.utils.items.getItem(e.id))}.bind({},r)),i&&setTimeout(function(e,n){t.redraw(e,t.utils.items.getItem(n))}.bind({},i,p)),e}.bind({},i[r],e)}function y(n,i,r){var o,a=f(r);for(o in i)if("text"!==o&&"html"!==o)if(0==o.indexOf("on"))n[o.toLowerCase()]=v(n,i,o);else if("config"==o){r=c(n);var a=f(r),u=!0;x[r+"-config"]?u=!1:x[r+"-config"]={};var d=x[r+"-config"].configContext=x[r+"-config"].configContext||{};e[r]=function(t,e){return function(){return t.apply(t,e)}}(i[o],[n,u,d,a])}else r={key:o,value:i[o],node:n},t.hook("attributes",o,r),r.change&&(o=r.key,i[o]=r.value),null===i[o]?n.removeAttribute(o):n.setAttribute(o,""+i[o]);b(n,i.text),w(n,i.html)}function b(t,e){var n,i;if(t&&null!=e&&!u(t,e)){if(!i){i=[];for(var r=0;r<t.childNodes.length;r+=1)n=t.childNodes[r],n.nodeType===N&&i.push(n)}for(;t.lastChild;)t.removeChild(t.lastChild);for("INPUT"===t.nodeName?t.setAttribute("value",""+e):t.appendChild(t.ownerDocument.createTextNode(""+e)),r=0;r<i.length;r+=1)t.appendChild(i[r]);"SELECT"===t.nodeName&&(t.value=""+e)}}function w(t,e){t&&null!=e&&!u(t,e)&&(t.innerHTML=e)}function I(e,n,i){var r=[];if(e){var o=e.childNodes;if(o)for(var a=0;a<o.length;a+=1)o[a].nodeType===N&&r.push(o[a])}var o=[],a=n,u="$"===n[0];"$"===a[0]&&(a=a.substr(1));for(var d=0;d<r.length;d+=1){var c=r[d],l=a,f=" "+c.className+" ";(c.id===l||-1<f.indexOf(" "+l+" ")||c.name===l||c.nodeName.toLowerCase()===l.toLowerCase()||c.getAttribute("data-bind")===l)&&o.push(r[d])}if(!o.length||u)for(d=0;d<r.length&&(o=o.concat(I(r[d],n,!0)),!o.length||u);d++);return i||o.length||(e={key:n,value:o,node:e},t.hook("elementMatcher",n,e),e.change&&(o=e.value)),o}var _={},N=1,x=[],C="__magnum__",k="function",O=["willupdate","didupdate","didload","willload","isupdate"],A=[],S=[],T={};_.run=function(t,e,n){var o,u,d;if(t){null==e&&(e={_text:""});var c=g(t);if(d=r(e)){if(T[n]&&0===c.length&&(T[n].parent.insertAdjacentHTML("beforeend",T[n].node),c=g(T[n].parent.children)),0===c.length)return;for(u=c[0].parentNode,T[n]||(T[n]={node:c[0].cloneNode(!0).outerHTML,parent:u});c.length<e.length;)T[n]?(u.insertAdjacentHTML("beforeend",T[n].node),o=u.lastChild):o=c[0].cloneNode(!0),c.push(o),u&&u.appendChild(o);if(c.map(function(t){return t.__key}),n=e.map(function(t){return t._key}),(c.length==e.length||-1!==n.indexOf(i))&&(e=e.map(function(t,e){if("object"==typeof t){if(c[e].__key&&void 0===t._key)return t._key=c[e].__key,t;void 0===t._key&&(t._key=C+e),c[e].__key=t._key}return t})),c.length>e.length)if(0===e.length||"object"!=typeof e[0])for(;c.length>e.length;)o=c.pop(),(u=o.parentNode)&&l(o);else var f=[],s=e.map(function(t){return t._key}),c=(c.map(function(t){return t.__key}),c.filter(function(t){return-1===s.indexOf(t.__key)||-1!==f.indexOf(t.__key)?(f.push(t.__key),l(t),!1):(f.push(t.__key),!0)}))}for(n=0;n<c.length;n++)d?c[n]&&_.run(c[n],e[n]):(e&&"object"==typeof e&&-1!==Object.keys(e).indexOf("_key")&&(c[n][C]=c[n][C]||{},c[n][C].isChildOfArray=!0,c[n][C].dataPass=e),o=a(c[n]),m(c[n],e,o));return t}},_.configs=e,_.find=I,_.setId=function(t){_.id=t},_.clearCache=function(t){S[t]&&delete S[t]},t.fill=_}(window.mag||{},[],document),function(t){function e(){this.frames=[],this.lastId=0,this.raf=n,this.batch={hash:{},read:[],write:[],mode:null}}var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};e.prototype.write=function(t,e){var n=this.add("write",t,e),i=this.batch.mode,r=n.id;return this.batch.write.push(n.id),"writing"===i||"reading"===i||this.batch.scheduled?r:(this.scheduleBatch(),r)},e.prototype.clear=function(t){if("function"==typeof t)return this.clearFrame(t);t=+t;var e=this.batch.hash[t];if(e){var e=this.batch[e.type],n=e.indexOf(t);delete this.batch.hash[t],~n&&e.splice(n,1)}},e.prototype.clearFrame=function(t){t=this.frames.indexOf(t),~t&&this.frames.splice(t,1)},e.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},e.prototype.uniqueId=function(){return++this.lastId},e.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},e.prototype.runBatch=function(){this.batch.mode="reading",this.flush(this.batch.read),this.batch.mode="writing",this.flush(this.batch.write),this.batch.mode=null},e.prototype.add=function(t,e,n){var i=this.uniqueId();return this.batch.hash[i]={id:i,fn:e,ctx:n,type:t}},e.prototype.run=function(t){var e=t.ctx||this,n=t.fn;return delete this.batch.hash[t.id],this.onError?void n.call(e):n.call(e)},e.prototype.loop=function(){var t=this,e=this.raf;this.looping||(e(function n(){var i=t.frames.shift();t.frames.length?e(n):t.looping=!1,i&&i()}),this.looping=!0)},e.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)},t=t||new e,window.fastdom=t}(window.fastdom);

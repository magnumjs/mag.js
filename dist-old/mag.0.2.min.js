/*
* MagnumJS - By Michael Glazer March 2015
* https://github.com/magnumjs/mag.js
*/
function setwatch(e,t){setwatch.obj=e,watch(e,t)}var domElement={};domElement.remove=function(e){return(elem=document.getElementById(e)).parentNode.removeChild(elem)},domElement.val=function(e,t,n){for(var r=domElement.findByKey(e,t),o=0;o<r.length;o++){var l=r[o].item(e);-1!==["INPUT","TEXTAREA","SELECT"].indexOf(l.tagName)?l.value=n:(txt=document.createTextNode(n),l.innerText=txt.textContent)}},domElement.setAttrs=function(e,t,n){var r=domElement.findByKey(e,t);for(var o in n)for(var l=0;l<r.length;l++)0!=o.indexOf("on")&&r[l].item(e).setAttribute(o,n[o])},domElement.event=function(e,t,n){var r=domElement.findByKey(e,t),o=n().attrs;for(var l in o)if(0==l.indexOf("on"))for(var a=0;a<r.length;a++)r[a].item(e).addEventListener(l.substr(2),o[l])},domElement.replaceWithin=function(e,t,n){function r(e,t,n){if(e.hasChildNodes())for(var a=e.children,i=0,c=a.length;c>i;i++)a[i].firstChild&&(a[i].firstChild.nodeValue?(o(t,a[i],n),l(t,a[i],n)):r(a[i],t,n));else o(t,e,n),l(t,e,n)}function o(e,t,r){function o(e,t,r){e.nodeValue=e.nodeValue.replace(t,function(e,t){return r==t?n:e})}for(var l=0,a=t.attributes,i=a.length;i>l;l++){var c=a.item(l);o(c,e,r)}}function l(e,t,r){t.firstChild.nodeValue=t.firstChild.nodeValue.replace(e,function(e,t){return r==t?n:e})}this.pattern=this.pattern||RegExp("\\[\\[(.*?)\\]\\]","g"),r(e,this.pattern,t)},domElement.setTextContent=function(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))},domElement.findByKey=function(e,t){var n=[".key","#key","key",'[name="key"]','[data-bind="key"]'];setSelectorMapKey=function(e){return n.join(",").replace(/KEY/gi,e).split(",")},getElement=function(e,t){return e.querySelectorAll(t)};var r=setSelectorMapKey(t),o=[];for(var l in r){var a,i=r[l];(a=getElement(e,i))&&a.length>0&&(a.selector=i,o.push(a))}return o},domElement.hasClass=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1},domElement.replaceClass=function(e,t){var n,r="",o=e.className.split(" ");for(n=0;n<o.length;n++)o[n]!==t&&(r+=o[n]+" ");e.className=r};var mod={modules:[],controllers:[],elements:[]};mod.submodule=function(e,t){var n=function(t){return(e.controller||function(){}).apply(this,t)}.bind({},t),r=function(n){arguments.length>1&&(t=t.concat([].slice.call(arguments,1)));var r=e.view.apply(e,t?[n].concat(t):[n]);return t[0]&&null!=t[0].key&&(r.attrs.key=t[0].key),r};n.$original=e.controller;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o},mod.getArgs=function(e){var t=mod.modules[e].controller&&mod.modules[e].controller.$$args?[mod.controllers[e]].concat(mod.modules[e].controller.$$args):[mod.controllers[e]];return t},function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):(window.WatchJS=e(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){function e(){E=null;for(var e=0;e<b.length;e++)b[e]();b.length=0}var t={noMore:!1,useDirtyCheck:!1},n=[],r=[],o=[],l=!1;try{l=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(a){}var i=function(e){var t={};return e&&"[object Function]"==t.toString.call(e)},c=function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=function(e){return"[object Object]"==={}.toString.apply(e)},u=function(e,t){var n=[],r=[];if("string"!=typeof e&&"string"!=typeof t){if(c(e))for(var o=0;o<e.length;o++)void 0===t[o]&&n.push(o);else for(o in e)e.hasOwnProperty(o)&&void 0===t[o]&&n.push(o);if(c(t))for(var l=0;l<t.length;l++)void 0===e[l]&&r.push(l);else for(l in t)t.hasOwnProperty(l)&&void 0===e[l]&&r.push(l)}return{added:n,removed:r}},f=function(e){if(null==e||"object"!=typeof e)return e;var t,n=e.constructor();for(t in e)n[t]=e[t];return n},d=function(e,t,n,r){try{Object.observe(e,function(e){e.forEach(function(e){e.name===t&&r(e.object[e.name])})})}catch(o){try{Object.defineProperty(e,t,{get:n,set:function(e){r.call(this,e,!0)},enumerable:!0,configurable:!0})}catch(l){try{Object.prototype.__defineGetter__.call(e,t,n),Object.prototype.__defineSetter__.call(e,t,function(e){r.call(this,e,!0)})}catch(a){m(e,t,r)}}}},h=function(e,t,n){try{Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!1,value:n})}catch(r){e[t]=n}},m=function(e,t,n){r[r.length]={prop:t,object:e,orig:f(e[t]),callback:n}},p=function(e,t,n,r){if("string"!=typeof e&&(e instanceof Object||c(e))){if(c(e)){if(x(e,"__watchall__",t,n),void 0===n||n>0)for(var o=0;o<e.length;o++)p(e[o],t,n,r)}else{var a=[];for(o in e)"$val"==o||!l&&"watchers"===o||Object.prototype.hasOwnProperty.call(e,o)&&a.push(o);v(e,a,t,n,r)}r&&V(e,"$$watchlengthsubjectroot",t,n)}},v=function(e,t,n,r,o){if("string"!=typeof e&&(e instanceof Object||c(e)))for(var l=0;l<t.length;l++)g(e,t[l],n,r,o)},g=function(e,t,n,r,o){"string"!=typeof e&&(e instanceof Object||c(e))&&!i(e[t])&&(null!=e[t]&&(void 0===r||r>0)&&p(e[t],n,void 0!==r?r-1:r),x(e,t,n,r),o&&(void 0===r||r>0)&&V(e,t,n,r))},y=function(e,t){if(!(e instanceof String)&&(e instanceof Object||c(e)))if(c(e)){for(var n=["__watchall__"],r=0;r<e.length;r++)n.push(r);w(e,n,t)}else{var o=function(e){var n,r=[];for(n in e)e.hasOwnProperty(n)&&(e[n]instanceof Object?o(e[n]):r.push(n));w(e,r,t)};o(e)}},w=function(e,t,n){for(var r in t)t.hasOwnProperty(r)&&A(e,t[r],n)},b=[],E=null,j=function(){return E||(E=setTimeout(e)),E},_=function(e){null==E&&j(),b[b.length]=e},C=function(e,t,n,r){var o=null,l=-1,a=c(e);p(e,function(n,r,i,c){var s=j();if(l!==s&&(l=s,o={type:"update"},o.value=e,o.splices=null,_(function(){t.call(this,o),o=null})),a&&e===this&&null!==o){if("pop"===r||"shift"===r)i=[],c=[c];else if("push"===r||"unshift"===r)i=[i],c=[];else if("splice"!==r)return;o.splices||(o.splices=[]),o.splices[o.splices.length]={index:n,deleteCount:c?c.length:0,addedCount:i?i.length:0,added:i,deleted:c}}},1==n?void 0:0,r)},O=function(e,t,n,r,o){e&&t&&(g(e,t,function(e,t,l,a){e={type:"update"},e.value=l,e.oldvalue=a,(r&&s(l)||c(l))&&C(l,n,r,o),n.call(this,e)},0),(r&&s(e[t])||c(e[t]))&&C(e[t],n,r,o))},x=function(e,n,r,o){var l=!1,a=c(e);for(e.watchers||(h(e,"watchers",{}),a&&T(e,function(t,r,l,a){if(P(e,t,r,l,a),0!==o&&l&&(s(l)||c(l))){var i,u;for(t=e.watchers[n],(a=e.watchers.__watchall__)&&(t=t?t.concat(a):a),u=t?t.length:0,a=0;u>a;a++)if("splice"!==r)p(l,t[a],void 0===o?o:o-1);else for(i=0;i<l.length;i++)p(l[i],t[a],void 0===o?o:o-1)}})),e.watchers[n]||(e.watchers[n]=[],a||(l=!0)),a=0;a<e.watchers[n].length;a++)if(e.watchers[n][a]===r)return;if(e.watchers[n].push(r),l){var i=e[n];r=function(){return i},l=function(r,l){var a=i;if(i=r,0!==o&&e[n]&&(s(e[n])||c(e[n]))&&!e[n].watchers){var u,f=e.watchers[n].length;for(u=0;f>u;u++)p(e[n],e.watchers[n][u],void 0===o?o:o-1)}e.watchers&&(e.watchers.__wjs_suspend__||e.watchers["__wjs_suspend__"+n])?$(e,n):t.noMore||a===r||(l?P(e,n,"set",r,a):k(e,n,"set",r,a),t.noMore=!1)},t.useDirtyCheck?m(e,n,l):d(e,n,r,l)}},k=function(e,t,n,r,o){if(void 0!==t){var l,a=e.watchers[t];(l=e.watchers.__watchall__)&&(a=a?a.concat(l):l),l=a?a.length:0;for(var i=0;l>i;i++)a[i].call(e,t,n,r,o)}else for(t in e)e.hasOwnProperty(t)&&k(e,t,n,r,o)},N="pop push reverse shift sort slice unshift splice".split(" "),S=function(e,t,n,r){h(e,n,function(){var o,l,a,i=0;if("splice"===n){for(a=arguments[0],l=e.slice(a,a+arguments[1]),o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];i=a}else o=0<arguments.length?arguments[0]:void 0;return a=t.apply(e,arguments),"slice"!==n&&("pop"===n?(l=a,i=e.length):"push"===n?i=e.length-1:"shift"===n?l=a:"unshift"!==n&&void 0===o&&(o=a),r.call(e,i,n,o,l)),a})},T=function(e,t){if(i(t)&&e&&!(e instanceof String)&&c(e))for(var n,r=N.length;r--;)n=N[r],S(e,e[n],n,t)},A=function(e,t,o){if(void 0===o&&e.watchers[t])delete e.watchers[t];else for(var l=0;l<e.watchers[t].length;l++)e.watchers[t][l]==o&&e.watchers[t].splice(l,1);for(l=0;l<n.length;l++){var a=n[l];a.obj==e&&a.prop==t&&a.watcher==o&&n.splice(l,1)}for(o=0;o<r.length;o++)l=r[o],a=l.object.watchers,(l=l.object==e&&l.prop==t&&a&&(!a[t]||0==a[t].length))&&r.splice(o,1)},$=function(e,t){_(function(){delete e.watchers.__wjs_suspend__,delete e.watchers["__wjs_suspend__"+t]})},K=null,P=function(e,t,n,r,l){o[o.length]={obj:e,prop:t,mode:n,newval:r,oldval:l},null===K&&(K=setTimeout(B))},B=function(){var e=null;K=null;for(var t=0;t<o.length;t++)e=o[t],k(e.obj,e.prop,e.mode,e.newval,e.oldval);e&&(o=[])},V=function(e,t,r,o){var l;l=f("$$watchlengthsubjectroot"===t?e:e[t]),n.push({obj:e,prop:t,actual:l,watcher:r,level:o})};return setInterval(function(){for(var e=0;e<n.length;e++){var t=n[e];if("$$watchlengthsubjectroot"===t.prop){var o=u(t.obj,t.actual);(o.added.length||o.removed.length)&&(o.added.length&&v(t.obj,o.added,t.watcher,t.level-1,!0),t.watcher.call(t.obj,"root","differentattr",o,t.actual)),t.actual=f(t.obj)}else{if(o=u(t.obj[t.prop],t.actual),o.added.length||o.removed.length){if(o.added.length)for(var a=0;a<t.obj.watchers[t.prop].length;a++)v(t.obj[t.prop],o.added,t.obj.watchers[t.prop][a],t.level-1,!0);k(t.obj,t.prop,"differentattr",o,t.actual)}t.actual=f(t.obj[t.prop])}}for(e in r){var t=r[e],o=t.object[t.prop],a=t.orig,i=o,c=void 0,d=!0;if(a!==i)if(s(a)){for(c in a)if((l||"watchers"!==c)&&a[c]!==i[c]){d=!1;break}}else d=!1;d||(t.orig=f(o),t.callback(o))}},50),t.watch=function(){i(arguments[1])?p.apply(this,arguments):c(arguments[1])?v.apply(this,arguments):g.apply(this,arguments)},t.unwatch=function(){i(arguments[1])?y.apply(this,arguments):c(arguments[1])?w.apply(this,arguments):A.apply(this,arguments)},t.callWatchers=k,t.suspend=function(e,t){e.watchers&&(e.watchers["__wjs_suspend__"+(void 0!==t?t:"")]=!0)},t.onChange=function(){(i(arguments[2])?O:C).apply(this,arguments)},t});var render={roots:[],templates:{}};render.redraw=function(e){for(var t,n=0;t=render.roots[n];n++)if(e.controllers[n]){var r=e.elements[n],o=e.getArgs(n);e.modules[n].view(r,e.controllers[n],o),setwatch(o,function(t,n){var r=e.getArgs(n);render.interpolate(t,r[0])}.bind(null,r,n)),render.interpolate(r,o[0])}},render.isTypeOf=function(e,t){return this.toString.call(t)==="[object "+e+"]"?!0:void 0},render.types=["Array","String","Object","Function"],render.interpolate=function(e,t){for(var n in t)if(render.isTypeOf("Array",t[n])){var r=domElement.findByKey(e,n);if(r.length<1)continue;var o,l=r[0].item(e).parentNode;if(render.templates[n]){for(;l.firstChild;)l.removeChild(l.firstChild);o=render.templates[n]}else o=r[0].item(e).cloneNode(!0);for(var a=0;a<t[n].length;a++){var i=o.cloneNode(!0),c=t[n][a];domElement.setTextContent(i,c),l.appendChild(i)}render.templates[n]||(render.templates[n]=o,l.removeChild(r[0].item(e)))}else if(render.isTypeOf("Function",t[n]))"vdom"==t[n]._type&&(domElement.event(e,n,t[n]),domElement.setAttrs(e,n,t[n]().attrs));else if(render.isTypeOf("String",t[n]))domElement.val(e,n,t[n]);else if(render.isTypeOf("Object",t[n]))for(var s in t[n])domElement.replaceWithin(e,s,t[n][s])};var mag=function(e,t,n,r){"use strict";var o={};o.init=function(e,t){if(!(this instanceof o.init))return new o.init(e,t);console.log("mag init")},o.prop=function(e){var r=function(){return arguments.length&&(e=arguments[0],n.redraw(t)),e};return r.toJSON=function(){return e},r},o.h=function(e){var t=function(){return{attrs:e}};return t._type="vdom",t},o.module=function(e,o,l){console.time("MagnumJS");var a=n.roots.indexOf(e);0>a&&(a=n.roots.length);var i=r.getElementById(e),c=i.parentNode,s=i.cloneNode(!0),u=r.createElement("span");c.replaceChild(u,i);var f=t.submodule(o,[l]);n.roots[a]=e;var d=new f.controller;t.controllers[a]=d,t.modules[a]=f,t.elements[a]=s,n.redraw(t),c.replaceChild(s,u),d.onload&&d.onload.call(),console.timeEnd("MagnumJS")};var l=function(e){return function(){return o[e].apply(this,arguments)}},a=l("init");return a.module=l("module"),a.h=l("h"),a.prop=l("prop"),a}(mag=mag||{},mod,render,document);

/*
Mag.JS AddOns v0.23.9
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
(function(a,b,c,d){'use strict';function f(q,r){for(var w,s=Object.keys(q),t=0,u=s.length;t<u;++t)w=s[t],r(w,q[w])}function g(q){return q.replace(/([a-z])([A-Z])/g,'$1-$2').toLowerCase()}var h=q=>r=>(s,t)=>{return r=r||{},r.key=(r.key?s+'.'+r.key:s)+t,q(r)};a.create=function(q,r,s){if('function'==typeof r){var t=a(q,r,s);return h(t)}return'function'==typeof q?h(q):(u,w)=>{return'string'==typeof u||a.utils.isHTMLEle(u)||(w=u,u=0),a.module(u||q,r,a.merge(a.copy(s)||{},a.copy(w)||{}))}},a.template=function(q,r){var s=q;return'prod'==a.ENV&&(s={url:q,cache:1}),a.request(s).then(function(t){var u=a.html2dom(t);return r&&r(u),u})},a.html2dom=function(q){var r=a.doc.createElement('template');return r.innerHTML=q,r.content.children[0]},a.getTags=function(q){var r=a.utils.items.getItemVal(a.mod.runningViewInstance),s=a.getNode(r),t=(s||a.doc).getElementsByTagName(q),u=[].slice.call(t);return u},a.tag=function(q,r,s,t){var u=a.getTags(q),w=[];if(t=t||'module',u.length)for(var y of u)w.push(a[t](y,r,s));return 1==w.length?w[0]:w},a.noop=function(){},a.copy=a.utils.copy,a.merge=a.utils.merge,a.isEmpty=function(q){if(!q||0==q.length)return!0;if('Object]'==q.toString().substr(-7)){for(var r in q)if(q.hasOwnProperty(r))return!1;return!0}return q.trim()},a.show=function(q,r){var s=typeof q;if('object'!=s){var t={_config:function(u){u.style.display=q?'block':'none'}};return'object'==typeof r&&a.merge(r,t),t}'object'==s?q.willload=function(u){u.style.display='block'}:q.willupdate=function(u,w){u.style.display=w[r]?'block':'none'}},a.deferred=function(){var q={};return q.promise=new Promise(function(r,s){q.resolve=r,q.reject=s}),q},a.when=function(q,r){return Promise.all(q).then(r)},a.request=function(q){if('string'==typeof q){var r=q;q={},q.url=r}var s=a.deferred();q.initialValue&&(s.promise.initialValue=q.initialValue);var t=JSON.stringify(q);if(q.cache){var u=a.cache(t);if(u)return s.resolve(u),s.promise}if(a.request.queue[t])return a.request.queue[t];a.request.queue[t]=s.promise;var w=new XMLHttpRequest,y=(q.method||'GET').toUpperCase(),z='GET'!==y&&q.data?'object'==typeof q.data?JSON.stringify(q.data):q.data:'';if(w.onload=function(D){var E=w.getResponseHeader('content-type')||'',F=D.target.responseText;-1<E.indexOf('json')&&(F=JSON.parse(F)),q.cache&&a.cache(t,F,q.cacheTime,q.cacheType),delete a.request.queue[t];var G=w.getAllResponseHeaders();s.resolve(F,G)},w.onerror=function(D){s.reject(D)},w.open(y,q.url),q.withCredentials&&(w.withCredentials=q.withCredentials),q.headers)for(var B,A=0;A<q.headers.length;A++)for(var C in B=q.headers[A],B)w.setRequestHeader(C,B[C]);return w.send(z),s.promise.abort=()=>w.abort(),s.promise},a.request.queue={},a.cache=function(q,r,s,t){var u=b[t||'sessionStorage'];if(1==arguments.length){if(a.cache.data[q])return a.cache.data[q].data;var w=u.getItem(q);return w?(a.cache.data[q]=JSON.parse(w),a.cache.data[q].data):0}a.cache.data[q]&&a.cache.data[q].id&&clearTimeout(a.cache.data[q].id);var y=setTimeout(function(z){u.removeItem(z),delete a.cache.data[z]}.bind({},q),s||600000);a.cache.data[q]={id:y,data:r},u.setItem(q,JSON.stringify(a.cache.data[q]))},a.cache.data={},a.requestWithFeedback=function(q){var r=JSON.stringify(q);if(!a.requestWithFeedback.cache[r]){for(var u,s=c.querySelectorAll('.loader'),t=0;u=s[t];t++)u.style.display='block';var w=function(y){if(delete a.requestWithFeedback.cache[r],0==Object.keys(a.requestWithFeedback.cache).length)for(var A,z=0;A=s[z];z++)A.style.display='none';return y};a.requestWithFeedback.cache[r]=a.request(q),a.requestWithFeedback.cache[r].then(w,function(y){throw w(y),y})}return a.requestWithFeedback.cache[r]},a.requestWithFeedback.cache={},a.disable=function(q,r){var s=r&&r._config?r._config:function(){},t={_config:function(u){s.apply(this,arguments),q()?u.setAttribute('disabled','disabled'):u.removeAttribute('disabled')}};return r&&a.merge(r,t),t},a.find=function(q,r){var s=q;return'string'==typeof q&&(s=a.getNode(q)),a.fill.find(s,r)},a.toMenu=function(q,r){return q.map(function(s,t){return{_text:s,_value:t,_selected:r===t||r===s||null}})},a.namespace=function(q,r){var s=q.split('.'),t=s.shift();return r=r||this,r[t]=r[t]||{},s.length?a.namespace(s.join('.'),r[t]):r[t]},a.route=function(q){'use strict';function t(){for(var B,w=q.location.hash.substr(1),y=w.split('/'),z=y.length,A=0;A<u.length;A++)if(B=u[A],B.parts.length===z){for(var C=[],D=0;D<z;D++)if(':'===B.parts[D].substr(0,1))C.push(y[D]);else if(B.parts[D]!==y[D])break;if(D===z)return void B.handler.apply(d,C)}}var u=[];return q.onhashchange=t,{addRoute:function(w,y){u.push({parts:w.split('/'),handler:y})},load:function(w){q.location.hash=w},start:t}}(b),a.hookin('attributes','key',function(q){q.value=null});var m={opacity:1,zIndex:1,float:1,fontWeight:1,gridColumn:1,lineHeight:1,transform:1,zoom:1};a.hookin('attributes','style',function(q){if('object'==typeof q.value){var r='';f(q.value,function(s,t){null!=t&&(r+=g(s)+':'+(isNaN(t)||s in m?t:t+'px')+';')}),q.value=r}}),a.hookin('attributes','className',function(q){q.key='class';var r=q.value,s=q.node.classList+'';if('string'==typeof q.value)r=q.value.split(' ');else if('object'==typeof q.value){for(var t in r)q.node.classList.toggle(t,'undefined'!=typeof r[t]&&r[t]);return void(q.value=q.node.classList+'')}for(var t in q.value=q.node.classList+'',r){var u=r[t];u.trim()&&0<q.node.classList.length&&!q.node.classList.contains(u.trim())?q.value=q.node.classList+' '+u:u.trim()&&0==q.node.classList.length&&(q.value+=u+' ')}q.value.trim()!==s&&(q.change=1),q.value=q.value.trim()});var o=[];a.hookin('values','*',function(q){var r=typeof q.value;null==q.value||('function'==r&&q.value.toJSON?(q.change=1,q.value=q.value()):'object'==r&&'function'==typeof q.value.then&&(!o[a.fill.id+q.key]&&(o[a.fill.id+q.key]=1,q.value.then(function(s,t,u){if(s){var w=a.utils.items.getItem(s);~w&&(a.mod.getState(w)[t]=u,a.redraw(a.getNode(s),w),o[s+q.key]=0)}return u}.bind(null,a.fill.id,q.key))),q.value.initialValue&&(q.change=1,q.value=q.value.initialValue)))}),a.getId=function(q){return a.utils.items.getItemVal(q)},a.prop=function(q){var r=function(){return arguments.length&&(q=arguments[0]),q};return r.toJSON=function(){return q},r},a.withProp=function(q,r){return function(s){s=s||event;var t=s.currentTarget||this;r(q in t?t[q]:t.getAttribute(q))}}})(mag,window||global||this,document);

/*
Mag.JS v0.8.1
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(n,e,t,r){function o(n){return"[object Array]"===Object.prototype.toString.call(n)}function i(n){if(""!==n.id)return'id("'+n.id+'")';if(n===t.body)return n.tagName;var e=0;if(n.parentNode)for(var r=n.parentNode.childNodes,o=0;o<r.length;o++){var l=r[o];if(l===n)return i(n.parentNode)+"/"+n.tagName+"["+(e+1)+"]";1===l.nodeType&&l.tagName===n.tagName&&e++}}function l(n){var e=i(n);delete v[e];for(var t in v)0===t.indexOf(e)&&delete v[t];n.parentNode.removeChild(n),v[e+"-config"]&&v[e+"-config"].configContext&&"function"==typeof v[e+"-config"].configContext.onunload&&v[e+"-config"].configContext.onunload()}function a(n){return(n=parseInt(n.split("[").pop().slice(0,-1)))?parseInt(n)-1:0}function c(n,e,t){var r,a,s;if(n){null==e&&(e={_text:""});var h=f(n);if(s=o(e)){if(w[t]&&0===h.length&&(w[t].parent.insertAdjacentHTML("beforeend",w[t].node),h=f(w[t].parent.children),"object"==typeof e[0]&&(e[0].key=h[0].key=0)),0===h.length)return;for(a=h[0].parentNode,w[t]||(w[t]={node:h[0].cloneNode(!0).outerHTML,parent:a});h.length<e.length;){var d=h.length;w[t]?(a.insertAdjacentHTML("beforeend",w[t].node),r=a.lastChild):r=h[0].cloneNode(!0),"object"==typeof e[d]&&(e[d].key=d,r.key=d++),h.push(r),a&&a.appendChild(r)}if(h.length>e.length)if(0==e.length)for(;h.length>e.length;)r=h.pop(),(a=r.parentNode)&&l(r);else h=h.filter(function(n){return 0==e.filter(function(e){return e.key==n.key}).length?(l(n),!1):!0})}for(t=0;t<h.length;t++)r=i(h[t]),s?!h[t]||v[r]&&v[r]===JSON.stringify(e[t])||(c(h[t],e[t]),v[r]=JSON.stringify(e[t])):u(h[t],e);return n}}function u(n,e){var t;if("function"!=typeof e){if("object"!=typeof e)return u(n,{_text:e});for(var a in e){var f=e[a];f===r?f="":null===f&&-1===["onunload"].indexOf(a)&&g(n,a).forEach(function(n){l(n)}),"_"===a[0]&&(t=t||{},t[a.substr(1)]=f)}var h=i(n);t&&s(n,t);var d=0;for(a in e)if(f=e[a],"_"!==a[0]){if(t=g(n,a),"function"==typeof f&&"fun"==f.type)try{f=f()}catch(p){}o(f)&&(t=g(n,"$"+a)),c(t,f,h+"/"+a),d++}}}function f(n){var e;if(null==n.length&&(n=[n]),!o(n)){e=[];for(var t=0;t<n.length;t+=1)n[t]&&e.push(n[t]);n=e}return n}function s(t,r){var o=i(t),l=!1,c=a(o);v[o]&&v[o]===JSON.stringify(r)&&(l=!0),t._events=t._events||[];for(var u in r)if("text"!==u&&"html"!==u)if(0==u.indexOf("on")){if(-1===t._events.indexOf(u)||y){var f=function(e,t,r,o){try{return e.call(t,o,r,t)}finally{n.redraw()}}.bind(null,r[u],t,c);t[u]=f,t._events.push(u)}}else if("config"==u){f=!0,v[o+"-config"]?f=!f:v[o+"-config"]={};var s=v[o+"-config"].configContext=v[o+"-config"].configContext||{};e.push(function(n,e){return function(){return n.apply(n,e)}}(r[u],[t,f,s,c]))}else l||(null===r[u]?t.removeAttribute(u):t.setAttribute(u,""+r[u]));l||(h(t,r.text),d(t,r.html),v[o]=JSON.stringify(r))}function h(n,e){var t,r;if(i(n),n&&null!=e){if(!r){r=[];for(var o=0;o<n.childNodes.length;o+=1)t=n.childNodes[o],t.nodeType===p&&r.push(t)}for(;n.firstChild;)n.removeChild(n.firstChild);for("input"===n.nodeName.toLowerCase()?n.setAttribute("value",""+e):n.appendChild(n.ownerDocument.createTextNode(""+e)),o=0;o<r.length;o+=1)n.appendChild(r[o])}}function d(n,e){n&&null!=e&&(n.innerHTML=e)}function g(n,e,t){for(var r=n.childNodes,o=[],i=0;i<r.length;i+=1)r[i].nodeType===p&&o.push(r[i]);if(r=[],i=e,!(n.queryCache||{})[e]){n.queryCache=(n.queryCache||{})[e]=[];var l="$"===e[0];"$"===i[0]&&(i=i.substr(1));for(var a=0;a<o.length;a+=1){var c=o[a],u=i,f=" "+c.className+" ";(c.id===u||-1<f.indexOf(" "+u+" ")||c.name===u||c.nodeName.toLowerCase()===u.toLowerCase()||c.getAttribute("data-bind")===u)&&r.push(o[a])}if(!r.length||l)for(a=0;a<o.length&&(r=r.concat(g(o[a],e,!0)),!r.length||l);a++);!t&&!r.length,n.queryCache[e]=r}return n.queryCache[e]}var p=1,v=[],w={},v=[],y=!1;n.fill={fill:c,find:g,clear:function(){y=!0},unclear:function(){y=!1},configs:e},window.mag=n}(window.mag||{},[],document),function(n){function e(){b=null;for(var n=0;n<_.length;n++)_[n]();_.length=0}var t={noMore:!1,useDirtyCheck:!1},r=[],o=[],i=[],l=!1;try{l=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(a){}var c=function(n){var e={};return n&&"[object Function]"==e.toString.call(n)},u=function(n){return"[object Array]"===Object.prototype.toString.call(n)},f=function(n){return"[object Object]"==={}.toString.apply(n)},s=function(n){if(null==n||"undefined"==typeof object||"object"!=typeof n)return n;var e,t=new n.constructor;for(e in n)t[e]=n[e];return t},h=function(n,e,t,r){try{Object.observe(n,function(n){n.forEach(function(n){n.name===e&&r(n.object[n.name])})})}catch(o){try{Object.defineProperty(n,e,{get:t,set:function(n){r.call(this,n,!0)},enumerable:!0,configurable:!0})}catch(i){try{Object.prototype.__defineGetter__.call(n,e,t),Object.prototype.__defineSetter__.call(n,e,function(n){r.call(this,n,!0)})}catch(l){g(n,e,r)}}}},d=function(n,e,t){try{Object.defineProperty(n,e,{enumerable:!1,configurable:!0,writable:!1,value:t})}catch(r){n[e]=t}},g=function(n,e,t){o[o.length]={prop:e,object:n,orig:s(n[e]),callback:t}},p=function(n,e,t,r){if("string"!=typeof n&&(n instanceof Object||u(n))){if(u(n)){if(N(n,"__watchall__",e,t),void 0===t||t>0)for(var o=0;o<n.length;o++)p(n[o],e,t,r)}else{var i=[];for(o in n)"$val"==o||!l&&"watchers"===o||Object.prototype.hasOwnProperty.call(n,o)&&i.push(o);v(n,i,e,t,r)}r&&J(n,"$$watchlengthsubjectroot",e,t)}},v=function(n,e,t,r,o){if("string"!=typeof n&&(n instanceof Object||u(n)))for(var i=0;i<e.length;i++)w(n,e[i],t,r,o)},w=function(n,e,t,r,o){"string"!=typeof n&&(n instanceof Object||u(n))&&(c(n[e])||(null==n[e]||void 0!==r&&0>=r||p(n[e],t,void 0!==r?r-1:r),N(n,e,t,r),o&&(void 0===r||r>0)&&J(n,e,t,r)))},y=function(n,e){if(!(n instanceof String)&&(n instanceof Object||u(n)))if(u(n)){for(var t=["__watchall__"],r=0;r<n.length;r++)t.push(r);m(n,t,e)}else{var o=function(n){var t,r=[];for(t in n)n.hasOwnProperty(t)&&(n[t]instanceof Object?o(n[t]):r.push(t));m(n,r,e)};o(n)}},m=function(n,e,t){for(var r in e)e.hasOwnProperty(r)&&A(n,e[r],t)},_=[],b=null,j=function(n){null==b&&(b||(b=setTimeout(e))),_[_.length]=n},O=function(n,t,r,o){var i=null,l=-1,a=u(n);p(n,function(r,o,c,u){var f=(b||(b=setTimeout(e)),b);if(l!==f&&(l=f,i={type:"update"},i.value=n,i.splices=null,j(function(){t.call(this,i),i=null})),a&&n===this&&null!==i){if("pop"===o||"shift"===o)c=[],u=[u];else if("push"===o||"unshift"===o)c=[c],u=[];else if("splice"!==o)return;i.splices||(i.splices=[]),i.splices[i.splices.length]={index:r,deleteCount:u?u.length:0,addedCount:c?c.length:0,added:c,deleted:u}}},1==r?void 0:0,o)},C=function(n,e,t,r,o){n&&e&&(w(n,e,function(n,e,i,l){n={type:"update"},n.value=i,n.oldvalue=l,(r&&f(i)||u(i))&&O(i,t,r,o),t.call(this,n)},0),(r&&f(n[e])||u(n[e]))&&O(n[e],t,r,o))},N=function(n,e,r,o){var i=!1,l=u(n);for(n.watchers||(d(n,"watchers",{}),l&&S(n,function(t,r,i,l){if(M(n,t,r,i,l),0!==o&&i&&(f(i)||u(i))){var a,c;for(t=n.watchers[e],(a=n.watchers.__watchall__)&&(t=t?t.concat(a):a),c=t?t.length:0,a=0;c>a;a++)if("splice"!==r)p(i,t[a],void 0===o?o:o-1);else for(l=0;l<i.length;l++)p(i[l],t[a],void 0===o?o:o-1)}})),n.watchers[e]||(n.watchers[e]=[],l||(i=!0)),l=0;l<n.watchers[e].length;l++)if(n.watchers[e][l]===r)return;if(n.watchers[e].push(r),i){var a=n[e];r=function(){return a},i=function(r,i){var l=a;if(a=r,0!==o&&n[e]&&(f(n[e])||u(n[e]))&&!n[e].watchers){var c,s=n.watchers[e].length;for(c=0;s>c;c++)p(n[e],n.watchers[e][c],void 0===o?o:o-1)}return n.watchers&&(n.watchers.__wjs_suspend__||n.watchers["__wjs_suspend__"+e])?void L(n,e):void(t.noMore||l!==r&&(i?M(n,e,"set",r,l):x(n,e,"set",r,l),t.noMore=!1))},t.useDirtyCheck?g(n,e,i):h(n,e,r,i)}},x=function(n,e,t,r,o){if(void 0!==e){var i,l=n.watchers[e];(i=n.watchers.__watchall__)&&(l=l?l.concat(i):i),i=l?l.length:0;for(var a=0;i>a;a++)l[a].call(n,e,t,r,o)}else for(e in n)n.hasOwnProperty(e)&&x(n,e,t,r,o)},T="pop push reverse shift sort slice unshift splice".split(" "),k=function(n,e,t,r){d(n,t,function(){var o,i,l,a;if(o=0,"splice"===t){var c=arguments[0];for(l=n.slice(c,c+arguments[1]),i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];o=c}else i=0<arguments.length?arguments[0]:void 0;return a=e.apply(n,arguments),"slice"!==t&&("pop"===t?(l=a,o=n.length):"push"===t?o=n.length-1:"shift"===t?l=a:"unshift"!==t&&void 0===i&&(i=a),r.call(n,o,t,i,l)),a})},S=function(n,e){if(c(e)&&n&&!(n instanceof String)&&u(n))for(var t,r=T.length;r--;)t=T[r],k(n,n[t],t,e)},A=function(n,e,t){if(n.watchers[e])if(void 0===t)delete n.watchers[e];else for(var i=0;i<n.watchers[e].length;i++)n.watchers[e][i]==t&&n.watchers[e].splice(i,1);for(i=0;i<r.length;i++){var l=r[i];l.obj==n&&l.prop==e&&l.watcher==t&&r.splice(i,1)}for(t=0;t<o.length;t++)i=o[t],l=i.object.watchers,(i=i.object==n&&i.prop==e&&l&&(!l[e]||0==l[e].length))&&o.splice(t,1)},L=function(n,e){j(function(){delete n.watchers.__wjs_suspend__,delete n.watchers["__wjs_suspend__"+e]})},$=null,M=function(n,e,t,r,o){i[i.length]={obj:n,prop:e,mode:t,newval:r,oldval:o},null===$&&($=setTimeout(P))},P=function(){var n=null;$=null;for(var e=0;e<i.length;e++)n=i[e],x(n.obj,n.prop,n.mode,n.newval,n.oldval);n&&(i=[])},J=function(n,e,t,o){var i;i=s("$$watchlengthsubjectroot"===e?n:n[e]),r.push({obj:n,prop:e,actual:i,watcher:t,level:o})};t.watch=function(){c(arguments[1])?p.apply(this,arguments):u(arguments[1])?v.apply(this,arguments):w.apply(this,arguments)},t.unwatch=function(){c(arguments[1])?y.apply(this,arguments):u(arguments[1])?m.apply(this,arguments):A.apply(this,arguments)},t.callWatchers=x,t.suspend=function(n,e){n.watchers&&(n.watchers["__wjs_suspend__"+(void 0!==e?e:"")]=!0)},t.onChange=function(){(c(arguments[2])?C:O).apply(this,arguments)},n.watch=t}(window.mag||{}),function(n){var e={modules:[],controllers:[],elements:[],getController:function(n,e,t){return"undefined"!=typeof Proxy?new Proxy(new n.controller,{get:function(n,r){if(void 0===n[r]&&-1===["watchers","toJSON","called","onload","onunload"].indexOf(r)){var o,i=t.find(e,r),l="$"===r[0],a=[];return i.forEach(function(n,e){i[e]&&(i[e].value&&0<i[e].value.length?(o=i[e].value,!i[e].type||"checkbox"!=i[e].type&&"radio"!=i[e].type||(o={_text:o,_checked:i[e].checked}),a.push(o)):i[e].innerText&&0<i[e].innerText.length?o=i[e].innerText:i[0].innerHTML&&0<i[e].innerHTML.length&&(o=i[e].innerHTML))}),l?a:o}return n[r]}}):new n.controller},submodule:function(n,e){var t=function(e){return(n.controller||function(){}).apply(this,e)}.bind({},e);return t.$original=n.controller,t={controller:t,view:function(t){1<arguments.length&&(e=e.concat([].slice.call(arguments,1)));var r=n.view.apply(n,e?[t].concat(e):[t]);return e[0]&&null!=e[0].key&&(r.attrs.key=e[0].key),r}},e[0]&&null!=e[0].key&&(t.attrs={key:e[0].key}),t},getArgs:function(n){return e.modules[n].controller&&e.modules[n].controller.$$args?[e.controllers[n]].concat(e.modules[n].controller.$$args):[e.controllers[n]]}};n.mod=e}(window.mag||{}),function(n){var e={roots:[],templates:{},cache:{},callOnload:function(n){for(var e,t=0;e=n.controllers[t];t++)e.onload&&!e.called&&(e.onload.call(null,n.elements[t]),e.called=1)},callConfigs:function(n){for(var e=0,t=n.length;t>e;e++)n[e]()}},t=[];e.redraw=function(n,t,r){n=n||e.module||{},this.fun||(this.fun=l(function(){t.configs.splice(0,t.configs.length),e.doLoop(n,t,r)})),this.fun()},e.doLoop=function(t,r,o){for(var i=0;e.roots[i];i++)n.running=!0,!t.controllers[i]||e.innerLoop(t,r,i,o);r.unclear()},e.clear=function(n,e,r){-1!==n&&t[n]&&r.clear()},e.innerLoop=function(n,r,o,i){var l=n.elements[o],a=n.getArgs(o);return t[o]&&t[o]===JSON.stringify(a[0])?n=!1:((n.getArgs(o),n.modules[o]).view(l,n.controllers[o]),t[o]=JSON.stringify(a[0]),e.setupWatch(i,a,r,l,o,n),r.fill(l,a[0]),e.callConfigs(r.configs),n=void e.callOnload(n)),n};var r;e.doWatch=function(o,i,l,a,c){c!=r&&(r=c,n.running=!0,c=a.getArgs(l),t[l]&&t[l]===JSON.stringify(c[0])||((a.getArgs(l),a.modules[l]).view(i,a.controllers[l]),t[l]=JSON.stringify(c[0]),o.fill(i,c[0]),e.callConfigs(o.configs),n.running=!1))},e.setupWatch=function(n,t,r,o,i,a){n.watch(t[0],l(e.doWatch.bind(null,r,o,i,a)),6,!0)};var o=window.cancelAnimationFrame||window.clearTimeout,i=window.requestAnimationFrame||window.setTimeout,l=function(n,e){var t,r,l=e||16;return function(){if(+new Date-t>l||i===window.requestAnimationFrame){r>0&&o(r);var e=arguments;r=i(function(){t=+new Date;var r=[].slice.call(arguments).concat([].slice.call(e));n.apply(this,r)},l)}else{t=+new Date;var a=[].slice.call(arguments).concat([].slice.call(e));n.apply(this,a),r=i(function(){r=null},l)}}};n.render=e}(window.mag||{}),function(n,e){var t=n.mod,r=n.render,o=n.fill,i=n.watch,l=n.running=!1;n.redraw=function(){l||(l=!0,r.redraw(t||r.module||{},o,i),l=!1)},n.withProp=function(n,e){return function(t){t=t||event,t=t.currentTarget||this,e(n in t?t[n]:t.getAttribute(n))}},n.prop=function(e){var t=function(){return arguments.length&&(e=arguments[0],n.redraw()),e};return t.type="fun",t.toJSON=function(){return e},t};var a=[];n.module=function(i,l,c){var u=r.roots.indexOf(i);c&&!c.retain&&r.clear(u,i,o),0>u&&(u=r.roots.length);for(var f,s=!1,h={preventDefault:function(){s=!0}},d=0;f=a[d];d++)f.handler(h),f.controller.onunload=null;if(s)for(d=0;f=a[d];d++)f.controller.onunload=f.handler;else a=[];return s?void 0:(i=e.getElementById(i))?(r.roots[u]=i.id,l.view?(l=t.submodule(l,[c||{}]),c=t.getController(l,i,o),t.controllers[u]=c,c.onunload&&a.push({controller:c,handler:c.onunload}),t.modules[u]=l,t.elements[u]=i,n.redraw(),c.onload&&!n.running&&r.callOnload(t),{_html:i.innerHTML}):Error("module requires a view")):Error("invalid node")}}(window.mag||{},document);

/*
Mag.JS v0.23.1
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,t,n){function i(t,n){if(o[t]&&!n)return o[t];var i=e.doc.getElementById(t);return i&&(o[t]=i),o[t]}e.doc=t;var r={values:[],attributes:[],elementMatcher:[]},o=[];e.create=function(t,n,i){return function(r,o){return"string"!=typeof r&&(o=r,r=0),e.module(r||t,n,e.utils.merge(i||{},o||{}))}},e.module=function(t,n,r){r=r||{},t instanceof HTMLElement&&(t.id||(t.id=performance.now()),o[t.id]=t,t=t.id);var a;if(!(a=!e.utils.items.isItem(t))){a=e.utils.items.getItem(t);var u=i(t);a=!e.utils.callLCEvent("onreload",e.mod.getState(a),u,a)}return a&&(a=r.key&&e.utils.items.isItem(t+"."+r.key)?e.utils.items.getItem(t+"."+r.key):e.utils.getItemInstanceId(r.key?t+"."+r.key:t),r.retain||e.mod.clear(a),e.mod.submodule(t,a,n,r),u=i(t),v(a,t),!e.utils.callLCEvent("willload",e.mod.getState(a),u,a,1))?(t=e.mod.getState(a),e.utils.unloaders[a]=e.utils.unloaders[a]||[],t.onunload&&e.utils.unloaders[a].push({controller:t,handler:t.onunload}),e.redraw(u,a),e.utils.callLCEvent("didload",e.mod.getState(a),u,a,1),m(a,u,n,e.utils.copy(r))):void 0};var a=function(t,n){return 0>n||n!=e.utils.items.getItem(t)?t==e.mod.getId(n)?!0:!1:!0},u=[];e.begin=function(e){n===u[e]?u[e]=1:u[e]++},e.end=function(t){if(1<u[t])u[t]--;else{u[t]=0;var n=e.utils.items.getItemVal(t);e.redraw(i(n),t)}};var l=[];e.redraw=function(t,i,r){if(!u[i]){if(!t||n===i)throw Error("Mag.JS - Id or node invalid: "+e.utils.items.getItemVal(i));a(t.id,i)&&(r&&e.fill.configs.splice(0,e.fill.configs.length),r&&e.mod.clear(i),t=p(t,i,r),cancelAnimationFrame(l[i]),l[i]=requestAnimationFrame(t))}},e.hookin=function(e,t,n){r[e].push({context:{},handler:n,key:t})},e.hook=function(t,n,i){for(var o=0,a=r[t].length;a>o;o++)e.utils.callHook(r,n,t,o,i)};var d={},c=[],f=function(t,n){e.utils.onLCEvent("didupdate",t,function(r,o){var a=e.utils.merge(e.utils.copy(o),e.utils.copy(r));JSON.stringify(a)!==JSON.stringify(c[t])&&(n(r,o,i(e.mod.getId(t)),c[t]),c[t]=a)})},s=[],g=function(t,n,i,r,o){n=e.utils.items.getItem(n),e.mod.submodule(t.id,n,r,i),e.utils.callLCEvent("willgetprops",e.mod.getState(n),t,n,0,i)||(v(n,t.id),e.redraw(t,n,o))},m=function(t,n,i,r){return s[t]=s[t]||[],i=function(t,n,i,r,o){"object"==typeof o&&(r=e.utils.merge(e.utils.copy(r)||{},o),o=0),o=n.id+(r.key?"."+r.key:"")+"."+(o||0);var a=d[o]||{};return a.id=o,e.utils.items.isItem(o)?(g(a,o,r,i),a):(d[o]=a=n.cloneNode(1),a.id=o,a instanceof HTMLElement?(n=e.utils.getItemInstanceId(a.id),s[t].push({instanceId:n,subscribe:f.bind({},n)}),g(a,o,r,i,1),a):void 0)}.bind({},t,n,i,r),i.clones=function(e){return s[e]}.bind({},t),i.getId=function(e){return e}.bind({},t),i.draw=function(t,n,i){e.redraw(t,n,i)}.bind({},n,t),i.getState=function(t,n){return e.mod.getState(n||t)}.bind({},t),i.getProps=function(t,n){return e.mod.getProps(n||t)}.bind({},t),i.subscribe=f.bind({},t),i},v=function(t,n){var r=function(t,n){i(n)?e.redraw(i(n),t):e.utils.items.isItem(n)&&e.clear(t)}.bind({},t,n);e.mod.setFrameId(t,r)};e.clear=function(t){cancelAnimationFrame(l[t]),e.utils.items.removeItem(t),e.mod.clear(t),e.fill.clearCache(e.mod.getId(t))};var p=function(t,r,o){return function(t,r,o){if(i(t.id,1),a(t.id,r)&&t){var u=e.mod.getState(r);if(!e.utils.callLCEvent("isupdate",u,t,r)){if(e.mod.iscached(r)&&!o)t=0;else{if(!e.utils.callLCEvent("willupdate",u,t,r)){e.mod.callView(t,r),e.fill.setId(t.id),e.fill.run(t,u),o=t.id;var l,d=e.fill.configs;for(l in d)-1<l.indexOf('id("'+o+'")/')&&d[l]();l=t.id;for(var c in e.fill.cached)-1<c.indexOf('id("'+l+'")/')&&-1<c.indexOf("-config")&&e.fill.cached[c].configContext&&(e.utils.unloaders[r]=e.utils.unloaders[r]||[],e.utils.unloaders[r].push({controller:e.fill.cached[c].configContext,handler:e.fill.cached[c].configContext.onunload}));e.utils.callLCEvent("didupdate",u,t,r),e.mod.iscached(r)}t=n}return t}}}.bind({},t,r,o)};e.getNode=i,window.mag=e}(window.mag||{},document),function(e){function t(t,n){var i=t.name;if(void 0===t.object[t.name]){var r,o=e.fill.find(n,i),i="$"===i[0],a=[];return o.reverse().forEach(function(e){e&&(e.value&&0<e.value.length?(r=e.value,!e.type||"checkbox"!=e.type&&"radio"!=e.type||(r={_value:r},e.checked&&(r._checked=!0),a.push(r))):e.innerText&&0<e.innerText.length?r=e.innerText:e.innerHTML&&0<e.innerHTML.length?r=e.innerHTML:e.value||"INPUT"!=e.tagName||(r=""))}),0<a.length&&i?a:r}}function n(n,i){var l;if("undefined"!=typeof Proxy){l=function(n,i,l){var d=JSON.stringify(l.object),c=String(l.name);if(d!==a[i+c]){if(a[i+c]=d,"get"!=l.type||"props"==n||~e.fill.ignorekeys.indexOf(String(l.name))||void 0!==l.oldValue||0!==Object.keys(l.object).length)"set"==l.type&&l.oldValue&&"function"==typeof l.oldValue.draw&&l.object[l.name]&&!l.object[l.name].draw&&(n=l.oldValue.getId(),e.utils.callLCEvent("onunload",e.mod.getState(n),e.getNode(e.mod.getId(n)),n),e.clear(n),l.oldValue.clones().length=0);else if(n=t(l,e.doc.getElementById(r.getId(i))),void 0!==n)return u[i]=0,n;n=r.getFrameId(i),"function"==typeof n&&"set"==l.type&&(cancelAnimationFrame(o[i]),o[i]=requestAnimationFrame(n))}};var d=r.getProps(i),d=e.proxy(d,l.bind({},"props",i));r.setProps(i,d),l=e.proxy({},l.bind({},"state",i)),l=new n(l)}else l=new n({});return l}var i=[],r={cache:[],getState:function(e){return i[e][1]},setState:function(e,t){i[e][1]=t},getView:function(e){return i[e][0]},getProps:function(e){return i[e][2]},setProps:function(e,t){return i[e][2]=t},remove:function(e){i.splice(e,1)},getId:function(e){return i[e]&&i[e][3]},exists:function(e){return void 0!==i[e]?!0:!1},setFrameId:function(e,t){i[e][4]=t},getFrameId:function(e){return i[e][4]},submodule:function(e,t,o,a){return i[t]?(r.setProps(t,a),i[t]):(i[t]=[0,0,0,0,0],r.setProps(t,a),a=function(e,t,n){o.view.call(o,t,r.getProps(e),n)}.bind({},t),i[t][0]=a,i[t][3]=e,i[t][1]=n(function(e){return(o.controller||function(){}).call(e,r.getProps(t))||e},t,e),i[t])}},o=[],a=[];r.iscached=function(t){var n=e.utils.merge(e.utils.copy(r.getProps(t)),r.getState(t));return r.cache[t]&&r.cache[t]===JSON.stringify(n)?!0:void(r.cache[t]=JSON.stringify(n))},r.clear=function(e){e>-1&&r.cache[e]&&r.cache.splice(e,1)};var u=[];r.callView=function(t,n){var i=r.getView(n);u[n]||(e.props.attachToArgs(n,r.getState(n),t),u[n]=1),i(r.getState(n),t)},e.mod=r}(window.mag||{}),function(e){function t(e){for(var t in e)if(e[t]&&-1!==["INPUT","SELECT","TEXTAREA"].indexOf(e[t].tagName))return e[t];return!1}var n={},i=function(t,n){for(var i=1;i<t.length;i+=2){var r=t[i+1];n=e.fill.find(n,t[i]),n=n[r]}return n},r=function(n,r,o,a){return o=(""+o).split("."),3>o.length?(o=parseInt(o.pop()),o=isNaN(o)?0:o,r=e.fill.find(a[o]?a[o]:a,r)):(a=i(o,a),r=e.fill.find(a,r)),(r=t(r))&&!r.eventOnFocus&&(o=-1<["radio","checkbox"].indexOf(r.type),a=function(t,i){this.__magnum__=this.__magnum__||{},this.__magnum__.dirty||(this.__magnum__.dirty=1),i&&(n._checked=this.checked,e.redraw(t,e.utils.items.getItem(t.id),1))}.bind(r,a,o),o?r.addEventListener("click",a,!1):r.addEventListener("focus",a,!1),r.eventOnFocus=1),r},o=function(n,i,o,a){var u=o[i];"_value"===i&&(i=n.split(".").pop());var l=e.fill.find(a,i),l=t(l);if("function"!=typeof u&&l){var d=r.bind({},o,i,n,a);d(),Object.defineProperty(o,i,{configurable:!0,get:function(){var t=d();return t&&"undefined"!==t.value&&t.__magnum__&&t.__magnum__.dirty&&t.value!==u?(u=t.value,e.redraw(a,n,1),t.value):u},set:function(e){var t=d();t&&"undefined"!==t.value&&t.value!==e&&e!==u&&(t.value=e,u=e)}})}},a=function(e,t,n){for(var i in t){var r=t[i];"object"==typeof r?a(e+"."+i,r,n):o.bind({},e,i,t,n)()}};n.attachToArgs=a,e.props=n}(window.mag||{},window),function(e){var t={callHook:function(e,t,n,i,r,o){r.change=!1,e[n][i].key==t&&(o=JSON.stringify({v:r.value,k:r.key}),e[n][i].handler.call(e[n][i].context,r),o!==JSON.stringify({v:r.value,k:r.key})&&(r.change=!0))},unloaders:[]},n=[];t.onLCEvent=function(e,t,i){n[e+"-"+t]=i},t.callLCEvent=function(i,r,o,a,u,l){var d=!1,c={preventDefault:function(){d=!0}};if(r&&r[i]&&(r[i].call(r,c,o,e.mod.getProps(a),a,l),u&&(r[i]=0)),n[i+"-"+a]&&n[i+"-"+a](e.mod.getState(a),e.mod.getProps(a)),d)for(i=0,r=t.unloaders[a];a=r&&r[i];i++)a.controller.onunload&&(a.handler.call(a.controller,o),a.controller.onunload=0);return d},t.copy=function(e){return Object.assign({},e)},t.merge=function(e,t){return Object.assign(e,t)};var i={i:[],isItem:function(e){return-1<i.i.indexOf(e)},setItem:function(e){i.i[i.i.length]=e},getItem:function(e){return i.i.indexOf(e)},getItemVal:function(e){return i.i[e]},removeItem:function(e){i.i.splice(i.i.indexOf(e),1)}};t.items=i,t.getItemInstanceIdAll=function(){return i.i},t.getItemInstanceId=function(e){return i.isItem(e)?i.getItem(e):(i.setItem(e),i.getItem(e))},e.utils=t}(window.mag||{}),function(e,t,n){function i(e){return Array.isArray&&Array.isArray(e)||"[object Array]"==={}.toString.call(e)}function r(e,t){return e[_]=e[_]||{},(!e[_].uid||t)&&(e[_].uid=performance.now()),e[_].uid}function o(e,t){var n=r(e,t);if(O[n])n=O[n];else{var i,o=O,a="";i=u(e);var l=e.parentNode&&[].indexOf.call(e.parentNode.children,e);i&&(a+='id("'+i.id+'")'),i=a+("/"+e.tagName+"["+(l+1)+"]"),n=o[n]=i}return n}function a(e,t,i){return e=r(e,i),S[x.id]=S[x.id]||[],S[x.id][e]&&S[x.id][e]==t?1:(S[x.id][e]=t,n)}function u(e){return e.id?e:e.parentNode?u(e.parentNode):n}function l(t){if(""!==t.id)return'id("'+t.id+'")';if(t===e.doc.body)return t.tagName;var n=0;if(t.parentNode)for(var i=t.parentNode.childNodes,r=0;r<i.length;r++){var o=i[r];if(o===t)return l(t.parentNode)+"/"+t.tagName+"["+(n+1)+"]";1===o.nodeType&&o.tagName===t.tagName&&n++}}function d(e){var t=l(e);e.parentNode.removeChild(e),k[t+"-config"]&&k[t+"-config"].configContext&&typeof k[t+"-config"].configContext.onunload===C&&k[t+"-config"].configContext.onunload(k[t+"-config"].configContext,e,t)}function c(e){return(e=e&&parseInt(e.split("[").pop().slice(0,-1)))?parseInt(e)-1:0}function f(e){return e&&e[_]&&e[_].isChildOfArray?e:e.parentNode?f(e.parentNode):n}function s(t,n,i){if(!a(t,n.outerHTML,i)&&!e.doc.getElementById(n.id)){for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(n)}}function g(t,r,o){var a,u=c(o);if(r&&r.nodeType==N)return s(t,r),n;if("function"==typeof r){var l=(a=f(t.parentNode))&&a.getAttribute("key");return a&&l&&(u=+l.split(_)[1]),(l=r(u))&&l.nodeType&&l.nodeType==N?(s(t,l),t[_]=t[_]||{},t[_].isChildOfArray=!0,t[_].dataPass={index:u},r.draw(),n):(r=/<[a-z][\s\S]*>/i.test(l)?"_html":"_text",u={},u[r]=l,g(t,u,o))}if("object"!=typeof r)return g(t,{_text:r},o);for(l in r)u=r[l],u===n?u="":null===u&&-1===["onunload"].indexOf(l)?(t[_].detached=t[_].detached||[],t[_].detached[l]=1,v(t,l)):t[_].detached&&t[_].detached[l]&&(m(t,l),t[_].detached[l]=0),"_"===l[0]&&(a=a||{},a[l.substr(1)]=u);a&&y(t,a,o);for(l in r)if(u=r[l],!~x.ignorekeys.indexOf(l)&&"_"!==l[0]){a=w(t,l);var d={key:l,value:u,node:t};e.hook("values","*",d),d.change&&(u=d.value),i(u)&&(a=w(t,"$"+l)),x.run(a,u,o+"/"+l)}}function m(e,t){w(e,t).forEach(function(e){var t=r(e);if(E[t]){for(var n in E[t])e.appendChild(E[t][n]);delete E[t]}})}function v(e,t){w(e,t).forEach(function(e){var t=r(e);for(e.children.length&&(E[t]=p(e.children));e.lastChild;)d(e.lastChild)})}function p(e){var t;if(null==e.length&&(e=[e]),!i(e)){t=[];for(var n=0;n<e.length;n+=1)e[n]&&t.push(e[n]);e=t}return e}function h(t,n,i){return function(t,n,i){var r=f(n),a=r&&l(r),u=c(a),d=o(n),s=c(d),r={path:a,data:((r||{})[_]||[]).dataPass,node:r,index:u},d=d&&-1<d.indexOf("id(")&&d.split('id("')[1].split('")')[0],a=e.doc.getElementById(d);return t=t.call(n,i,s,n,r),e.redraw(a,e.utils.items.getItem(d)),t}.bind({},n[i],t)}function y(n,i,r){var o,a=c(r);for(o in i)if("text"!==o&&"html"!==o)if(0==o.indexOf("on"))n[o.toLowerCase()]=h(n,i,o);else if("config"==o){r=l(n);var a=c(r),u=!0;k[r+"-config"]?u=!1:k[r+"-config"]={};var d=k[r+"-config"].configContext=k[r+"-config"].configContext||{};t[r]=function(e,t){return function(){return e.apply(e,t)}}(i[o],[n,u,d,a])}else r={key:o,value:i[o],node:n},e.hook("attributes",o,r),r.change&&(o=r.key,i[o]=r.value),null===i[o]?n.removeAttribute(o):(o in n&&(n[o]=i[o]),n.setAttribute(o,""+i[o]));b(n,i.text),I(n,i.html)}function b(e,t){var n,i;if(e&&null!=t&&!a(e,t)){if(!i){i=[];for(var r=0;r<e.childNodes.length;r+=1)n=e.childNodes[r],n.nodeType===N&&i.push(n)}for(;e.lastChild;)e.removeChild(e.lastChild);for("INPUT"===e.nodeName?e.value=""+t:e.appendChild(e.ownerDocument.createTextNode(""+t)),r=0;r<i.length;r+=1)e.appendChild(i[r]);"SELECT"===e.nodeName&&(e.value=""+t)}}function I(e,t){e&&null!=t&&!a(e,t)&&(e.innerHTML=t)}function w(t,n,i){var r=[];if(t){var o=t.childNodes;if(o)for(var a=0;a<o.length;a+=1)o[a].nodeType===N&&r.push(o[a])}var o=[],a=n,u="$"===n[0];"$"===a[0]&&(a=a.substr(1));for(var l=0;l<r.length;l+=1){var d=r[l],c=a,f=" "+d.className+" ";(d.id===c||-1<f.indexOf(" "+c+" ")||d.name===c||d.nodeName.toLowerCase()===c.toLowerCase()||d.getAttribute("data-bind")===c)&&o.push(r[l])}if(!o.length||u)for(l=0;l<r.length&&(o=o.concat(w(r[l],n,!0)),!o.length||u);l++);return i||o.length||(t={key:n,value:o,node:t},e.hook("elementMatcher",n,t),t.change&&(o=t.value)),o}var x={ignorekeys:"willgetprops Symbol(Symbol.toStringTag) nodeType toJSON onunload onreload willupdate didupdate didload willload isupdate".split(" ")},N=1,k=[],_="__magnum__",C="function",O=[],S=[],T={};x.run=function(e,t,r){var a,u,l;if(e){null==t&&(t={_text:""});var c=p(e);if(l=i(t)){if(T[r]&&0===c.length&&(T[r].parent.insertAdjacentHTML("beforeend",T[r].node),c=p(T[r].parent.children)),0===c.length)return;for(u=c[0].parentNode,T[r]||(T[r]={node:c[0].cloneNode(1).outerHTML,parent:u});c.length<t.length;)T[r]?(u.insertAdjacentHTML("beforeend",T[r].node),a=u.lastChild):a=c[0].cloneNode(1),c.push(a),u&&u.appendChild(a);if(c.map(function(e){return e.__key}),r=t.map(function(e){return e&&e._key}),(c.length==t.length||-1!==r.indexOf(n))&&(t=t.map(function(e,t){if("object"==typeof e){if(c[t].__key&&void 0===e._key)return e._key=c[t].__key,e;void 0===e._key&&(e._key=_+t),c[t].__key=e._key}return e})),c.length>t.length)if(0===t.length||"object"!=typeof t[0])for(;c.length>t.length;)a=c.pop(),(u=a.parentNode)&&d(a);else var f=[],s=t.map(function(e){return e._key}),c=(c.map(function(e){return e.__key}),c.filter(function(e){return-1===s.indexOf(e.__key)||-1!==f.indexOf(e.__key)?(f.push(e.__key),d(e),!1):(f.push(e.__key),!0)}))}for(r=0;r<c.length;r++)l?c[r]&&x.run(c[r],t[r]):(t&&"object"==typeof t&&-1!==Object.keys(t).indexOf("_key")&&(c[r][_]=c[r][_]||{},c[r][_].isChildOfArray=!0,c[r][_].dataPass=t),a=o(c[r]),g(c[r],t,a));return e}};var E=[],u=function(e){return e.id?e:e.parentNode?u(e.parentNode):n};x.configs=t,x.find=w,x.setId=function(e){x.id=e},x.clearCache=function(e){S[e]&&delete S[e]},e.fill=x}(window.mag||{},[]),function(e,t){function n(t,n){var i=[];return new Proxy(t,{get:function(t,r){var o=t[r],a=n({type:"get",object:e.utils.copy(t[r]),name:r,oldValue:i[r]});return void 0!==a&&(o=t[r]=a),o},deleteProperty:function(e,t){return n({type:"delete",name:t,object:e,oldValue:i[t]}),delete e[t]},set:function(t,r,o){return JSON.stringify(o)!==JSON.stringify(t[r])&&(i[r]=e.utils.copy(t[r])),n({type:"set",name:r,object:t,oldValue:i[r]}),t[r]=o,!0}})}function i(e,t){for(var i in e)Array.isArray(e[i])&&101>e[i].length&&(e[i]=n(e[i],t));return n(e,t)}e.proxy=function(n,r){return n&&t.Proxy?i(n,function(t){return"object"==typeof t.object[t.name]&&(t.object[t.name]=e.proxy(t.object[t.name],r)),r(t)}):void 0}}(window.mag||{},window);

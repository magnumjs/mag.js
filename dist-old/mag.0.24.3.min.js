/*
Mag.JS v0.24.3
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,t,n){function i(e,t){if(a[e]&&!t)return a[e];var n=mag.doc.getElementById(e);return n&&(a[e]=n),a[e]}e.mag={},mag.doc=t;var o={values:[],attributes:[],elementMatcher:[]},a=[];mag.create=function(e,t,n){return function(i,o){return"string"!=typeof i&&(o=i,i=0),mag.module(i||e,t,mag.utils.merge(n||{},o||{}))}},mag.module=function(e,t,n){n=n||{},e instanceof HTMLElement&&(e.id||(e.id=performance.now()),a[e.id]=e,e=e.id);var o;if(!(o=!mag.utils.items.isItem(e))){o=mag.utils.items.getItem(e);var r=i(e);o=!mag.utils.callLCEvent("onreload",mag.mod.getState(o),r,o)}return o&&(o=n.key&&mag.utils.items.isItem(e+"."+n.key)?mag.utils.items.getItem(e+"."+n.key):mag.utils.getItemInstanceId(n.key?e+"."+n.key:e),n.retain||mag.mod.clear(o),mag.mod.submodule(e,o,t,n),r=i(e),v(o,e),!mag.utils.callLCEvent("willload",mag.mod.getState(o),r,o,1))?(mag.redraw(r,o,1),mag.utils.callLCEvent("didload",mag.mod.getState(o),r,o,1),s(o,r,t,mag.utils.copy(n))):void 0};var r=function(e,t){return 0>t||t!=mag.utils.items.getItem(e)?e==mag.mod.getId(t)?!0:!1:!0},d=[];mag.begin=function(e){n===d[e]?d[e]=1:d[e]++},mag.end=function(e){if(1<d[e])d[e]--;else{d[e]=0;var t=mag.utils.items.getItemVal(e);mag.redraw(i(t),e)}};var l=[];mag.redraw=function(e,t,i){if(!d[t]){if(!e||n===t)throw Error("Mag.JS - Id or node invalid: "+mag.utils.items.getItemVal(t));r(e.id,t)&&(i&&mag.fill.configs.splice(0,mag.fill.configs.length),i&&mag.mod.clear(t),e=p(e,t,i),cancelAnimationFrame(l[t]),l[t]=requestAnimationFrame(e))}},mag.hookin=function(e,t,n){o[e].push({context:{},handler:n,key:t})},mag.hook=function(e,t,n){for(var i=0,a=o[e].length;a>i;i++)mag.utils.callHook(o,t,e,i,n)};var u={},c=[],f=function(e,t){mag.utils.onLCEvent("didupdate",e,function(n,o){var a=mag.utils.merge(mag.utils.copy(o),mag.utils.copy(n));JSON.stringify(a)!==JSON.stringify(c[e])&&(t(n,o,i(mag.mod.getId(e)),c[e]),c[e]=a)})},g=[],m=function(e,t,n,i,o){t=mag.utils.items.getItem(t),mag.mod.submodule(e.id,t,i,n),mag.utils.callLCEvent("willgetprops",mag.mod.getState(t),e,t,0,n)||(v(t,e.id),mag.redraw(e,t,o))},s=function(e,t,n,i){g[e]=g[e]||[];var o=function(e,t,n,i,o){if("object"==typeof o&&(i=mag.utils.merge(mag.utils.copy(i)||{},o),o=0),o=t.id+(i.key?"."+i.key:"")+"."+(o||0),t=u[o]=u[o]||t.cloneNode(1),t.id=o,mag.utils.items.isItem(o))return m(t,o,i,n,1),t;var a=mag.utils.getItemInstanceId(t.id);return g[e].push({instanceId:a,subscribe:f.bind({},a)}),m(t,o,i,n,1),t}.bind({},e,t,n,i);return o.clones=function(e){return g[e]}.bind({},e),o.destroy=function(e,t){var n=mag.getNode(mag.mod.getId(e)),i=function(){if(!mag.utils.callLCEvent("onunload",mag.mod.getState(e),n,e)){mag.clear(e);var i,a=0;i=n.id;var r,d=[];for(r in mag.fill.cached)-1<r.indexOf('id("'+i+'")/')&&-1<r.indexOf("-config")&&mag.fill.cached[r].configContext&&d.push({path:r.split("-config")[0],controller:mag.fill.cached[r].configContext,handler:mag.fill.cached[r].configContext.onunload});for(;i=d&&d[a];a++)i.controller.onunload&&(i.handler.call(i.controller,n,i.path),i.controller.onunload=0);o.clones(e).length=0,t&&mag.fill.removeNode(n)}};mag.mod.getState(e).onbeforeunload?mag.utils.callLCEvent("onbeforeunload",mag.mod.getState(e),n,e,0,function(){i()}):i()}.bind({},e),o.getId=function(e){return e}.bind({},e),o.draw=function(e,t,n){mag.redraw(e,t,n)}.bind({},t,e),o.getState=function(e,t){return mag.mod.getState(t||e)}.bind({},e),o.getProps=function(e,t){return mag.mod.getProps(t||e)}.bind({},e),o.subscribe=f.bind({},e),o},v=function(e,t){var n=function(e,t){i(t)?mag.redraw(i(t),e):mag.utils.items.isItem(t)&&mag.clear(e)}.bind({},e,t);mag.mod.setFrameId(e,n)};mag.clear=function(e){cancelAnimationFrame(l[e]),mag.utils.items.removeItem(e),mag.mod.clear(e),mag.fill.clearCache(mag.mod.getId(e))};var p=function(e,t,o){return function(e,t,o){if(i(e.id,1),r(e.id,t)&&e){var a=mag.mod.getState(t);if(!mag.utils.callLCEvent("isupdate",a,e,t)){if(mag.mod.iscached(t)&&!o)e=0;else{if(!mag.utils.callLCEvent("willupdate",a,e,t)){mag.mod.callView(e,t),mag.fill.setId(e.id),mag.fill.run(e,a);var d,l=e.id,u=mag.fill.configs;for(d in u)d.startsWith('id("'+l+'")/')&&u[d]();mag.utils.callLCEvent("didupdate",a,e,t),o||mag.mod.iscached(t)}e=n}return e}}}.bind({},e,t,o)};mag.getNode=i}(window||global||this,document),function(e){function t(t,n){var i=t.name;if(void 0===t.object[t.name]){var o,a=e.fill.find(n,i),i="$"===i[0],r=[];return a.reverse().forEach(function(e){e&&(e.value&&0<e.value.length?(o=e.value,!e.type||"checkbox"!=e.type&&"radio"!=e.type||(o={_value:o},e.checked&&(o._checked=!0),r.push(o))):e.innerText&&0<e.innerText.length?o=e.innerText:e.innerHTML&&0<e.innerHTML.length?o=e.innerHTML:e.value||"INPUT"!=e.tagName||(o=""))}),0<r.length&&i?r:o}}function n(t,n){var i;return"undefined"!=typeof Proxy?(o.setProps(n,e.proxy(o.getProps(n),d.bind({},"props",n))),i=new t(e.proxy({},d.bind({},"state",n)))):i=new t({}),i}var i=[],o={innerMods:[],cache:[],getState:function(e){return i[e][1]},setState:function(e,t){i[e][1]=t},getView:function(e){return i[e][0]},getProps:function(e){return i[e][2]},setProps:function(e,t){return i[e][2]=t},remove:function(e){i.splice(e,1)},getId:function(e){return i[e]&&i[e][3]},exists:function(e){return void 0!==i[e]?!0:!1},setFrameId:function(e,t){i[e][4]=t},getFrameId:function(e){return i[e][4]},submodule:function(t,a,r,d){return i[a]?(d.key&&d.key===o.getProps(a).key?o.setProps(a,e.utils.copy(e.utils.merge(o.getProps(a),d))):o.setProps(a,d),i[a]):(i[a]=[0,0,0,0,0],o.setProps(a,d),d=function(e,t,n){r.view&&r.view.call(r,t,o.getProps(e),n)}.bind({},a),i[a][0]=d,i[a][3]=t,i[a][1]=n(function(e){return(r.controller||function(){}).call(e,o.getProps(a))||e},a,t),i[a])}},a=[],r=[],d=function(n,i,d){var l=JSON.stringify(d.object),u=String(d.name);if(l!==r[i+u]){if(r[i+u]=l,"get"!=d.type||"props"==n||~e.fill.ignorekeys.indexOf(String(d.name))||void 0!==d.oldValue||0!==Object.keys(d.object).length)"set"==d.type&&"props"!=n&&d.object[d.name]&&d.object[d.name].draw&&"function"==typeof d.object[d.name].draw&&(o.innerMods[o.getId(i)]=[d.name,d.object[d.name]]);else if(n=t(d,e.doc.getElementById(o.getId(i))),void 0!==n)return o.cached[i]=0,n;n=o.getFrameId(i),"function"==typeof n&&"set"==d.type&&(cancelAnimationFrame(a[i]),a[i]=requestAnimationFrame(n))}};o.iscached=function(t){var n=e.utils.merge(e.utils.copy(o.getProps(t)),o.getState(t));return o.cache[t]&&o.cache[t]===JSON.stringify(n)?!0:void(o.cache[t]=JSON.stringify(n))},o.clear=function(e){e>-1&&o.cache[e]&&o.cache.splice(e,1)},o.cached=[],o.callView=function(t,n){o.cached[n]||(e.props.attachToArgs(n,o.getState(n),t),o.cached[n]=1),o.getView(n)(o.getState(n),t)},e.mod=o}(mag),function(e){function t(e){for(var t in e)if(e[t]&&-1!==["INPUT","SELECT","TEXTAREA"].indexOf(e[t].tagName))return e[t];return!1}var n={},i=function(t,n){for(var i=1;i<t.length;i+=2){var o=t[i+1];n=e.fill.find(n,t[i]),n=n[o]}return n},o=function(n,o,a,r){return a=(""+a).split("."),3>a.length?(a=parseInt(a.pop()),a=isNaN(a)?0:a,o=e.fill.find(r[a]?r[a]:r,o)):(r=i(a,r),o=e.fill.find(r,o)),(o=t(o))&&!o.eventOnFocus&&(a=-1<["radio","checkbox"].indexOf(o.type),r=function(t,i){this.__magnum__=this.__magnum__||{},this.__magnum__.dirty||(this.__magnum__.dirty=1),i&&(n._checked=this.checked,e.redraw(t,e.utils.items.getItem(t.id),1))}.bind(o,r,a),a?o.addEventListener("click",r,!1):o.addEventListener("focus",r,!1),o.eventOnFocus=1),o},a=function(n,i,a,r){var d=a[i];"_value"===i&&(i=n.split(".").pop());var l=e.fill.find(r,i),l=t(l);if("function"!=typeof d&&l){var u=o.bind({},a,i,n,r);u(),Object.defineProperty(a,i,{configurable:!0,get:function(){var t=u();return t&&"undefined"!==t.value&&t.__magnum__&&t.__magnum__.dirty&&t.value!==d?(d=t.value,e.redraw(r,n,1),t.value):d},set:function(e){var t=u();t&&"undefined"!==t.value&&t.value!==e&&e!==d&&(t.value=e,d=e)}})}},r=function(e,t,n){for(var i in t){var o=t[i];"object"==typeof o?r(e+"."+i,o,n):a.bind({},e,i,t,n)()}};n.attachToArgs=r,e.props=n}(mag),function(e){var t={callHook:function(e,t,n,i,o,a){e[n][i].key==t&&(a={v:o.value,k:o.key},o.change=!1,e[n][i].handler.call(e[n][i].context,o),a!=={v:o.value,k:o.key}&&(o.change=!0))}},n=[];t.onLCEvent=function(e,t,i){n[e+"-"+t]=i},t.callLCEvent=function(t,i,o,a,r,d){var l=!1,u={preventDefault:function(){l=!0}};return i&&i[t]&&(i[t].call(i,u,o,e.mod.getProps(a),a,d),r&&(i[t]=0)),n[t+"-"+a]&&n[t+"-"+a](e.mod.getState(a),e.mod.getProps(a)),l},t.copy=function(e){return Object.assign({},e)},t.merge=function(){return Object.assign.apply({},arguments)};var i={i:[],isItem:function(e){return-1<i.i.indexOf(e)},setItem:function(e){i.i[i.i.length]=e},getItem:function(e){return i.i.indexOf(e)},getItemVal:function(e){return i.i[e]},removeItem:function(e){i.i.splice(i.i.indexOf(e),1)}};t.items=i,t.getItemInstanceIdAll=function(){return i.i},t.getItemInstanceId=function(e){return i.isItem(e)?i.getItem(e):(i.setItem(e),i.getItem(e))},e.utils=t}(mag),function(e,t,n){function i(e){return Array.isArray&&Array.isArray(e)||"[object Array]"==={}.toString.call(e)}function o(e,t){return e[_]=e[_]||{},(!e[_].uid||t)&&(e[_].uid=performance.now()),e[_].uid}function a(e,t){var n=o(e,t);if(S[n])n=S[n];else{var i,a=S,r="";i=d(e);var l=e.parentNode&&[].indexOf.call(e.parentNode.children,e);i&&(r+='id("'+i.id+'")'),i=r+("/"+e.tagName+"["+(l+1)+"]"),n=a[n]=i}return n}function r(e,t,i){return e=o(e,i),O[C.id]=O[C.id]||[],O[C.id][e]&&O[C.id][e]==t?1:(O[C.id][e]=t,n)}function d(e){return e.id?e:e.parentNode?d(e.parentNode):n}function l(t){if(t.id)return'id("'+t.id+'")';if(t===e.doc.body)return t.tagName;var n=0;if(t.parentNode)for(var i=t.parentNode.childNodes,o=0;o<i.length;o++){var a=i[o];if(a===t)return l(t.parentNode)+(t.tagName?"/"+t.tagName+"["+(n+1)+"]":"");1===a.nodeType&&a.tagName===t.tagName&&n++}}function u(t){var n=l(t);t.parentNode.removeChild(t),t&&k[n+"-config"]&&k[n+"-config"].configContext&&typeof k[n+"-config"].configContext.onunload===w&&(k[n+"-config"].configContext.onunload(k[n+"-config"].configContext,t,n),delete k[n+"-config"],delete e.fill.configs[n])}function c(e){return(e=e&&parseInt(e.split("[").pop().slice(0,-1)))?parseInt(e)-1:0}function f(e){return e&&e[_]&&e[_].isChildOfArray?e:e.parentNode?f(e.parentNode):n}function g(t,n,i){if(!r(t,n.outerHTML,i)&&!e.doc.getElementById(n.id)){for(;t.lastChild;)t.removeChild(t.lastChild);t.appendChild(n)}}function m(t,o,a){var r,d=c(a);if(o&&o.nodeType==N)return g(t,o),n;if("function"==typeof o){var l=(r=f(t.parentNode))&&r.getAttribute("key");return r&&l&&(d=+l.split(_)[1]),(l=o(d))&&l.nodeType&&l.nodeType==N?(g(t,l),t[_]=t[_]||{},t[_].isChildOfArray=!0,t[_].dataPass={index:d},o.draw(),n):(o=/<[a-z][\s\S]*>/i.test(l)?"_html":"_text",d={},d[o]=l,m(t,d,a))}if("object"!=typeof o)return m(t,{_text:o},a);e.mod.innerMods[C.id]&&o[e.mod.innerMods[C.id][0]]&&!o[e.mod.innerMods[C.id][0]].draw&&e.mod.innerMods[C.id][1].destroy();for(l in o)d=o[l],d===n?d="":null===d&&-1===["onunload"].indexOf(l)?(t[_].detached=t[_].detached||[],t[_].detached[l]=1,v(t,l)):t[_].detached&&t[_].detached[l]&&(s(t,l),t[_].detached[l]=0),"_"===l[0]&&(r=r||{},r[l.substr(1)]=d);r&&y(t,r,a);for(l in o)if(d=o[l],!~C.ignorekeys.indexOf(l)&&"_"!==l[0]){r=x(t,l);var u={key:l,value:d,node:t};e.hook("values","*",u),u.change&&(d=u.value),i(d)&&(r=x(t,"$"+l)),C.run(r,d,a+"/"+l)}}function s(e,t){x(e,t).forEach(function(e){var t=o(e);if(L[t]){for(var n in L[t])e.appendChild(L[t][n]);delete L[t]}})}function v(t,n){var i=0,a=1,r=function(e){if(++i===a)for(;e.lastChild;)u(e.lastChild)},d=function(t,n){var i;t.id&&e.utils.items.isItem(t.id)&&(i=e.utils.items.getItem(t.id)),i&&e.mod.getState(i).onbeforeunload?(a++,e.utils.callLCEvent("onbeforeunload",e.mod.getState(i),t,i,0,function(){i&&e.utils.callLCEvent("onunload",e.mod.getState(i),t,i),n()})):(i&&e.utils.callLCEvent("onunload",e.mod.getState(i),t,i),n())};x(t,n).forEach(function(e){var t=o(e);e.children.length&&(L[t]=p(e.children));for(var n in L[t])d(L[t][n],function(){r(e)});r(e)})}function p(e){var t;if(null==e.length&&(e=[e]),!i(e)){t=[];for(var n=0;n<e.length;n+=1)e[n]&&t.push(e[n]);e=t}return e}function h(t,n,i){return function(t,n,i){var o=f(n),r=o&&l(o),d=c(r),u=a(n,1),g=c(u),o={path:r,data:((o||{})[_]||[]).dataPass,node:o,index:d},u=u&&-1<u.indexOf("id(")&&u.split('id("')[1].split('")')[0],r=e.doc.getElementById(u);return t=t.call(n,i,g,n,o),e.redraw(r,e.utils.items.getItem(u)),t}.bind({},n[i],t)}function y(n,i,a){var r=c(a);k[o(n)]=k[o(n)]||[];for(var d in i)if("text"!==d&&"html"!==d)if(0==d.indexOf("on"))n[d.toLowerCase()]=h(n,i,d);else if("config"==d){a=l(n);var r=c(a),u=!0;k[a+"-config"]?u=!1:k[a+"-config"]={};var f=k[a+"-config"].configContext=k[a+"-config"].configContext||{};t[a]=function(e,t){return function(){return e.apply(e,t)}}(i[d],[n,u,f,r])}else a={key:d,value:i[d],node:n},e.hook("attributes",d,a),a.change&&(d=a.key,i[d]=a.value),k[o(n)]&&k[o(n)][d]==i[d]||(null===i[d]?n.removeAttribute(d):d in n?n[d]=i[d]:n.setAttribute(d,i[d]+""),k[o(n)][d]=i[d]);b(n,i.text),I(n,i.html)}function b(e,t){if(e&&null!=t&&!r(e,t)){var n=t+"";"INPUT"===e.nodeName?e.value=n:"SELECT"!==e.nodeName&&(e.firstChild?e.firstChild.textContent=n:e.appendChild(e.ownerDocument.createTextNode(n))),"SELECT"===e.nodeName&&n&&(e.value=n)}}function I(e,t){e&&null!=t&&!r(e,t)&&(e.innerHTML=t)}function x(t,n,i){var o=[];if(t){var a=t.childNodes;if(a)for(var r=0;r<a.length;r+=1)a[r].nodeType===N&&o.push(a[r])}var a=[],r=n,d="$"===n[0];"$"===r[0]&&(r=r.substr(1));for(var l=0;l<o.length;l+=1){var u=o[l],c=r,f=" "+u.className+" ";(u.id===c||-1<f.indexOf(" "+c+" ")||u.name===c||u.nodeName.toLowerCase()===c.toLowerCase()||u.getAttribute("data-bind")===c)&&a.push(o[l])}if(!a.length||d)for(l=0;l<o.length&&(a=a.concat(x(o[l],n,!0)),!a.length||d);l++);return i||a.length||(t={key:n,value:a,node:t},e.hook("elementMatcher",n,t),t.change&&(a=t.value)),a}var C={cached:[],ignorekeys:"willgetprops onbeforeunload Symbol(Symbol.toStringTag) nodeType toJSON onunload onreload willupdate didupdate didload willload isupdate".split(" ")},N=1,k=C.cached,_="__magnum__",w="function",S=[],O=[],E={};C.run=function(t,o,r){var d,l,c;if(t){null==o&&(o={_text:""});var f=p(t);if(c=i(o)){if(E[r]&&0===f.length&&(E[r].parent.insertAdjacentHTML("beforeend",E[r].node),f=p(E[r].parent.children)),0===f.length)return;for(l=f[0].parentNode,E[r]||(E[r]={node:f[0].cloneNode(1).outerHTML,parent:l}),f.length!=o.length&&(e.mod.cached[e.utils.items.getItem(C.id)]=0);f.length<o.length;)E[r]?(l.insertAdjacentHTML("beforeend",E[r].node),d=l.lastChild):d=f[0].cloneNode(1),f.push(d),l&&l.appendChild(d);if(r=o.map(function(e){return e&&e._key}),(f.length==o.length||-1!==r.indexOf(n))&&(o=o.map(function(e,t){return"object"==typeof e&&(f[t].__key=e._key=_+t),e})),f.length>o.length)if(0===o.length||"object"!=typeof o[0])for(;f.length>o.length;)d=f.pop(),(l=d.parentNode)&&u(d);else var g=[],s=o.map(function(e){return e._key}),f=f.filter(function(e){return-1===s.indexOf(e.__key)||-1!==g.indexOf(e.__key)?(g.push(e.__key),u(e),!1):(g.push(e.__key),!0)})}for(r=0;r<f.length;r++)c?f[r]&&C.run(f[r],o[r]):(o&&"object"==typeof o&&-1!==Object.keys(o).indexOf("_key")&&(f[r][_]=f[r][_]||{},f[r][_].isChildOfArray=!0,f[r][_].dataPass=o),d=a(f[r]),m(f[r],o,d));return t}};var L=[];C.removeNode=u,C.configs=t,C.find=x,C.setId=function(e){C.id=e},C.clearCache=function(e){O[e]&&delete O[e]},e.fill=C}(mag,[]),function(e,t){function n(t,n){var i=[];return new Proxy(t,{get:function(t,o){var a=t[o],r=n({type:"get",object:e.utils.copy(t[o]),name:o,oldValue:i[o]});return void 0!==r&&(a=t[o]=r),a},deleteProperty:function(e,t){return n({type:"delete",name:t,object:e,oldValue:i[t]}),delete e[t]},set:function(t,o,a){return i[o]===a?!0:(JSON.stringify(a)!==JSON.stringify(t[o])&&(i[o]=e.utils.copy(t[o])),n({type:"set",name:o,object:t,oldValue:i[o]}),t[o]=a,!0)}})}function i(e,t){for(var i in e)Array.isArray(e[i])&&101>e[i].length&&(e[i]=n(e[i],t));return n(e,t)}e.proxy=function(n,o){return n&&t.Proxy?i(n,function(t){return"object"==typeof t.object[t.name]&&(t.object[t.name]=e.proxy(t.object[t.name],o)),o(t)}):void 0}}(mag,window||global||this);

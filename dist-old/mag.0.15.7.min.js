/*
Mag.JS v0.15.7
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,n,t,r){function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){if(""!==e.id)return'id("'+e.id+'")';if(e===t.body)return e.tagName;var n=0;if(e.parentNode)for(var r=e.parentNode.childNodes,o=0;o<r.length;o++){var l=r[o];if(l===e)return i(e.parentNode)+"/"+e.tagName+"["+(n+1)+"]";1===l.nodeType&&l.tagName===e.tagName&&n++}}function l(e){var n=i(e);e.parentNode.removeChild(e),w[n+"-config"]&&w[n+"-config"].configContext&&typeof w[n+"-config"].configContext.onunload===N&&w[n+"-config"].configContext.onunload(w[n+"-config"].configContext,e,n)}function a(e){return(e=e&&parseInt(e.split("[").pop().slice(0,-1)))?parseInt(e)-1:0}function c(e,n,t){var a,u,s;if(e){null==n&&(n={_text:""});var h=d(e);if(s=o(n)){if(x[t]&&0===h.length&&(x[t].parent.insertAdjacentHTML("beforeend",x[t].node),h=d(x[t].parent.children)),0===h.length)return r;for(u=h[0].parentNode,x[t]||(x[t]={node:h[0].cloneNode(!0).outerHTML,parent:u});h.length<n.length;)x[t]?(u.insertAdjacentHTML("beforeend",x[t].node),a=u.lastChild):a=h[0].cloneNode(!0),h.push(a),u&&u.appendChild(a);if(h.map(function(e){return e.__key}),t=n.map(function(e){return e[b]}),(h.length==n.length||-1!==t.indexOf(r))&&(n=n.map(function(e,n){if("object"==typeof e){if(h[n].__key&&typeof e[b]===C)return e[b]=h[n].__key,e;typeof e[b]===C&&(e[b]=_+n),h[n].__key=e[b]}return e})),h.length>n.length)if(0===n.length||"object"!=typeof n[0])for(;h.length>n.length;)a=h.pop(),(u=a.parentNode)&&l(a);else var p=[],g=n.map(function(e){return e[b]}),h=(h.map(function(e){return e.__key}),h.filter(function(e){return-1===g.indexOf(e.__key)||-1!==p.indexOf(e.__key)?(p.push(e.__key),l(e),!1):(p.push(e.__key),!0)}))}for(t=0;t<h.length;t++)i(h[t]),s?h[t]&&c(h[t],n[t]):(n&&"object"==typeof n&&-1!==Object.keys(n).indexOf(b)&&(h[t][_]=h[t][_]||{},h[t][_].isChildOfArray=!0,h[t][_].dataPass=n),f(h[t],n));return e}}function u(e){return e.parentNode&&e.parentNode[_]&&e.parentNode[_].isChildOfArray?e.parentNode:e.parentNode?u(e.parentNode):r}function f(e,n){var t,a;if(typeof n!==N||typeof n()._html===N){if("object"!=typeof n&&typeof n===N&&typeof n()._html===N)return f(e,{_html:n()._html});if("object"!=typeof n)return f(e,{_text:n});for(var u in n){var d=n[u];d===r?d="":null===d&&-1===["onunload"].indexOf(u)&&v(e,u).forEach(function(e){l(e)}),"_"===u[0]&&(t=t||{},t[u.substr(1)]=d)}var h=i(e);t&&s(e,t),t=0;var p=["willupdate","didupdate","didload","willload","isupdate"];for(u in n)-1===p.indexOf(u)&&(d=n[u],"_"!==u[0]&&(a=v(e,u),typeof d===N&&"fun"==d.type&&(d=d()),o(d)&&(a=v(e,"$"+u)),c(a,d,h+"/"+u),t++))}}function d(e){var n;if(null==e.length&&(e=[e]),!o(e)){n=[];for(var t=0;t<e.length;t+=1)e[t]&&n.push(e[t]);e=n}return e}function s(t,r){var o,l=i(t),c=a(l);for(o in r)if("text"!==o&&"html"!==o)if(0==o.indexOf("on")){var f=function(n,t,r){var o=u(t),l=o&&i(o),c=a(l),f=i(t),f=a(f);return n=n.call(t,r,f,t,{path:l,data:((o||{})[_]||[]).dataPass,node:o,index:c}),e.redraw(),n}.bind({},r[o],t);t[o]=f}else if("config"==o){f=!0,w[l+"-config"]?f=!1:w[l+"-config"]={};var d=w[l+"-config"].configContext=w[l+"-config"].configContext||{};n.push(function(e,n){return function(){return e.apply(e,n)}}(r[o],[t,f,d,c]))}else f={key:o,value:r[o],node:t},e.hook("attributes",o,f),f.change&&(o=f.key,r[o]=f.value),null===r[o]?t.removeAttribute(o):t.setAttribute(o,""+r[o]);h(t,r.text),g(t,r.html,c,l&&l&&l.split('id("')[1].split('")')[0])}function h(e,n){var t,r;if(e&&null!=n){if(!r){r=[];for(var o=0;o<e.childNodes.length;o+=1)t=e.childNodes[o],t.nodeType===y&&r.push(t)}for(;e.firstChild;)e.removeChild(e.firstChild);for("INPUT"===e.nodeName?e.setAttribute("value",""+n):e.appendChild(e.ownerDocument.createTextNode(""+n)),o=0;o<r.length;o+=1)e.appendChild(r[o]);"SELECT"===e.nodeName&&(e.value=""+n)}}function p(e,n,t){if(e.cloner){k[e.id]=[n+1,t],t=_+e.id.split(_).pop();var r;r=e.id,r=-1!==r.indexOf(n,r.length-n.length),e.id=t+(r?"":n)}}function g(e,n,t,r){e&&null!=n&&(typeof n===N&&1===n().nodeType?(n=n(),p(n,t,r),e.firstChild?e.replaceChild(n,e.firstChild):e.appendChild(n)):1===n.nodeType?(p(n,t,r),e.firstChild?e.replaceChild(n,e.firstChild):e.appendChild(n)):e.innerHTML=n)}function v(n,t,r){var o=[];if(n){var i=n.childNodes;if(i)for(var l=0;l<i.length;l+=1)i[l].nodeType===y&&o.push(i[l])}var i=[],l=t,a="$"===t[0];"$"===l[0]&&(l=l.substr(1));for(var c=0;c<o.length;c+=1){var u=o[c],f=l,d=" "+u.className+" ";(u.id===f||-1<d.indexOf(" "+f+" ")||u.name===f||u.nodeName.toLowerCase()===f.toLowerCase()||u.getAttribute("data-bind")===f)&&i.push(o[c])}if(!i.length||a)for(c=0;c<o.length&&(i=i.concat(v(o[c],t,!0)),!i.length||a);c++);return r||i.length||(n={key:t,value:i,node:n},e.hook("elementMatcher",t,n),n.change&&(i=n.value)),i}function m(e,n){if(n={tag:e.tagName},n.children=[],e.firstChild||e.children[0]){var t=e.firstChild||e.childNodes[0];(t=t.nodeValue||t.value||t.innerText)&&(t=t.replace(/\u00a0/g,"x").trim()),t&&n.children.push(t)}for(t=0,n.attrs={},t;t<e.attributes.length;t++)n.attrs[e.attributes[t].name]=e.attributes[t].value;var r=e.children;if(r.length)for(t=0;t<r.length;t++)n.children.push(m(r[t],n.children));return n}var y=1,w=[],_="__magnum__",N="function",C="undefined",b="_key",x={},k=[];e.fill={fill:c,count:k,elementToObject:m,cached:w,find:v,configs:n},window.mag=e}(window.mag||{},[],document),function(e){function n(e){for(var n in e)if(e[n]&&-1!==["INPUT","SELECT","TEXTAREA"].indexOf(e[n].tagName))return e[n];return!1}function t(n,r,o){for(var i in r){var a=r[i];Array.isArray(a)&&a[0]&&!a[0].__$$i&&void 0!==a[0].then&&"fun"!=typeof a[0].type?(a[0].__$$i=1,Promise.all(a).then(function(n,t,r){r&&(0==a[0].__$$i,n[t]=r,e.redraw())}.bind(this,r,i))):"object"!=typeof a||a&&void 0!==a.then?(!a||Array.isArray(a)||a.__$$i||void 0===a.then||"fun"==typeof a.type||(a.__$$i=1,a.then(function(n,t,r){r&&(n[t].__$$i=0,n[t]=r,e.redraw())}.bind(this,r,i))),l(n,i,r,o)):t(n+"."+i,a,o)}}var r={modules:[],promises:[],deferreds:[],controllers:[],elements:[],getController:function(e,n){return this.controllers[e]?this.controllers[e]:new n.controller},submodule:function(e,n){var t=function(){return(e.controller||function(){}).apply(this,n)||this},r={controller:t,view:function(t){if(1<arguments.length)var r=n.concat([].slice.call(arguments,1));e.view.apply(e,r?[t].concat(r):[t])}};return t.$$args=n,r},getArgs:function(e){var n=r.modules[e]&&r.modules[e].controller&&r.modules[e].controller.$$args?[r.controllers[e]].concat(r.modules[e].controller.$$args):[r.controllers[e]];return t(e,n[0],this.elements[e]),n}},o=function(n,t){for(var r=1;r<n.length;r+=2){var o=n[r+1];t=e.fill.find(t,n[r]),t=t[o]}return t},i=function(t,r,i,l){return t=(""+i).split("."),3>t.length?(t=parseInt(t.pop()),t=isNaN(t)?0:t,r=e.fill.find(l[t]?l[t]:l,r)):(l=o(t,l),r=e.fill.find(l,r)),(r=n(r))&&!r.eventOnFocus&&(r.addEventListener("focus",function(){this.classList.contains("mag-dirty")||this.classList.add("mag-dirty")},!1),r.eventOnFocus=!0),r},l=function(t,r,o,l){var a=o[r];"_value"===r&&(r=t.split(".").pop());var c=e.fill.find(l,r),c=n(c);if("function"!=typeof a&&c){var u=i.bind({},o,r,t,l);u(),Object.defineProperty(o,r,{configurable:!0,get:function(){var e=u();return e&&"undefined"!==e.value&&e.classList.contains("mag-dirty")&&e.value!==a?(a=e.value,e.value):a},set:function(e){var n=u();n&&"undefined"!==n.value&&n.value!==e&&e!==a&&(n.value=e,a=e)}})}};e.mod=r}(window.mag||{}),function(e){var n={roots:[],contexts:[],templates:{},unloaders:[],cache:{},callLCEvent:function(e,t,r,o){var i=!1,l={preventDefault:function(){i=!0}};if(t.controllers[r]&&t.controllers[r][e]&&(t.controllers[r][e].call({},l,t.elements[r]),o&&(t.controllers[r][e]=0)),i)for(o=0;e=n.unloaders[o];o++)e.controller.onunload&&(e.handler.call(e.controller,t.elements[r]),e.controller.onunload=0);return i},callConfigs:function(e){for(var n=0,t=e.length;t>n;n++)e[n]()},redraw:function(e,t,r){e=e||n.module||{},r&&(n.cache={}),this.fun=this.fun||o(function(){t.configs.splice(0,t.configs.length),n.doLoop(e,t)}),this.fun()},doLoop:function(t,r){for(var o=0;n.roots[o];o++)if(t.controllers[o]&&t.elements[o]){if(n.callLCEvent("willload",t,o,1))break;if(n.innerLoop(t,r,o)){t.deferreds[o][1]({_html:e.prop(t.elements[o])}),n.callLCEvent("didload",t,o,1),n.callConfigs(r.configs);var i=t,l=r,a=o,c=void 0;for(c in l.cached)-1!==c.indexOf('id("'+i.elements[a].id+'")/')&&-1!==c.indexOf("-config")&&l.cached[c].configContext&&n.unloaders.push({controller:l.cached[c].configContext,handler:l.cached[c].configContext.onunload})}}},clear:function(e){-1!==e&&n.cache[e]&&delete n.cache[e]},innerLoop:function(t,r,o){var i=t.elements[o],l=t.getArgs(o);if(n.cache[o]&&n.cache[o]===JSON.stringify(l)||void(n.cache[o]=JSON.stringify(l)))t=!1;else{var a=t.getArgs(o),c=t.modules[o];t.controllers[o],e.count=[],c&&c.view(a[0],i),r.fill(i,l[0]),t=!0}return t}},t=window.cancelAnimationFrame||window.clearTimeout,r=window.requestAnimationFrame||window.setTimeout,o=function(n,o){var i,l,a=o||16;return function(){var o=arguments;if(r===window.requestAnimationFrame||+new Date-i>a)l>0&&t(l),l=r(function(){i=+new Date;var t=[].slice.call(arguments).concat([].slice.call(o));n.apply(this,t),e.redrawing=!1},a);else{i=+new Date;var c=[].slice.call(arguments).concat([].slice.call(o));n.apply(this,c),l=r(function(){l=null,e.redrawing=!1},a)}}};e.render=n}(window.mag||{}),function(e,n,t){function r(n,t){var r=function(){return arguments.length&&(n=arguments[0],e.redraw()),n};return r.type="fun",r.data=t?t:null,r.toJSON=function(){return n&&n.nodeType?c.elementToObject(n):n},r}function o(n,t,r){return r=e.prop(t,r),n.then(r),r.then=function(e,r){return o(n.then(e,r),t)},r}function i(n,t,r){return t.onunload&&a.unloaders.push({controller:t,handler:t.onunload}),l.promises[n]=new Promise(function(){l.deferreds[n]=arguments}.bind({},r)),e.redraw(),o(l.promises[n],{_html:e.prop(l.elements[n])},{type:"module",id:n})}var l=e.mod,a=e.render,c=e.fill,u={}.toString,f={attributes:[],elementMatcher:[]};e.redrawing=!1,e.redraw=function(n){e.redrawing||(e.redrawing=!0,a.redraw(l||a.module||{},c,n))},e.withProp=function(e,n){return function(t){t=t||event,t=t.currentTarget||this,n(e in t?t[e]:t.getAttribute(e))}},e.prop=function(e,n){return(null!=e&&"[object Object]"===u.call(e)||"function"==typeof e)&&"function"==typeof e.then?o(e,n):r(e,n)},e.hookin=function(e,n,t){f[e].push({context:{},handler:t,key:n})},e.hook=function(e,n,t){for(var r=0,o=f[e].length;o>r;r++){var i=n,l=e,a=r,c=t,u=void 0;c.change=!1,f[l][a].key==i&&(u=JSON.stringify({v:c.value,k:c.key}),f[l][a].handler.call(f[l][a].context,c),u!==JSON.stringify({v:c.value,k:c.key})&&(c.change=!0))}},e.count=[],e.module=function(r,o,u,f){if(!o.view)throw Error("Mag.JS module - requires a view: "+r+o);u=u||{};var d,s=a.roots.indexOf(r);if((d=-1>=s)||(a.callLCEvent("onreload",l,s),d=!0),d){u.retain||a.clear(s,r,c),d=s;var h=u;d>-1&&t===h.key&&f;var p=c.count[r];0>d&&f&&t===h.key&&p&&(e.count[r]||(e.count[r]={}),e.count[r].key++,p&&e.count[r].size!=p[0]&&(e.count[r].key=0),e.count[r].size=p&&p[0],h.key=e.count[r].key);var g;if(0>d&&(g=a.roots.length,h.key=t!==h.key?h.key:g),d=r+"."+h.key,0<=a.roots.indexOf(d))return s=a.roots.indexOf(d),i(s,l.controllers[s],f);if(0>a.roots.indexOf(d)){if(0>s&&(s=a.roots.length),g=n.getElementById(r),!g)throw Error("Mag.JS Module - invalid node id: "+r);return a.roots[s]=d,r=l.submodule(o,[u]),o=l.getController(s,r,g,c),l.controllers[s]=o,l.modules[s]=r,l.elements[s]=f?g.cloneNode(!0):g,l.elements[s].cloner=f,i(s,o,f)}}}}(window.mag||{},document);

/*
Mag.JS v0.6.9
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(n,e,t,r){function o(n){return"[object Array]"===Object.prototype.toString.call(n)}function i(n){if(""!==n.id)return'id("'+n.id+'")';if(n===t.body)return n.tagName;var e=0;if(n.parentNode)for(var r=n.parentNode.childNodes,o=0;o<r.length;o++){var a=r[o];if(a===n)return i(n.parentNode)+"/"+n.tagName+"["+(e+1)+"]";1===a.nodeType&&a.tagName===n.tagName&&e++}}function a(n,e,t){var r,u,f;if(n){null==e&&(e={_text:""});var s=c(n);if(f=o(e)){if(p[t]&&0===s.length&&(p[t].parent.insertAdjacentHTML("beforeend",p[t].node),s=c(p[t].parent.children)),0===s.length)return;for(u=s[0].parentNode,p[t]||(p[t]={node:s[0].cloneNode(!0).outerHTML,parent:u});s.length<e.length;)p[t]?(u.insertAdjacentHTML("beforeend",p[t].node),r=u.lastChild):r=s[0].cloneNode(!0),s.push(r),u&&u.appendChild(r);for(;s.length>e.length;)r=s.pop(),(u=r.parentNode)&&(t=i(r),u.removeChild(r),d[t+"-config"]&&d[t+"-config"].configContext&&"function"==typeof d[t+"-config"].configContext.onunload&&d[t+"-config"].configContext.onunload())}for(r=0;r<s.length;r++)t=i(s[r]),f?!s[r]||d[t]&&d[t]===JSON.stringify(e[r])||(a(s[r],e[r]),d[t]=JSON.stringify(e[r])):l(s[r],e);return n}}function l(n,e){var t;if("function"!=typeof e){if("object"!=typeof e)return l(n,{_text:e});for(var c in e){var f=e[c];f===r&&(f=""),"_"===c[0]&&(t=t||{},t[c.substr(1)]=f)}var s=i(n);if(t){if(d[s]&&d[s]===JSON.stringify(t))return;u(n,t),d[s]=JSON.stringify(t)}var p=0;for(c in e)if(f=e[c],"_"!==c[0]){if(t=h(n,c),"function"==typeof f&&"fun"==f.type)try{f=f()}catch(g){}o(f)&&(t=h(n,"$"+c)),a(t,f,s+"/"+c),p++}}}function c(n){var e;if(null==n.length&&(n=[n]),!o(n)){e=[];for(var t=0;t<n.length;t+=1)n[t]&&e.push(n[t]);n=e}return n}function u(t,r){f(t,r.text),s(t,r.html),t._events=t._events||[];for(var o in r)if("text"!==o&&"html"!==o)if(0==o.indexOf("on")){if(-1===t._events.indexOf(o)){var a=function(e,t,r){try{return e.call(t,r)}finally{n.redraw()}}.bind(null,r[o],t);t.addEventListener(o.substr(2),a),t._events.push(o)}}else if("config"==o){var a=!0,l=i(t);d[l+"-config"]?a=!a:d[l+"-config"]={},l=d[l+"-config"].configContext=d[l+"-config"].configContext||{},e.push(function(n,e){return function(){return n.apply(n,e)}}(r[o],[t,a,l]))}else null===r[o]?t.removeAttribute(o):t.setAttribute(o,""+r[o])}function f(n,e){var t,r;if(n&&null!=e){if(!r){r=[];for(var o=0;o<n.childNodes.length;o+=1)t=n.childNodes[o],1===t.nodeType&&r.push(t)}for(;n.firstChild;)n.removeChild(n.firstChild);for("input"===n.nodeName.toLowerCase()?n.setAttribute("value",""+e):n.appendChild(n.ownerDocument.createTextNode(""+e)),o=0;o<r.length;o+=1)n.appendChild(r[o])}}function s(n,e){n&&null!=e&&(n.innerHTML=e)}function h(n,e,t){var r=n.childNodes;t=[];for(var o=0;o<r.length;o+=1)1===r[o].nodeType&&t.push(r[o]);if(r=[],o=e,!(n.queryCache||{})[e]){n.queryCache=(n.queryCache||{})[e]=[];var i="$"===e[0];"$"===o[0]&&(o=o.substr(1));for(var a=0;a<t.length;a+=1){var l=t[a],c=o,u=" "+l.className+" ";(l.id===c||-1<u.indexOf(" "+c+" ")||l.name===c||l.nodeName.toLowerCase()===c.toLowerCase()||l.getAttribute("data-bind")===c)&&r.push(t[a])}if(!r.length||i)for(a=0;a<t.length&&(r=r.concat(h(t[a],e,!0)),!r.length||i);a++);n.queryCache[e]=r}return n.queryCache[e]}var d=[],p={},d=[];n.fill={fill:a,configs:e},window.mag=n}(window.mag||{},[],document),function(n){function e(){b=null;for(var n=0;n<_.length;n++)_[n]();_.length=0}var t={noMore:!1,useDirtyCheck:!1},r=[],o=[],i=[],a=!1;try{a=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(l){}var c=function(n){var e={};return n&&"[object Function]"==e.toString.call(n)},u=function(n){return"[object Array]"===Object.prototype.toString.call(n)},f=function(n){return"[object Object]"==={}.toString.apply(n)},s=function(n){if(null==n||"object"!=typeof n)return n;var e,t=n.constructor();for(e in n)t[e]=n[e];return t},h=function(n,e,t,r){try{Object.observe(n,function(n){n.forEach(function(n){n.name===e&&r(n.object[n.name])})})}catch(o){try{Object.defineProperty(n,e,{get:t,set:function(n){r.call(this,n,!0)},enumerable:!0,configurable:!0})}catch(i){try{Object.prototype.__defineGetter__.call(n,e,t),Object.prototype.__defineSetter__.call(n,e,function(n){r.call(this,n,!0)})}catch(a){p(n,e,r)}}}},d=function(n,e,t){try{Object.defineProperty(n,e,{enumerable:!1,configurable:!0,writable:!1,value:t})}catch(r){n[e]=t}},p=function(n,e,t){o[o.length]={prop:e,object:n,orig:s(n[e]),callback:t}},g=function(n,e,t,r){if("string"!=typeof n&&(n instanceof Object||u(n))){if(u(n)){if(A(n,"__watchall__",e,t),void 0===t||t>0)for(var o=0;o<n.length;o++)g(n[o],e,t,r)}else{var i=[];for(o in n)"$val"==o||!a&&"watchers"===o||Object.prototype.hasOwnProperty.call(n,o)&&i.push(o);v(n,i,e,t,r)}r&&M(n,"$$watchlengthsubjectroot",e,t)}},v=function(n,e,t,r,o){if("string"!=typeof n&&(n instanceof Object||u(n)))for(var i=0;i<e.length;i++)w(n,e[i],t,r,o)},w=function(n,e,t,r,o){"string"!=typeof n&&(n instanceof Object||u(n))&&!c(n[e])&&(null!=n[e]&&(void 0===r||r>0)&&g(n[e],t,void 0!==r?r-1:r),A(n,e,t,r),o&&(void 0===r||r>0)&&M(n,e,t,r))},m=function(n,e){if(!(n instanceof String)&&(n instanceof Object||u(n)))if(u(n)){for(var t=["__watchall__"],r=0;r<n.length;r++)t.push(r);y(n,t,e)}else{var o=function(n){var t,r=[];for(t in n)n.hasOwnProperty(t)&&(n[t]instanceof Object?o(n[t]):r.push(t));y(n,r,e)};o(n)}},y=function(n,e,t){for(var r in e)e.hasOwnProperty(r)&&$(n,e[r],t)},_=[],b=null,j=function(){return b||(b=setTimeout(e)),b},O=function(n){null==b&&j(),_[_.length]=n},C=function(n,e,t,r){var o=null,i=-1,a=u(n);g(n,function(t,r,l,c){var u=j();if(i!==u&&(i=u,o={type:"update"},o.value=n,o.splices=null,O(function(){e.call(this,o),o=null})),a&&n===this&&null!==o){if("pop"===r||"shift"===r)l=[],c=[c];else if("push"===r||"unshift"===r)l=[l],c=[];else if("splice"!==r)return;o.splices||(o.splices=[]),o.splices[o.splices.length]={index:t,deleteCount:c?c.length:0,addedCount:l?l.length:0,added:l,deleted:c}}},1==t?void 0:0,r)},N=function(n,e,t,r,o){n&&e&&(w(n,e,function(n,e,i,a){n={type:"update"},n.value=i,n.oldvalue=a,(r&&f(i)||u(i))&&C(i,t,r,o),t.call(this,n)},0),(r&&f(n[e])||u(n[e]))&&C(n[e],t,r,o))},A=function(n,e,r,o){var i=!1,a=u(n);for(n.watchers||(d(n,"watchers",{}),a&&L(n,function(t,r,i,a){if(J(n,t,r,i,a),0!==o&&i&&(f(i)||u(i))){var l,c;for(t=n.watchers[e],(a=n.watchers.__watchall__)&&(t=t?t.concat(a):a),c=t?t.length:0,a=0;c>a;a++)if("splice"!==r)g(i,t[a],void 0===o?o:o-1);else for(l=0;l<i.length;l++)g(i[l],t[a],void 0===o?o:o-1)}})),n.watchers[e]||(n.watchers[e]=[],a||(i=!0)),a=0;a<n.watchers[e].length;a++)if(n.watchers[e][a]===r)return;if(n.watchers[e].push(r),i){var l=n[e];r=function(){return l},i=function(r,i){var a=l;if(l=r,0!==o&&n[e]&&(f(n[e])||u(n[e]))&&!n[e].watchers){var c,s=n.watchers[e].length;for(c=0;s>c;c++)g(n[e],n.watchers[e][c],void 0===o?o:o-1)}n.watchers&&(n.watchers.__wjs_suspend__||n.watchers["__wjs_suspend__"+e])?P(n,e):t.noMore||a===r||(i?J(n,e,"set",r,a):x(n,e,"set",r,a),t.noMore=!1)},t.useDirtyCheck?p(n,e,i):h(n,e,r,i)}},x=function(n,e,t,r,o){if(void 0!==e){var i,a=n.watchers[e];(i=n.watchers.__watchall__)&&(a=a?a.concat(i):i),i=a?a.length:0;for(var l=0;i>l;l++)a[l].call(n,e,t,r,o)}else for(e in n)n.hasOwnProperty(e)&&x(n,e,t,r,o)},S="pop push reverse shift sort slice unshift splice".split(" "),T=function(n,e,t,r){d(n,t,function(){var o,i,a,l=0;if("splice"===t){for(a=arguments[0],i=n.slice(a,a+arguments[1]),o=[],l=2;l<arguments.length;l++)o[l-2]=arguments[l];l=a}else o=0<arguments.length?arguments[0]:void 0;return a=e.apply(n,arguments),"slice"!==t&&("pop"===t?(i=a,l=n.length):"push"===t?l=n.length-1:"shift"===t?i=a:"unshift"!==t&&void 0===o&&(o=a),r.call(n,l,t,o,i)),a})},L=function(n,e){if(c(e)&&n&&!(n instanceof String)&&u(n))for(var t,r=S.length;r--;)t=S[r],T(n,n[t],t,e)},$=function(n,e,t){if(n.watchers[e])if(void 0===t)delete n.watchers[e];else for(var i=0;i<n.watchers[e].length;i++)n.watchers[e][i]==t&&n.watchers[e].splice(i,1);for(i=0;i<r.length;i++){var a=r[i];a.obj==n&&a.prop==e&&a.watcher==t&&r.splice(i,1)}for(t=0;t<o.length;t++)i=o[t],a=i.object.watchers,(i=i.object==n&&i.prop==e&&a&&(!a[e]||0==a[e].length))&&o.splice(t,1)},P=function(n,e){O(function(){delete n.watchers.__wjs_suspend__,delete n.watchers["__wjs_suspend__"+e]})},k=null,J=function(n,e,t,r,o){i[i.length]={obj:n,prop:e,mode:t,newval:r,oldval:o},null===k&&(k=setTimeout(q))},q=function(){var n=null;k=null;for(var e=0;e<i.length;e++)n=i[e],x(n.obj,n.prop,n.mode,n.newval,n.oldval);n&&(i=[])},M=function(n,e,t,o){var i;i=s("$$watchlengthsubjectroot"===e?n:n[e]),r.push({obj:n,prop:e,actual:i,watcher:t,level:o})};t.watch=function(){c(arguments[1])?g.apply(this,arguments):u(arguments[1])?v.apply(this,arguments):w.apply(this,arguments)},t.unwatch=function(){c(arguments[1])?m.apply(this,arguments):u(arguments[1])?y.apply(this,arguments):$.apply(this,arguments)},t.callWatchers=x,t.suspend=function(n,e){n.watchers&&(n.watchers["__wjs_suspend__"+(void 0!==e?e:"")]=!0)},t.onChange=function(){(c(arguments[2])?N:C).apply(this,arguments)},n.watch=t}(window.mag||{}),function(n){var e={modules:[],controllers:[],elements:[],submodule:function(n,e){var t=function(e){return(n.controller||function(){}).apply(this,e)}.bind({},e);return t.$original=n.controller,t={controller:t,view:function(t){1<arguments.length&&(e=e.concat([].slice.call(arguments,1)));var r=n.view.apply(n,e?[t].concat(e):[t]);return e[0]&&null!=e[0].key&&(r.attrs.key=e[0].key),r}},e[0]&&null!=e[0].key&&(t.attrs={key:e[0].key}),t},getArgs:function(n){return e.modules[n].controller&&e.modules[n].controller.$$args?[e.controllers[n]].concat(e.modules[n].controller.$$args):[e.controllers[n]]}};n.mod=e}(window.mag||{}),function(n){var e={roots:[],templates:{},cache:{},callOnload:function(n){for(var e,t=0;e=n.controllers[t];t++)e.onload&&!e.called&&(e.onload.call(null,n.elements[t]),e.called=1)},callConfigs:function(n){for(var e=0,t=n.length;t>e;e++)n[e]()}},t=[];e.redraw=function(n,t,r){n=n||e.module||{},this.fun||(this.fun=i(function(){t.configs.splice(0,t.configs.length),e.doLoop(n,t,r)})),this.fun()},e.doLoop=function(t,r,o){for(var i=0;e.roots[i];i++)n.running=!0,t.controllers[i]&&e.innerLoop(t,r,i,o)},e.innerLoop=function(n,r,o,i){var a=n.elements[o],l=n.getArgs(o);return t[o]&&t[o]===JSON.stringify(l[0])?!1:(n.getArgs(o),n.modules[o].view(a,n.controllers[o]),t[o]=JSON.stringify(l[0]),e.setupWatch(i,l,r,a,o,n),r.fill(a,l[0]),void e.callConfigs(r.configs))},e.doWatch=function(r,o,i,a,l){n.running=!0,l=a.getArgs(i),t[i]&&t[i]===JSON.stringify(l[0])||(a.getArgs(i),a.modules[i].view(o,a.controllers[i]),t[i]=JSON.stringify(l[0]),r.fill(o,l[0]),e.callConfigs(r.configs),e.callOnload(a),n.running=!1)},e.setupWatch=function(n,t,r,o,a,l){n.watch(t[0],i(e.doWatch.bind(null,r,o,a,l)))};var r=window.cancelAnimationFrame||window.clearTimeout,o=window.requestAnimationFrame||window.setTimeout,i=function(n,e){var t,i,a=e||16;return function(){+new Date-t>a||o===window.requestAnimationFrame?(i>0&&r(i),i=o(function(){t=+new Date,n.apply(this,arguments)},a)):(t=+new Date,n.apply(this,arguments),i=o(function(){i=null},a))}};n.render=e}(window.mag||{}),function(n,e,t){var r,o={},i=n.mod,a=n.render,l=n.fill,c=n.watch;n.running=!1,o.init=function(){};var u=!1;o.redraw=function(){u||(u=!0,a.redraw(i||a.module||{},l,c),u=!1)},o.withProp=function(n,e){return function(t){t=t||event,t=t.currentTarget||this,e(n in t?t[n]:t.getAttribute(n))}},o.prop=function(n){var e=function(){return arguments.length&&(n=arguments[0],o.redraw()),n};return e.type="fun",e.toJSON=function(){return n},e};var f=[];o.module=function(t,l,c){var u=a.roots.indexOf(t);0>u&&(u=a.roots.length);for(var s,h=!1,d={preventDefault:function(){h=!0}},p=0;s=f[p];p++)s.handler(d),s.controller.onunload=null;if(h)for(p=0;s=f[p];p++)s.controller.onunload=s.handler;else f=[];return h?void 0:(t=e.getElementById(t))?(a.roots[u]=t.id,l.view?(c=r=l=(l=i.submodule(l,[c||{}]))||{},d=new l.controller,c===r&&(i.controllers[u]=d,d.onunload&&f.push({controller:d,handler:d.onunload}),i.modules[u]=l,i.elements[u]=t),o.redraw(),d.onload&&!n.running&&a.callOnload(i),{_html:t.innerHTML}):Error("module requires a view")):Error("invalid node")},t=function(n){return function(){return o[n].apply(this,arguments)}};var s=t("init");s.module=t("module"),s.prop=t("prop"),s.redraw=t("redraw"),s.withProp=t("withProp");for(var h in s)n[h]=s[h]}(window.mag||{},document);

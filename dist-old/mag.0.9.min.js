/*
Mag.JS v0.9
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,n,t,r){function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){if(""!==e.id)return'id("'+e.id+'")';if(e===t.body)return e.tagName;var n=0;if(e.parentNode)for(var r=e.parentNode.childNodes,o=0;o<r.length;o++){var l=r[o];if(l===e)return i(e.parentNode)+"/"+e.tagName+"["+(n+1)+"]";1===l.nodeType&&l.tagName===e.tagName&&n++}}function l(e){var n=i(e);e.queryCache,e.parentNode.removeChild(e),p[n+"-config"]&&p[n+"-config"].configContext&&"function"==typeof p[n+"-config"].configContext.onunload&&p[n+"-config"].configContext.onunload(p[n+"-config"].configContext,e,p[n],n),delete p[n];for(var t in p)0===t.indexOf(n)&&delete p[t]}function a(e){return(e=e&&parseInt(e.split("[").pop().slice(0,-1)))?parseInt(e)-1:0}function c(e,n,t){var r,a,s;if(e){null==n&&(n={_text:""});var d=f(e);if(s=o(n)){if(m[t]&&0===d.length&&(m[t].parent.insertAdjacentHTML("beforeend",m[t].node),d=f(m[t].parent.children),"object"==typeof n[0]&&(n[0].__magnum__=d[0].__key=0)),0===d.length)return;for(a=d[0].parentNode,m[t]||(m[t]={node:d[0].cloneNode(!0).outerHTML,parent:a});d.length<n.length;)m[t]?(a.insertAdjacentHTML("beforeend",m[t].node),r=a.lastChild):r=d[0].cloneNode(!0),"object"==typeof n[y]&&(n[y].__magnum__=y,r.__key=y++),d.push(r),a&&a.appendChild(r);if(d.length>n.length)if(0==n.length||"object"!=typeof n[0])for(;d.length>n.length;)r=d.pop(),(a=r.parentNode)&&l(r);else d=d.filter(function(e){return 0==n.filter(function(n){return n.__magnum__==e.__key}).length?(l(e),!1):!0})}for(t=0;t<d.length;t++)r=i(d[t]),s?d[t]&&(p[r]&&p[r]===JSON.stringify(n[t]),c(d[t],n[t]),p[r]=JSON.stringify(n[t]),d[t].queryCache):u(d[t],n);return e}}function u(e,n){var t;if("function"!=typeof n){if("object"!=typeof n)return u(e,{_text:n});for(var a in n){var f=n[a];f===r?f="":null===f&&-1===["onunload"].indexOf(a)&&h(e,a).forEach(function(e){l(e)}),"_"===a[0]&&"__magnum__"!=a&&(t=t||{},t[a.substr(1)]=f)}var d=i(e);t&&s(e,t);var g=0;for(a in n)if(f=n[a],"_"!==a[0]){if(t=h(e,a),"function"==typeof f&&"fun"==f.type)try{f=f()}catch(v){}o(f)&&(t=h(e,"$"+a)),c(t,f,d+"/"+a),g++}}}function f(e){var n;if(null==e.length&&(e=[e]),!o(e)){n=[];for(var t=0;t<e.length;t+=1)e[t]&&n.push(e[t]);e=n}return e}function s(t,r){var o=i(t),l=a(o);p[o]&&p[o]===JSON.stringify(r),t._events=t._events||[];for(var c in r)if("text"!==c&&"html"!==c)if(0==c.indexOf("on")){if(-1===t._events.indexOf(c)||w){var u=function(n,t,r,o){try{return n.call(t,o,r,t)}finally{e.redraw()}}.bind(null,r[c],t,l);t[c]=u,t._events.push(c)}}else if("config"==c){u=!0,p[o+"-config"]?u=!1:p[o+"-config"]={};var f=p[o+"-config"].configContext=p[o+"-config"].configContext||{};n.push(function(e,n){return function(){return e.apply(e,n)}}(r[c],[t,u,f,l]))}else u={key:c,cache:!1,value:r[c],node:t},e.hook("attributes",c,u),u.change&&(c=u.key,r[c]=u.value),null===r[c]?t.removeAttribute(c):t.setAttribute(c,""+r[c]);d(t,r.text),g(t,r.html),t.queryCache}function d(e,n){var t,r;if(i(e),e&&null!=n){if(!r){r=[];for(var o=0;o<e.childNodes.length;o+=1)t=e.childNodes[o],t.nodeType===v&&r.push(t)}for(;e.firstChild;)e.removeChild(e.firstChild);for("input"===e.nodeName.toLowerCase()?e.setAttribute("value",""+n):e.appendChild(e.ownerDocument.createTextNode(""+n)),o=0;o<r.length;o+=1)e.appendChild(r[o])}}function g(e,n){e&&null!=n&&(e.innerHTML=n)}function h(e,n,t){for(var r=e.childNodes,o=[],i=0;i<r.length;i+=1)r[i].nodeType===v&&o.push(r[i]);if(r=[],i=n,!e.queryCache||!e.queryCache[n]||"$"===n[0]){e="$"===n[0],"$"===i[0]&&(i=i.substr(1));for(var l=0;l<o.length;l+=1){var a=o[l],c=i,u=" "+a.className+" ";(a.id===c||-1<u.indexOf(" "+c+" ")||a.name===c||a.nodeName.toLowerCase()===c.toLowerCase()||a.getAttribute("data-bind")===c)&&r.push(o[l])}if(!r.length||e)for(l=0;l<o.length&&(r=r.concat(h(o[l],n,!0)),!r.length||e);l++);return!t&&!r.length,r}return e.queryCache[n]}var v=1,p=[],m={},p=[],y=0,w=!1;e.fill={fill:c,find:h,clear:function(){w=!0},unclear:function(){w=!1},configs:n},window.mag=e}(window.mag||{},[],document),function(e){var n={modules:[],promises:[],deferreds:[],controllers:[],elements:[],getController:function(e,n,t){return"undefined"!=typeof Proxy?new Proxy(new e.controller,{get:function(e,r){if(void 0===e[r]&&-1===["watchers","toJSON","called","onload","onunload"].indexOf(r)){var o,i=t.find(n,r),l="$"===r[0],a=[];return i.forEach(function(e,n){i[n]&&(i[n].value&&0<i[n].value.length?(o=i[n].value,!i[n].type||"checkbox"!=i[n].type&&"radio"!=i[n].type||(o={_text:o,_checked:i[n].checked},a.push(o))):i[n].innerText&&0<i[n].innerText.length?o=i[n].innerText:i[0].innerHTML&&0<i[n].innerHTML.length&&(o=i[n].innerHTML))}),0<a.length&&l?a:o}return e[r]}}):new e.controller},submodule:function(e,n){var t=function(n){return(e.controller||function(){}).apply(this,n)}.bind({},n);return t.$original=e.controller,t={controller:t,view:function(t){if(1<arguments.length)var r=n.concat([].slice.call(arguments,1));r=e.view.apply(e,r?[t].concat(r):[t]),n[0]&&null!=n[0].key&&(r.attrs.key=n[0].key)}},n[0]&&null!=n[0].key&&(t.attrs={key:n[0].key}),t},getArgs:function(e){return n.modules[e].controller&&n.modules[e].controller.$$args?[n.controllers[e]].concat(n.modules[e].controller.$$args):[n.controllers[e]]}};e.mod=n}(window.mag||{}),function(e){function n(e,n,t){var r=(n.getArgs(t),n.modules[t]);n=n.controllers[t];var i=o.contexts[t]=o.contexts[t]||{};try{r.view(n,e,i)}catch(l){console.log(e.id,t,l)}}function t(e,n){e&&void 0!==Object.observe?Object.observe(e,function(r){r.forEach(function(r){"object"==typeof e[r.name]&&t(e[r.name],n)}),n.apply(this,arguments)}):e&&r(e,n)}function r(e,n){if(e)for(var t in e)"object"==typeof e[t]&&r(e[t],n),e.__watch(t,function(){n.apply(this,arguments)})}var o={roots:[],contexts:[],templates:{},cache:{},callOnload:function(e){for(var n,t=0;n=e.controllers[t];t++)n.onload&&!n.called&&(n.onload.call(null,e.elements[t]),n.called=1)},callConfigs:function(e){for(var n=0,t=e.length;t>n;n++)e[n]()}},i=[];o.redraw=function(e,n,t){e=e||o.module||{},this.fun=this.fun||u(function(){n.configs.splice(0,n.configs.length),o.doLoop(e,n,t)}),this.fun()},o.doLoop=function(n,t,r){for(var i=0;o.roots[i];i++)if(e.running=!0,n.controllers[i]&&o.innerLoop(n,t,i,r)&&(n.deferreds[i][2]({_html:n.elements[i].innerHTML}),n.deferreds[i][0])){var l=n.deferreds[i][1];delete n.elements[l],n.modules[l],n.controllers[l],n.promises[l],n.deferreds[l]}t.unclear()},o.clear=function(e,n,t){-1!==e&&i[e]&&t.clear()},o.innerLoop=function(e,t,r,l){var a=e.elements[r],c=e.getArgs(r);return i[r]&&i[r]===JSON.stringify(c[0])?!1:(n(a,e,r),i[r]=JSON.stringify(c[0]),o.setupWatch(l,c,t,a,r,e),t.fill(a,c[0]),o.callConfigs(t.configs),o.callOnload(e),!0)};var l;o.doWatch=function(t,r,a,c,u,f){f!=l&&(l=f,e.running=!0,u=c.getArgs(a),i[a]&&i[a]===JSON.stringify(u[0])||(n(r,c,a),i[a]=JSON.stringify(u[0]),t.fill(r,u[0]),o.callConfigs(t.configs),e.running=!1))},o.setupWatch=function(e,n,r,i,l,a){t(n[0],function(e){u(o.doWatch.bind({},r,i,l,a,e))()})};var a=window.cancelAnimationFrame||window.clearTimeout,c=window.requestAnimationFrame||window.setTimeout,u=function(e,n){var t,r,o=n||16;return function(){if(+new Date-t>o||c===window.requestAnimationFrame){r>0&&a(r);var n=arguments;r=c(function(){t=+new Date;var r=[].slice.call(arguments).concat([].slice.call(n));e.apply(this,r)},o)}else{t=+new Date;var i=[].slice.call(arguments).concat([].slice.call(n));e.apply(this,i),r=c(function(){r=null},o)}}};e.render=o,void 0===Object.observe&&Object.defineProperty(Object.prototype,"__watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,n){var t=this[e],r=function(){return t},o=function(r){return t!==r&&(n.call(this,e,t,r),t=r),r};delete this[e]&&Object.defineProperty(this,e,{get:r,set:o,enumerable:!0,configurable:!0})}})}(window.mag||{}),function(e,n){function t(e){var n=function(){return arguments.length&&(e=arguments[0]),e};return n.type="fun",n.toJSON=function(){return e},n}function r(n,t){var o=e.prop(t);return n.then(o),o.then=function(e,o){return r(n.then(e,o),t)},o}var o=e.mod,i=e.render,l=e.fill,a=e.watch,c={}.toString,u=e.running=!1;e.redraw=function(){u||(u=!0,i.redraw(o||i.module||{},l,a),u=!1)},e.withProp=function(e,n){return function(t){t=t||event,t=t.currentTarget||this,n(e in t?t[e]:t.getAttribute(e))}},e.prop=function(e){return(null!=e&&"[object Object]"===c.call(e)||"function"==typeof e)&&"function"==typeof e.then?r(e):t(e)};var f={attributes:[]};e.hookin=function(e,n,t){f[e].push({context:{},handler:t,key:n})},e.hook=function(e,n,t,r){for(var o in f[e])t.changed=!1,f[e][o].key==n&&(r=JSON.stringify({v:t.value,k:t.key}),f[e][o].handler.call(f[e][o].context,t),r!==JSON.stringify({v:t.value,k:t.key})&&(t.change=!0))};var s=[];e.module=function(t,a,c,u){var f=i.roots.indexOf(t);c&&!c.retain&&i.clear(f,t,l),(0>f||u)&&(f=i.roots.length);for(var d,g=!1,h={preventDefault:function(){g=!0}},v=0;d=s[v];v++)d.handler(h),d.controller.onunload=null;if(g)for(v=0;d=s[v];v++)d.controller.onunload=d.handler;else s=[];return g?void 0:(t=n.getElementById(t))?(i.roots[f]=t.id,a.view?(a=o.submodule(a,[c&&Object.freeze(c||{})]),c=o.getController(a,t,l),o.controllers[f]=c,c.onunload&&s.push({controller:c,handler:c.onunload}),o.modules[f]=a,o.elements[f]=u?t.cloneNode(!0):t,o.promises[f]=new Promise(function(){o.deferreds[f]=arguments}.bind(null,u,f)),e.redraw(),c.onload&&!e.running&&i.callOnload(o),r(o.promises[f],{_html:o.elements[f].innerHTML})):Error("module requires a view")):Error("invalid node")}}(window.mag||{},document);

/*
* MagnumJS - By Michael Glazer March 2015
* https://github.com/magnumjs/mag.js
*/
function callView(e,t,n){var r=(t.getArgs(n),t.modules[n]),o=t.controllers[n];r.view(e,o)}var domElement={};domElement.replaceWithin=function(e,t,n){function r(e,t,n){if(e.hasChildNodes())for(var i=e.children,l=0,c=i.length;c>l;l++)i[l].firstChild&&(i[l].firstChild.nodeValue?(o(t,i[l],n),a(t,i[l],n)):r(i[l],t,n));else o(t,e,n),a(t,e,n)}function o(e,t,r){function o(e,t){"object"!=typeof n&&(e.nodeValue=e.nodeValue.replace(t,function(e,t){return-1!=t?n:e}))}for(var a=0,i=t.attributes,l=i.length;l>a;a++){var c=i.item(a);o(c,e,r)}}function a(e,t){t.firstChild.nodeValue=t.firstChild.nodeValue.replace(e,function(e,t){return-1!=t?n:e})}this.pattern=this.pattern||{},this.pattern[t]=this.pattern[t]||RegExp("\\{"+t+"\\}","gi"),r(e,this.pattern[t],t)},function(e){function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e){"function"==typeof r.logger&&r.logger(e)}function r(e,n,i,l){var c,u,s;if(e){null==n&&(n={_text:""});var f=a(e);if(s=t(n)){if(0===f.length)return;u=f[0].parentNode;var h=document.createDocumentFragment();for(d[i+l]||(d[i+l]={node:f[0].cloneNode(!0).outerHTML,parent:u}),f[0].setAttribute("data-clone",i+l);f.length-1<n.length;)c=f[0].cloneNode(!0),c.removeAttribute("data-clone"),f.push(c),u&&h.appendChild(c);for(;f.length>n.length+1;)c=f.pop(),u=c.parentNode,u&&h.removeChild(c);u&&u.appendChild(h)}for(var p=0;p<f.length;p++)s?f[p+1]&&r(f[p+1],n[p]):o(f[p],n);return e}}function o(e,t){var n,a;if("function"!=typeof t){if("object"!=typeof t)return o(e,{_text:t});for(var l in t){var c=t[l];void 0===c&&(c=""),"_"===l[0]&&(n=n||{},n[l.substr(1)]=c)}n&&i(e,n);var s=0;for(var l in t){var c=t[l];"_"!==l[0]&&(a=u(e,l),domElement.replaceWithin(e,l,c),r(a,c,l,s),s++)}}}function a(e){var n;if(null==e.length&&(e=[e]),!t(e)){n=[];for(var r=0;r<e.length;r+=1)e[r]&&n.push(e[r]);e=n}return e}function i(t,n){l(t,n.text),c(t,n.html),t._events=t._events||[];for(var r in n)if("text"!==r&&"html"!==r)if(0==r.indexOf("on")){if(-1!==t._events.indexOf(r))continue;t.addEventListener(r.substr(2),n[r]),t._events.push(r)}else{if("config"==r){var o=!0,a=function(e,t){return function(){return e.apply(e,t)}};e.push(a(n[r],[t,o]));continue}null===n[r]?t.removeAttribute(r):t.setAttribute(r,""+n[r])}}function l(e,t){var n,r;if(e&&null!=t){if(!r){r=[];for(var o=0;o<e.childNodes.length;o+=1)n=e.childNodes[o],n.nodeType===h&&r.push(n)}for(;e.firstChild;)e.removeChild(e.firstChild);"input"===e.nodeName.toLowerCase()?e.setAttribute("value",""+t):e.appendChild(e.ownerDocument.createTextNode(""+t));for(var o=0;o<r.length;o+=1)e.appendChild(r[o])}}function c(e,t){e&&null!=t&&(e.innerHTML=t)}function u(e,t,r){var o=s(e),a=[],i=t;if(!(e.queryCache||{})[t]){e.queryCache=(e.queryCache||{})[t]=[];var l="$"===t[0];"$"===i[0]&&(i=i.substr(1));for(var c=0;c<o.length;c+=1)f(o[c],i)&&a.push(o[c]);if(!a.length||l)for(var c=0;c<o.length&&(a=a.concat(u(o[c],t,!0)),!a.length||l);c++);r||a.length||n('FILL - Warning: no matches found for "'+t+'"'),e.queryCache[t]=a}return e.queryCache[t]}function s(e){for(var t=e.childNodes,n=[],r=0;r<t.length;r+=1)t[r].nodeType===h&&n.push(t[r]);return n}function f(e,t){var n=" "+e.className+" ";return e.id===t||n.indexOf(" "+t+" ")>-1||e.name===t||e.nodeName.toLowerCase()===t.toLowerCase()||e.getAttribute("data-bind")===t}var h=1,d={};this.fill=r,this.configs=e}.call(this,[]),function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):(window.WatchJS=e(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){function e(){C=null;for(var e=0;e<j.length;e++)j[e]();j.length=0}var t={noMore:!1,useDirtyCheck:!1},n=[],r=[],o=[],a=!1;try{a=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(i){}var l=function(e){var t={};return e&&"[object Function]"==t.toString.call(e)},c=function(e){return"[object Array]"===Object.prototype.toString.call(e)},u=function(e){return"[object Object]"==={}.toString.apply(e)},s=function(e,t){var n=[],r=[];if("string"!=typeof e&&"string"!=typeof t){if(c(e))for(var o=0;o<e.length;o++)void 0===t[o]&&n.push(o);else for(var o in e)e.hasOwnProperty(o)&&void 0===t[o]&&n.push(o);if(c(t))for(var a=0;a<t.length;a++)void 0===e[a]&&r.push(a);else for(var a in t)t.hasOwnProperty(a)&&void 0===e[a]&&r.push(a)}return{added:n,removed:r}},f=function(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)t[n]=e[n];return t},h=function(e,t,n,r){try{Object.observe(e,function(e){e.forEach(function(e){e.name===t&&r(e.object[e.name])})})}catch(o){try{Object.defineProperty(e,t,{get:n,set:function(e){r.call(this,e,!0)},enumerable:!0,configurable:!0})}catch(a){try{Object.prototype.__defineGetter__.call(e,t,n),Object.prototype.__defineSetter__.call(e,t,function(e){r.call(this,e,!0)})}catch(i){p(e,t,r)}}}},d=function(e,t,n){try{Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!1,value:n})}catch(r){e[t]=n}},p=function(e,t,n){r[r.length]={prop:t,object:e,orig:f(e[t]),callback:n}},v=function(){l(arguments[1])?g.apply(this,arguments):c(arguments[1])?w.apply(this,arguments):m.apply(this,arguments)},g=function(e,t,n,r){if("string"!=typeof e&&(e instanceof Object||c(e))){if(c(e)){if(x(e,"__watchall__",t,n),void 0===n||n>0)for(var o=0;o<e.length;o++)g(e[o],t,n,r)}else{var o,i=[];for(o in e)"$val"==o||!a&&"watchers"===o||Object.prototype.hasOwnProperty.call(e,o)&&i.push(o);w(e,i,t,n,r)}r&&I(e,"$$watchlengthsubjectroot",t,n)}},w=function(e,t,n,r,o){if("string"!=typeof e&&(e instanceof Object||c(e)))for(var a=0;a<t.length;a++){var i=t[a];m(e,i,n,r,o)}},m=function(e,t,n,r,o){"string"!=typeof e&&(e instanceof Object||c(e))&&(l(e[t])||(null==e[t]||void 0!==r&&0>=r||g(e[t],n,void 0!==r?r-1:r),x(e,t,n,r),o&&(void 0===r||r>0)&&I(e,t,n,r)))},b=function(){l(arguments[1])?y.apply(this,arguments):c(arguments[1])?_.apply(this,arguments):T.apply(this,arguments)},y=function(e,t){if(!(e instanceof String)&&(e instanceof Object||c(e)))if(c(e)){for(var n=["__watchall__"],r=0;r<e.length;r++)n.push(r);_(e,n,t)}else{var o=function(e){var n=[];for(var r in e)e.hasOwnProperty(r)&&(e[r]instanceof Object?o(e[r]):n.push(r));_(e,n,t)};o(e)}},_=function(e,t,n){for(var r in t)t.hasOwnProperty(r)&&T(e,t[r],n)},j=[],C=null,O=function(){return C||(C=setTimeout(e)),C},N=function(e){null==C&&O(),j[j.length]=e},$=function(){var e=l(arguments[2])?S:A;e.apply(this,arguments)},A=function(e,t,n,r){var o,a=null,i=-1,l=c(e),u=function(n,r,o,c){var u=O();if(i!==u&&(i=u,a={type:"update"},a.value=e,a.splices=null,N(function(){t.call(this,a),a=null})),l&&e===this&&null!==a){if("pop"===r||"shift"===r)o=[],c=[c];else if("push"===r||"unshift"===r)o=[o],c=[];else if("splice"!==r)return;a.splices||(a.splices=[]),a.splices[a.splices.length]={index:n,deleteCount:c?c.length:0,addedCount:o?o.length:0,added:o,deleted:c}}};o=1==n?void 0:0,g(e,u,o,r)},S=function(e,t,n,r,o){e&&t&&(m(e,t,function(e,t,a,i){var l={type:"update"};l.value=a,l.oldvalue=i,(r&&u(a)||c(a))&&A(a,n,r,o),n.call(this,l)},0),(r&&u(e[t])||c(e[t]))&&A(e[t],n,r,o))},x=function(e,n,r,o){var a=!1,i=c(e);e.watchers||(d(e,"watchers",{}),i&&L(e,function(t,r,a,i){if(V(e,t,r,a,i),0!==o&&a&&(u(a)||c(a))){var l,s,f,h,d=e.watchers[n];for((h=e.watchers.__watchall__)&&(d=d?d.concat(h):h),f=d?d.length:0,l=0;f>l;l++)if("splice"!==r)g(a,d[l],void 0===o?o:o-1);else for(s=0;s<a.length;s++)g(a[s],d[l],void 0===o?o:o-1)}})),e.watchers[n]||(e.watchers[n]=[],i||(a=!0));for(var l=0;l<e.watchers[n].length;l++)if(e.watchers[n][l]===r)return;if(e.watchers[n].push(r),a){var s=e[n],f=function(){return s},v=function(r,a){var i=s;if(s=r,0!==o&&e[n]&&(u(e[n])||c(e[n]))&&!e[n].watchers){var l,f=e.watchers[n].length;for(l=0;f>l;l++)g(e[n],e.watchers[n][l],void 0===o?o:o-1)}return E(e,n)?void J(e,n):void(t.noMore||i!==r&&(a?V(e,n,"set",r,i):W(e,n,"set",r,i),t.noMore=!1))};t.useDirtyCheck?p(e,n,v):h(e,n,f,v)}},W=function(e,t,n,r,o){if(void 0!==t){var a,i,l=e.watchers[t];(i=e.watchers.__watchall__)&&(l=l?l.concat(i):i),a=l?l.length:0;for(var c=0;a>c;c++)l[c].call(e,t,n,r,o)}else for(var t in e)e.hasOwnProperty(t)&&W(e,t,n,r,o)},P=["pop","push","reverse","shift","sort","slice","unshift","splice"],k=function(e,t,n,r){d(e,n,function(){var o,a,i,l,c=0;if("splice"===n){var u=arguments[0],s=u+arguments[1];for(i=e.slice(u,s),a=[],o=2;o<arguments.length;o++)a[o-2]=arguments[o];c=u}else a=arguments.length>0?arguments[0]:void 0;return l=t.apply(e,arguments),"slice"!==n&&("pop"===n?(i=l,c=e.length):"push"===n?c=e.length-1:"shift"===n?i=l:"unshift"!==n&&void 0===a&&(a=l),r.call(e,c,n,a,i)),l})},L=function(e,t){if(l(t)&&e&&!(e instanceof String)&&c(e))for(var n,r=P.length;r--;)n=P[r],k(e,e[n],n,t)},T=function(e,t,n){if(e.watchers[t])if(void 0===n)delete e.watchers[t];else for(var r=0;r<e.watchers[t].length;r++){var o=e.watchers[t][r];o==n&&e.watchers[t].splice(r,1)}R(e,t,n),G(e,t)},q=function(e,t){if(e.watchers){var n="__wjs_suspend__"+(void 0!==t?t:"");e.watchers[n]=!0}},E=function(e,t){return e.watchers&&(e.watchers.__wjs_suspend__||e.watchers["__wjs_suspend__"+t])},J=function(e,t){N(function(){delete e.watchers.__wjs_suspend__,delete e.watchers["__wjs_suspend__"+t]})},M=null,V=function(e,t,n,r,a){o[o.length]={obj:e,prop:t,mode:n,newval:r,oldval:a},null===M&&(M=setTimeout(F))},F=function(){var e=null;M=null;for(var t=0;t<o.length;t++)e=o[t],W(e.obj,e.prop,e.mode,e.newval,e.oldval);e&&(o=[],e=null)},D=function(){for(var e=0;e<n.length;e++){var t=n[e];if("$$watchlengthsubjectroot"===t.prop){var o=s(t.obj,t.actual);(o.added.length||o.removed.length)&&(o.added.length&&w(t.obj,o.added,t.watcher,t.level-1,!0),t.watcher.call(t.obj,"root","differentattr",o,t.actual)),t.actual=f(t.obj)}else{var o=s(t.obj[t.prop],t.actual);if(o.added.length||o.removed.length){if(o.added.length)for(var a=0;a<t.obj.watchers[t.prop].length;a++)w(t.obj[t.prop],o.added,t.obj.watchers[t.prop][a],t.level-1,!0);W(t.obj,t.prop,"differentattr",o,t.actual)}t.actual=f(t.obj[t.prop])}}var i,l;if(r.length>0)for(var e=0;e<r.length;e++)i=r[e],l=i.object[i.prop],H(i.orig,l)||(i.orig=f(l),i.callback(l))},H=function(e,t){var n,r=!0;if(e!==t)if(u(e)){for(n in e)if((a||"watchers"!==n)&&e[n]!==t[n]){r=!1;break}}else r=!1;return r},I=function(e,t,r,o){var a;a=f("$$watchlengthsubjectroot"===t?e:e[t]),n.push({obj:e,prop:t,actual:a,watcher:r,level:o})},R=function(e,t,r){for(var o=0;o<n.length;o++){var a=n[o];a.obj==e&&a.prop==t&&a.watcher==r&&n.splice(o,1)}},G=function(e,t){for(var n,o=0;o<r.length;o++){var a=r[o],i=a.object.watchers;n=a.object==e&&a.prop==t&&i&&(!i[t]||0==i[t].length),n&&r.splice(o,1)}};return setInterval(D,50),t.watch=v,t.unwatch=b,t.callWatchers=W,t.suspend=q,t.onChange=$,t});var mod={modules:[],controllers:[],elements:[]};mod.submodule=function(e,t){var n=function(t){return(e.controller||function(){}).apply(this,t)}.bind({},t),r=function(n){arguments.length>1&&(t=t.concat([].slice.call(arguments,1)));var r=e.view.apply(e,t?[n].concat(t):[n]);return t[0]&&null!=t[0].key&&(r.attrs.key=t[0].key),r};n.$original=e.controller;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o},mod.getArgs=function(e){var t=mod.modules[e].controller&&mod.modules[e].controller.$$args?[mod.controllers[e]].concat(mod.modules[e].controller.$$args):[mod.controllers[e]];return t};var render={roots:[],templates:{},cache:{}},unloaders=[],cached=[],pendingRequests=0;render.callConfigs=function(){},render.redraw=function(e){e=e||render.module||{},this.fun||(this.fun=debounce(function(){for(var t,n,r=0;n=render.roots[r];r++)if(e.controllers[r]){var o=e.elements[r];callView(o,e,r);var a=e.getArgs(r);watch(a[0],debounce(function(e,n,r){console.time("Mag.JS:re-render");var o=r.getArgs(n);t!==JSON.stringify(o[0])&&(callView(e,r,n),fill(e,o[0]),WatchJS.noMore=!0,render.callConfigs(),t=JSON.stringify(o[0])),console.timeEnd("Mag.JS:re-render")}.bind(null,o,r,e))),fill(o,a[0]),render.callConfigs(),t=JSON.stringify(a[0])}console.timeEnd("MagnumJS:init")})),this.fun()};var $cancelAnimationFrame=window.cancelAnimationFrame||window.clearTimeout,$requestAnimationFrame=window.requestAnimationFrame||window.setTimeout,debounce=function(e,t){var n,r,o=t||16;return function(){+new Date-n>o||$requestAnimationFrame===window.requestAnimationFrame?(r>0&&$cancelAnimationFrame(r),r=$requestAnimationFrame(function(){n=+new Date,e.apply(this,arguments)},o)):(n=+new Date,e.apply(this,arguments))}},mag=function(e,t,n,r){"use strict";var o={};o.init=function(e,t){if(!(this instanceof o.init))return new o.init(e,t);console.log("mag init")},o.prop=function(e){var r=function(){return arguments.length&&(e=arguments[0],n.redraw(t)),e};return r.toJSON=function(){return JSON.parse(JSON.stringify(e))},r},o.module=function(e,o,a){console.time("MagnumJS:init");var i=n.roots.indexOf(e);0>i&&(i=n.roots.length);var l=r.getElementById(e);if(!l)throw Error("invalid node");var c=l.parentNode,u=l.cloneNode(!0),s=r.createElement("span");c.replaceChild(s,l);var f=t.submodule(o,[a]);n.roots[i]=e;var h=new f.controller;t.controllers[i]=h,t.modules[i]=f,t.elements[i]=u,n.redraw(t),c.replaceChild(u,s),h.onload&&h.onload.call(null,u)};var a=function(e){return function(){return o[e].apply(this,arguments)}},i=a("init");return i.module=a("module"),i.prop=a("prop"),i}(mag=mag||{},mod,render,document);

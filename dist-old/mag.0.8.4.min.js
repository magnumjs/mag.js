/*
Mag.JS v0.8.4
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,n,t,r){function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){if(""!==e.id)return'id("'+e.id+'")';if(e===t.body)return e.tagName;var n=0;if(e.parentNode)for(var r=e.parentNode.childNodes,o=0;o<r.length;o++){var a=r[o];if(a===e)return i(e.parentNode)+"/"+e.tagName+"["+(n+1)+"]";1===a.nodeType&&a.tagName===e.tagName&&n++}}function a(e){var n=i(e);e.queryCache&&delete e.queryCache,e.parentNode.removeChild(e),v[n+"-config"]&&v[n+"-config"].configContext&&"function"==typeof v[n+"-config"].configContext.onunload&&v[n+"-config"].configContext.onunload(v[n+"-config"].configContext,e,JSON.parse(v[n]),n),delete v[n];for(var t in v)0===t.indexOf(n)&&delete v[t]}function l(e){return(e=e&&parseInt(e.split("[").pop().slice(0,-1)))?parseInt(e)-1:0}function c(e,n,t){var r,l,s;if(e){null==n&&(n={_text:""});var h=f(e);if(s=o(n)){if(y[t]&&0===h.length&&(y[t].parent.insertAdjacentHTML("beforeend",y[t].node),h=f(y[t].parent.children),"object"==typeof n[0]&&(n[0].__magnum__=h[0].__key=0)),0===h.length)return;for(l=h[0].parentNode,y[t]||(y[t]={node:h[0].cloneNode(!0).outerHTML,parent:l});h.length<n.length;){var d=h.length;y[t]?(l.insertAdjacentHTML("beforeend",y[t].node),r=l.lastChild):r=h[0].cloneNode(!0),"object"==typeof n[d]&&(n[d].__magnum__=d,r.__key=d++),h.push(r),l&&l.appendChild(r)}if(h.length>n.length)if(0==n.length||"object"!=typeof n[0])for(;h.length>n.length;)r=h.pop(),(l=r.parentNode)&&a(r);else h=h.filter(function(e){return 0==n.filter(function(n){return n.__magnum__==e.__key}).length?(a(e),!1):!0})}for(t=0;t<h.length;t++)r=i(h[t]),s?!h[t]||v[r]&&v[r]===JSON.stringify(n[t])||(c(h[t],n[t]),v[r]=JSON.stringify(n[t]),h[t].queryCache&&delete h[t].queryCache):u(h[t],n);return e}}function u(e,n){var t;if("function"!=typeof n){if("object"!=typeof n)return u(e,{_text:n});for(var l in n){var f=n[l];f===r?f="":null===f&&-1===["onunload"].indexOf(l)&&g(e,l).forEach(function(e){a(e)}),"_"===l[0]&&(t=t||{},t[l.substr(1)]=f)}var h=i(e);t&&s(e,t);var d=0;for(l in n)if(f=n[l],"_"!==l[0]){if(t=g(e,l),"function"==typeof f&&"fun"==f.type)try{f=f()}catch(p){}o(f)&&(t=g(e,"$"+l)),c(t,f,h+"/"+l),d++}}}function f(e){var n;if(null==e.length&&(e=[e]),!o(e)){n=[];for(var t=0;t<e.length;t+=1)e[t]&&n.push(e[t]);e=n}return e}function s(t,r){var o=i(t),a=!1,c=l(o);v[o]&&v[o]===JSON.stringify(r)&&(a=!0),t._events=t._events||[];for(var u in r)if("text"!==u&&"html"!==u)if(0==u.indexOf("on")){if(-1===t._events.indexOf(u)||w){var f=function(n,t,r,o){try{return n.call(t,o,r,t)}finally{e.redraw()}}.bind(null,r[u],t,c);t[u]=f,t._events.push(u)}}else if("config"==u){f=!0,v[o+"-config"]?f=!1:v[o+"-config"]={};var s=v[o+"-config"].configContext=v[o+"-config"].configContext||{};n.push(function(e,n){return function(){return e.apply(e,n)}}(r[u],[t,f,s,c]))}else f={key:u,cache:a,value:r[u],node:t},e.hook("attributes",u,f),f.change&&(u=f.key,r[u]=f.value),a||(null===r[u]?t.removeAttribute(u):t.setAttribute(u,""+r[u]));a||(h(t,r.text),d(t,r.html),v[o]=JSON.stringify(r),t.queryCache&&delete t.queryCache)}function h(e,n){var t,r;if(i(e),e&&null!=n){if(!r){r=[];for(var o=0;o<e.childNodes.length;o+=1)t=e.childNodes[o],t.nodeType===p&&r.push(t)}for(;e.firstChild;)e.removeChild(e.firstChild);for("input"===e.nodeName.toLowerCase()?e.setAttribute("value",""+n):e.appendChild(e.ownerDocument.createTextNode(""+n)),o=0;o<r.length;o+=1)e.appendChild(r[o])}}function d(e,n){e&&null!=n&&(e.innerHTML=n)}function g(e,n,t){for(var r=e.childNodes,o=[],i=0;i<r.length;i+=1)r[i].nodeType===p&&o.push(r[i]);if(r=[],i=n,!e.queryCache||!e.queryCache[n]||"$"===n[0]){e.queryCache=(e.queryCache||{})[n]=[];var a="$"===n[0];"$"===i[0]&&(i=i.substr(1));for(var l=0;l<o.length;l+=1){var c=o[l],u=i,f=" "+c.className+" ";(c.id===u||-1<f.indexOf(" "+u+" ")||c.name===u||c.nodeName.toLowerCase()===u.toLowerCase()||c.getAttribute("data-bind")===u)&&r.push(o[l])}if(!r.length||a)for(l=0;l<o.length&&(r=r.concat(g(o[l],n,!0)),!r.length||a);l++);!t&&!r.length,e.queryCache[n]=r}return e.queryCache[n]}var p=1,v=[],y={},v=[],w=!1;e.fill={fill:c,find:g,clear:function(){w=!0},unclear:function(){w=!1},configs:n},window.mag=e}(window.mag||{},[],document),function(e){function n(){b=null;for(var e=0;e<_.length;e++)_[e]();_.length=0}var t={noMore:!1,useDirtyCheck:!1},r=[],o=[],i=[],a=!1;try{a=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(l){}var c=function(e){var n={};return e&&"[object Function]"==n.toString.call(e)},u=function(e){return"[object Array]"===Object.prototype.toString.call(e)},f=function(e){return"[object Object]"==={}.toString.apply(e)},s=function(e){if(null==e||"undefined"==typeof object||"object"!=typeof e)return e;var n,t=new e.constructor;for(n in e)t[n]=e[n];return t},h=function(e,n,t,r){try{Object.observe(e,function(e){e.forEach(function(e){e.name===n&&r(e.object[e.name])})})}catch(o){try{Object.defineProperty(e,n,{get:t,set:function(e){r.call(this,e,!0)},enumerable:!0,configurable:!0})}catch(i){try{Object.prototype.__defineGetter__.call(e,n,t),Object.prototype.__defineSetter__.call(e,n,function(e){r.call(this,e,!0)})}catch(a){g(e,n,r)}}}},d=function(e,n,t){try{Object.defineProperty(e,n,{enumerable:!1,configurable:!0,writable:!1,value:t})}catch(r){e[n]=t}},g=function(e,n,t){o[o.length]={prop:n,object:e,orig:s(e[n]),callback:t}},p=function(e,n,t,r){if("string"!=typeof e&&(e instanceof Object||u(e))){if(u(e)){if(N(e,"__watchall__",n,t),void 0===t||t>0)for(var o=0;o<e.length;o++)p(e[o],n,t,r)}else{var i=[];for(o in e)"$val"==o||!a&&"watchers"===o||Object.prototype.hasOwnProperty.call(e,o)&&i.push(o);v(e,i,n,t,r)}r&&M(e,"$$watchlengthsubjectroot",n,t)}},v=function(e,n,t,r,o){if("string"!=typeof e&&(e instanceof Object||u(e)))for(var i=0;i<n.length;i++)y(e,n[i],t,r,o)},y=function(e,n,t,r,o){"string"!=typeof e&&(e instanceof Object||u(e))&&(c(e[n])||(null==e[n]||void 0!==r&&0>=r||p(e[n],t,void 0!==r?r-1:r),N(e,n,t,r),o&&(void 0===r||r>0)&&M(e,n,t,r)))},w=function(e,n){if(!(e instanceof String)&&(e instanceof Object||u(e)))if(u(e)){for(var t=["__watchall__"],r=0;r<e.length;r++)t.push(r);m(e,t,n)}else{var o=function(e){var t,r=[];for(t in e)e.hasOwnProperty(t)&&(e[t]instanceof Object?o(e[t]):r.push(t));m(e,r,n)};o(e)}},m=function(e,n,t){for(var r in n)n.hasOwnProperty(r)&&A(e,n[r],t)},_=[],b=null,j=function(e){null==b&&(b||(b=setTimeout(n))),_[_.length]=e},O=function(e,t,r,o){var i=null,a=-1,l=u(e);p(e,function(r,o,c,u){var f=(b||(b=setTimeout(n)),b);if(a!==f&&(a=f,i={type:"update"},i.value=e,i.splices=null,j(function(){t.call(this,i),i=null})),l&&e===this&&null!==i){if("pop"===o||"shift"===o)c=[],u=[u];else if("push"===o||"unshift"===o)c=[c],u=[];else if("splice"!==o)return;i.splices||(i.splices=[]),i.splices[i.splices.length]={index:r,deleteCount:u?u.length:0,addedCount:c?c.length:0,added:c,deleted:u}}},1==r?void 0:0,o)},C=function(e,n,t,r,o){e&&n&&(y(e,n,function(e,n,i,a){e={type:"update"},e.value=i,e.oldvalue=a,(r&&f(i)||u(i))&&O(i,t,r,o),t.call(this,e)},0),(r&&f(e[n])||u(e[n]))&&O(e[n],t,r,o))},N=function(e,n,r,o){var i=!1,a=u(e);for(e.watchers||(d(e,"watchers",{}),a&&S(e,function(t,r,i,a){if($(e,t,r,i,a),0!==o&&i&&(f(i)||u(i))){var l,c;for(t=e.watchers[n],(l=e.watchers.__watchall__)&&(t=t?t.concat(l):l),c=t?t.length:0,l=0;c>l;l++)if("splice"!==r)p(i,t[l],void 0===o?o:o-1);else for(a=0;a<i.length;a++)p(i[a],t[l],void 0===o?o:o-1)}})),e.watchers[n]||(e.watchers[n]=[],a||(i=!0)),a=0;a<e.watchers[n].length;a++)if(e.watchers[n][a]===r)return;if(e.watchers[n].push(r),i){var l=e[n];r=function(){return l},i=function(r,i){var a=l;if(l=r,0!==o&&e[n]&&(f(e[n])||u(e[n]))&&!e[n].watchers){var c,s=e.watchers[n].length;for(c=0;s>c;c++)p(e[n],e.watchers[n][c],void 0===o?o:o-1)}return e.watchers&&(e.watchers.__wjs_suspend__||e.watchers["__wjs_suspend__"+n])?void q(e,n):void(t.noMore||a!==r&&(i?$(e,n,"set",r,a):k(e,n,"set",r,a),t.noMore=!1))},t.useDirtyCheck?g(e,n,i):h(e,n,r,i)}},k=function(e,n,t,r,o){if(void 0!==n){var i,a=e.watchers[n];(i=e.watchers.__watchall__)&&(a=a?a.concat(i):i),i=a?a.length:0;for(var l=0;i>l;l++)a[l].call(e,n,t,r,o)}else for(n in e)e.hasOwnProperty(n)&&k(e,n,t,r,o)},x="pop push reverse shift sort slice unshift splice".split(" "),T=function(e,n,t,r){d(e,t,function(){var o,i,a,l;if(o=0,"splice"===t){var c=arguments[0];for(a=e.slice(c,c+arguments[1]),i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];o=c}else i=0<arguments.length?arguments[0]:void 0;return l=n.apply(e,arguments),"slice"!==t&&("pop"===t?(a=l,o=e.length):"push"===t?o=e.length-1:"shift"===t?a=l:"unshift"!==t&&void 0===i&&(i=l),r.call(e,o,t,i,a)),l})},S=function(e,n){if(c(n)&&e&&!(e instanceof String)&&u(e))for(var t,r=x.length;r--;)t=x[r],T(e,e[t],t,n)},A=function(e,n,t){if(e.watchers[n])if(void 0===t)delete e.watchers[n];else for(var i=0;i<e.watchers[n].length;i++)e.watchers[n][i]==t&&e.watchers[n].splice(i,1);for(i=0;i<r.length;i++){var a=r[i];a.obj==e&&a.prop==n&&a.watcher==t&&r.splice(i,1)}for(t=0;t<o.length;t++)i=o[t],a=i.object.watchers,(i=i.object==e&&i.prop==n&&a&&(!a[n]||0==a[n].length))&&o.splice(t,1)},q=function(e,n){j(function(){delete e.watchers.__wjs_suspend__,delete e.watchers["__wjs_suspend__"+n]})},L=null,$=function(e,n,t,r,o){i[i.length]={obj:e,prop:n,mode:t,newval:r,oldval:o},null===L&&(L=setTimeout(J))},J=function(){var e=null;L=null;for(var n=0;n<i.length;n++)e=i[n],k(e.obj,e.prop,e.mode,e.newval,e.oldval);e&&(i=[])},M=function(e,n,t,o){var i;i=s("$$watchlengthsubjectroot"===n?e:e[n]),r.push({obj:e,prop:n,actual:i,watcher:t,level:o})};t.watch=function(){c(arguments[1])?p.apply(this,arguments):u(arguments[1])?v.apply(this,arguments):y.apply(this,arguments)},t.unwatch=function(){c(arguments[1])?w.apply(this,arguments):u(arguments[1])?m.apply(this,arguments):A.apply(this,arguments)},t.callWatchers=k,t.suspend=function(e,n){e.watchers&&(e.watchers["__wjs_suspend__"+(void 0!==n?n:"")]=!0)},t.onChange=function(){(c(arguments[2])?C:O).apply(this,arguments)},e.watch=t}(window.mag||{}),function(e){var n={modules:[],controllers:[],elements:[],getController:function(e,n,t){return"undefined"!=typeof Proxy?new Proxy(new e.controller,{get:function(e,r){if(void 0===e[r]&&-1===["watchers","toJSON","called","onload","onunload"].indexOf(r)){var o,i=t.find(n,r),a="$"===r[0],l=[];return i.forEach(function(e,n){i[n]&&(i[n].value&&0<i[n].value.length?(o=i[n].value,!i[n].type||"checkbox"!=i[n].type&&"radio"!=i[n].type||(o={_text:o,_checked:i[n].checked}),l.push(o)):i[n].innerText&&0<i[n].innerText.length?o=i[n].innerText:i[0].innerHTML&&0<i[n].innerHTML.length&&(o=i[n].innerHTML))}),a?l:o}return e[r]}}):new e.controller},submodule:function(e,n){var t=function(n){return(e.controller||function(){}).apply(this,n)}.bind({},n);return t.$original=e.controller,t={controller:t,view:function(t){1<arguments.length&&(n=n.concat([].slice.call(arguments,1)));var r=e.view.apply(e,n?[t].concat(n):[t]);return n[0]&&null!=n[0].key&&(r.attrs.key=n[0].key),r}},n[0]&&null!=n[0].key&&(t.attrs={key:n[0].key}),t},getArgs:function(e){return n.modules[e].controller&&n.modules[e].controller.$$args?[n.controllers[e]].concat(n.modules[e].controller.$$args):[n.controllers[e]]}};e.mod=n}(window.mag||{}),function(e){var n={roots:[],templates:{},cache:{},callOnload:function(e){for(var n,t=0;n=e.controllers[t];t++)n.onload&&!n.called&&(n.onload.call(null,e.elements[t]),n.called=1)},callConfigs:function(e){for(var n=0,t=e.length;t>n;n++)e[n]()}},t=[];n.redraw=function(e,t,r){e=e||n.module||{},this.fun||(this.fun=a(function(){t.configs.splice(0,t.configs.length),n.doLoop(e,t,r)})),this.fun()},n.doLoop=function(t,r,o){for(var i=0;n.roots[i];i++)e.running=!0,!t.controllers[i]||n.innerLoop(t,r,i,o);r.unclear()},n.clear=function(e,n,r){-1!==e&&t[e]&&r.clear()},n.innerLoop=function(e,r,o,i){var a=e.elements[o],l=e.getArgs(o);return t[o]&&t[o]===JSON.stringify(l[0])?e=!1:((e.getArgs(o),e.modules[o]).view(a,e.controllers[o]),t[o]=JSON.stringify(l[0]),n.setupWatch(i,l,r,a,o,e),r.fill(a,l[0]),n.callConfigs(r.configs),e=void n.callOnload(e)),e};var r;n.doWatch=function(o,i,a,l,c){c!=r&&(r=c,e.running=!0,c=l.getArgs(a),t[a]&&t[a]===JSON.stringify(c[0])||((l.getArgs(a),l.modules[a]).view(i,l.controllers[a]),t[a]=JSON.stringify(c[0]),o.fill(i,c[0]),n.callConfigs(o.configs),e.running=!1))},n.setupWatch=function(e,t,r,o,i,l){e.watch(t[0],a(n.doWatch.bind(null,r,o,i,l)),6,!0)};var o=window.cancelAnimationFrame||window.clearTimeout,i=window.requestAnimationFrame||window.setTimeout,a=function(e,n){var t,r,a=n||16;return function(){if(+new Date-t>a||i===window.requestAnimationFrame){r>0&&o(r);var n=arguments;r=i(function(){t=+new Date;var r=[].slice.call(arguments).concat([].slice.call(n));e.apply(this,r)},a)}else{t=+new Date;var l=[].slice.call(arguments).concat([].slice.call(n));e.apply(this,l),r=i(function(){r=null},a)}}};e.render=n}(window.mag||{}),function(e,n){var t=e.mod,r=e.render,o=e.fill,i=e.watch,a=e.running=!1;e.redraw=function(){a||(a=!0,r.redraw(t||r.module||{},o,i),a=!1)},e.withProp=function(e,n){return function(t){t=t||event,t=t.currentTarget||this,n(e in t?t[e]:t.getAttribute(e))}},e.prop=function(n){var t=function(){return arguments.length&&(n=arguments[0],e.redraw()),n};return t.type="fun",t.toJSON=function(){return n},t},e.hookins={attributes:[]},e.hookin=function(n,t,r){e.hookins[n].push({context:{},handler:r,key:t})},e.hook=function(n,t,r,o){for(var i in e.hookins[n])r.changed=!1,e.hookins[n][i].key==t&&(o=JSON.stringify({v:r.value,k:r.key}),e.hookins[n][i].handler.call(e.hookins[n][i].context,r),o!==JSON.stringify({v:r.value,k:r.key})&&(r.change=!0))};var l=[];e.module=function(i,a,c){var u=r.roots.indexOf(i);c&&!c.retain&&r.clear(u,i,o),0>u&&(u=r.roots.length);for(var f,s=!1,h={preventDefault:function(){s=!0}},d=0;f=l[d];d++)f.handler(h),f.controller.onunload=null;if(s)for(d=0;f=l[d];d++)f.controller.onunload=f.handler;else l=[];return s?void 0:(i=n.getElementById(i))?(r.roots[u]=i.id,a.view?(a=t.submodule(a,[c||{}]),c=t.getController(a,i,o),t.controllers[u]=c,c.onunload&&l.push({controller:c,handler:c.onunload}),t.modules[u]=a,t.elements[u]=i,e.redraw(),c.onload&&!e.running&&r.callOnload(t),{_html:i.innerHTML}):Error("module requires a view")):Error("invalid node")}}(window.mag||{},document);

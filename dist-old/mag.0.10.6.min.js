/*
Mag.JS v0.10.6
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,n,t,r){function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){if(""!==e.id)return'id("'+e.id+'")';if(e===t.body)return e.tagName;var n=0;if(e.parentNode)for(var r=e.parentNode.childNodes,o=0;o<r.length;o++){var l=r[o];if(l===e)return i(e.parentNode)+"/"+e.tagName+"["+(n+1)+"]";1===l.nodeType&&l.tagName===e.tagName&&n++}}function l(e){var n=i(e);e.parentNode.removeChild(e),w[n+"-config"]&&w[n+"-config"].configContext&&typeof w[n+"-config"].configContext.onunload===x&&w[n+"-config"].configContext.onunload(w[n+"-config"].configContext,e,n)}function a(e){return(e=e&&parseInt(e.split("[").pop().slice(0,-1)))?parseInt(e)-1:0}function c(e,n,t){var a,f,s;if(e){null==n&&(n={_text:""});var h=d(e);if(s=o(n)){if(_[t]=_[t]||0,O[t]&&0===h.length&&(O[t].parent.insertAdjacentHTML("beforeend",O[t].node),h=d(O[t].parent.children)),0===h.length)return void(_[t]=0);for(f=h[0].parentNode,O[t]||(O[t]={node:h[0].cloneNode(!0).outerHTML,parent:f});h.length<n.length;)O[t]?(f.insertAdjacentHTML("beforeend",O[t].node),a=f.lastChild):a=h[0].cloneNode(!0),h.push(a),f&&f.appendChild(a);if(h.map(function(e){return e.__key}),a=n.map(function(e){return e[N]}),(h.length==n.length||-1!==a.indexOf(r))&&(n=n.map(function(e,n){if("object"==typeof e){if(h[n].__key&&typeof e[N]===C)return e[N]=h[n].__key,e;typeof e[N]===C&&(e[N]=b+_[t]++),h[n].__key=e[N]}return e})),h.length>n.length)if(0===n.length||"object"!=typeof n[0])for(;h.length>n.length;)a=h.pop(),(f=a.parentNode)&&l(a);else var p=[],g=n.map(function(e){return e[N]}),h=(h.map(function(e){return e.__key}),h.filter(function(e){return-1===g.indexOf(e.__key)||-1!==p.indexOf(e.__key)?(p.push(e.__key),l(e),!1):(p.push(e.__key),!0)}))}for(a=0;a<h.length;a++)i(h[a]),s?h[a]&&c(h[a],n[a]):(n&&"object"==typeof n&&-1!==Object.keys(n).indexOf(N)&&(h[a][b]=h[a][b]||{},h[a][b].isChildOfArray=!0,h[a][b].dataPass=n),u(h[a],n));return e}}function f(e){return e.parentNode&&e.parentNode[b]&&e.parentNode[b].isChildOfArray?e.parentNode:e.parentNode?f(e.parentNode):void 0}function u(e,n){var t,a;if(typeof n!==x){if("object"!=typeof n)return u(e,{_text:n});for(var f in n){var d=n[f];d===r?d="":null===d&&-1===["onunload"].indexOf(f)&&v(e,f).forEach(function(e){l(e)}),"_"===f[0]&&(t=t||{},t[f.substr(1)]=d)}var h=i(e);t&&s(e,t),t=0;var p=["willupdate","didupdate","didload","willload"];for(f in n)-1===p.indexOf(f)&&(d=n[f],"_"!==f[0]&&(a=v(e,f),typeof d===x&&"fun"==d.type&&(d=d()),o(d)&&(a=v(e,"$"+f)),c(a,d,h+"/"+f),t++))}}function d(e){var n;if(null==e.length&&(e=[e]),!o(e)){n=[];for(var t=0;t<e.length;t+=1)e[t]&&n.push(e[t]);e=n}return e}function s(t,r){var o=i(t),l=a(o);t._events=t._events||[];for(var c in r)if("text"!==c&&"html"!==c)if(0==c.indexOf("on")){if(-1===t._events.indexOf(c)||k){var u=function(e,n,t,r){var o=f(n),l=o&&i(o),c=a(l);return e.call(n,r,t,n,{path:l,data:((o||{})[b]||[]).dataPass,node:o,index:c})}.bind({},r[c],t,l);t[c]=u,t._events.push(c)}}else if("config"==c){u=!0,w[o+"-config"]?u=!1:w[o+"-config"]={};var d=w[o+"-config"].configContext=w[o+"-config"].configContext||{};n.push(function(e,n){return function(){return e.apply(e,n)}}(r[c],[t,u,d,l]))}else u={key:c,value:r[c],node:t},e.hook("attributes",c,u),u.change&&(c=u.key,r[c]=u.value),null===r[c]?t.removeAttribute(c):t.setAttribute(c,""+r[c]);h(t,r.text),g(t,r.html)}function h(e,n){var t,r;if(e&&null!=n){if(!r){r=[];for(var o=0;o<e.childNodes.length;o+=1)t=e.childNodes[o],t.nodeType===y&&r.push(t)}for(;e.firstChild;)e.removeChild(e.firstChild);for("input"===e.nodeName.toLowerCase()?e.setAttribute("value",""+n):e.appendChild(e.ownerDocument.createTextNode(""+n)),o=0;o<r.length;o+=1)e.appendChild(r[o])}}function p(e){e.cloner&&(e.id=b+e.id.split(b).pop())}function g(e,n){if(e&&null!=n){for(;e.firstChild;)e.removeChild(e.firstChild);if(typeof n===x&&1===n().nodeType){p(n());var r=t.createElement("span");e.appendChild(r),e.replaceChild(n(),r)}else 1===n.nodeType?(p(n),r=t.createElement("span"),e.appendChild(r),e.replaceChild(n,r)):e.innerHTML=n}}function v(n,t,r){for(var o=n.childNodes,i=[],l=0;l<o.length;l+=1)o[l].nodeType===y&&i.push(o[l]);var o=[],l=t,a="$"===t[0];"$"===l[0]&&(l=l.substr(1));for(var c=0;c<i.length;c+=1){var f=i[c],u=l,d=" "+f.className+" ";(f.id===u||-1<d.indexOf(" "+u+" ")||f.name===u||f.nodeName.toLowerCase()===u.toLowerCase()||f.getAttribute("data-bind")===u)&&o.push(i[c])}if(!o.length||a)for(c=0;c<i.length&&(o=o.concat(v(i[c],t,!0)),!o.length||a);c++);return r||o.length||(n={key:t,value:o,node:n},e.hook("elementMatcher",t,n),n.change),o}function m(e,n){if(n={tagName:e.tagName},e.firstChild||e.children[0]){var t=e.firstChild||e.childNodes[0];(t=t.nodeValue||t.value||t.innerText)&&(t=t.replace(/\u00a0/g,"x").trim()),t&&(n.tagValue=t)}for(t=0;t<e.attributes.length;t++)n[e.attributes[t].name]=e.attributes[t].value;var r=e.children;if(r.length)for(n.children=[],t=0;t<r.length;t++)n.children[t]=m(r[t],n.children);return n}var y=1,w=[],b="__magnum__",x="function",C="undefined",N="_key",O={},_={},k=!1;e.fill={fill:c,elementToObject:m,cached:w,find:v,clear:function(){k=!0},unclear:function(){k=!1},configs:n},window.mag=e}(window.mag||{},[],document),function(e){function n(e){var t,r;Object.freeze(e);for(r in e)t=e[r],e.hasOwnProperty(r)&&"object"==typeof t&&!Object.isFrozen(t)&&n(t)}var t={modules:[],promises:[],deferreds:[],controllers:[],elements:[],getController:function(e,n,t){return"undefined"!=typeof Proxy?new Proxy(new e.controller,{get:function(e,r){if(void 0===e[r]&&-1===["watchers","toJSON","called","onload","onunload"].indexOf(r)){var o,i=t.find(n,r),l="$"===r[0],a=[];return i.forEach(function(e,n){i[n]&&(i[n].value&&0<i[n].value.length?(o=i[n].value,!i[n].type||"checkbox"!=i[n].type&&"radio"!=i[n].type||(o={_text:o,_checked:i[n].checked},a.push(o))):i[n].innerText&&0<i[n].innerText.length?o=i[n].innerText:i[0].innerHTML&&0<i[n].innerHTML.length&&(o=i[n].innerHTML))}),0<a.length&&l?a:o}return e[r]}}):new e.controller},submodule:function(e,t){n(t);var r=function(n){return(e.controller||function(){}).apply(this,n)}.bind({},t);return r.$original=e.controller,r.$$args=t,r={controller:r,view:function(n){if(1<arguments.length)var r=t.concat([].slice.call(arguments,1));r=e.view.apply(e,r?[n].concat(r):[n]),t[0]&&null!=t[0].key&&(r.attrs.key=t[0].key)}},t[0]&&null!=t[0].key&&(r.attrs={key:t[0].key}),r},getArgs:function(e){return t.modules[e].controller&&t.modules[e].controller.$$args?[t.controllers[e]].concat(t.modules[e].controller.$$args):[t.controllers[e]]}};e.mod=t}(window.mag||{}),function(e){function n(e,n,t){var r=n.getArgs(t),o=n.modules[t];n.controllers[t],n=i.contexts[t]=i.contexts[t]||{},o.view(r[0],e,n)}function t(e,n,t){var r;return function(){var o=this,i=arguments;r?c(r):t&&e.apply(o,i),r=f(function(){t||e.apply(o,i),r=null},n)}}function r(e){var n,t=Object.getNotifier(e);for(n in e){var o=e[n];if(!o||"object"!=typeof o)break;Object.observe(o,function(e){e.forEach(function(e){t.notify(e)})}),r(o)}}function o(e,n){e&&void 0!==Object.observe&&(r(e),Object.observe(e,t(n,16)))}var i={roots:[],contexts:[],templates:{},unloaders:[],cache:{}},l=function(e,n){return i.cache[e]&&i.cache[e]===JSON.stringify(n)?!0:void(i.cache[e]=JSON.stringify(n))};i.callLCEvent=function(e,n,t,r){var o=!1,l={preventDefault:function(){o=!0}};if(n.controllers[t][e]&&(n.controllers[t][e].call({},l,n.elements[t]),r&&(n.controllers[t][e]=0)),o)for(r=0;e=i.unloaders[r];r++)e.controller.onunload&&(e.handler.call(e.controller,n.elements[t]),e.controller.onunload=0);return o},i.callConfigs=function(e){for(var n=0,t=e.length;t>n;n++)e[n]()},i.redraw=function(e,n,t){e=e||i.module||{},t&&(cache={}),this.fun=this.fun||u(function(){n.configs.splice(0,n.configs.length),i.doLoop(e,n)}),this.fun()},i.doLoop=function(n,t){for(var r=0;i.roots[r];r++)if(n.controllers[r]&&n.elements[r]){if(i.callLCEvent("willload",n,r,1))return;if(i.innerLoop(n,t,r)){n.deferreds[r][2]({_html:e.prop(n.elements[r])}),i.callLCEvent("didload",n,r,1),i.callConfigs(t.configs);var o=n,l=t,a=r,c=void 0;for(c in l.cached)-1!==c.indexOf('id("'+o.elements[a].id+'")/')&&-1!==c.indexOf("-config")&&l.cached[c].configContext&&i.unloaders.push({controller:l.cached[c].configContext,handler:l.cached[c].configContext.onunload});n.deferreds[r][0]&&(o=n.deferreds[r][1],delete n.elements[o],n.modules[o],n.controllers[o],n.promises[o],n.deferreds[o])}}t.unclear()},i.clear=function(e,n,t){-1!==e&&i.cache[e]&&t.clear()},i.innerLoop=function(e,t,r){var o=e.elements[r],a=e.getArgs(r);return l(r,a)?!1:(n(o,e,r),i.setupWatch(a,t,o,r,e),t.fill(o,a[0]),!0)};var a;i.doWatch=function(e,t,r,o,c,f){if(f!=a){if(a=f,i.callLCEvent("willupdate",o,r,1),c=o.getArgs(r),l(r,c))return void i.callLCEvent("didupdate",o,r);i.callLCEvent("isupdate",o,r),n(t,o,r),e.fill(t,c[0])}},i.setupWatch=function(e,n,t,r,l){o(e[0],function(o){o.forEach(function(){}),l.controllers[r]=e[0],u(i.doWatch.bind({},n,t,r,l,o))()})};var c=window.cancelAnimationFrame||window.clearTimeout,f=window.requestAnimationFrame||window.setTimeout,u=function(e,n){var t,r,o=n||16;return function(){if(+new Date-t>o||f===window.requestAnimationFrame){r>0&&c(r);var n=arguments;r=f(function(){t=+new Date;var r=[].slice.call(arguments).concat([].slice.call(n));e.apply(this,r)},o)}else{t=+new Date;var i=[].slice.call(arguments).concat([].slice.call(n));e.apply(this,i),r=f(function(){r=null},o)}}};e.render=i}(window.mag||{}),function(e,n){function t(n){var t=function(){return arguments.length&&(n=arguments[0],e.redraw()),n};return t.type="fun",t.toJSON=function(){return n&&n.nodeType?l.elementToObject(n):n},t}function r(n,t){var o=e.prop(t);return n.then(o),o.then=function(e,o){return r(n.then(e,o),t)},o}var o=e.mod,i=e.render,l=e.fill,a={}.toString,c={attributes:[],elementMatcher:[]};e.redraw=function(e){i.redraw(o||i.module||{},l,e)},e.withProp=function(e,n){return function(t){t=t||event,t=t.currentTarget||this,n(e in t?t[e]:t.getAttribute(e))}},e.prop=function(e){return(null!=e&&"[object Object]"===a.call(e)||"function"==typeof e)&&"function"==typeof e.then?r(e):t(e)},e.hookin=function(e,n,t){c[e].push({context:{},handler:t,key:n})},e.hook=function(e,n,t,r){for(var o in c[e])t.changed=!1,c[e][o].key==n&&(r=JSON.stringify({v:t.value,k:t.key}),c[e][o].handler.call(c[e][o].context,t),r!==JSON.stringify({v:t.value,k:t.key})&&(t.change=!0))},e.module=function(t,a,c,f){var u=i.roots.indexOf(t);c&&!c.retain&&i.clear(u,t,l),(0>u||f)&&(u=i.roots.length);var d=n.getElementById(t);if(!d)throw Error("Mag.JS Module - invalid node id: "+t);if(i.roots[u]=d.id,!a.view)throw Error("Mag.JS module - requires a view: "+JSON.stringify(a));return t=o.submodule(a,[Object.freeze(c||{})]),a=o.getController(t,d,l),o.controllers[u]=a,a.onunload&&i.unloaders.push({controller:a,handler:a.onunload}),o.modules[u]=t,o.elements[u]=f?d.cloneNode(!0):d,o.elements[u].cloner=f,o.promises[u]=new Promise(function(){o.deferreds[u]=arguments}.bind({},f,u)),e.redraw(),r(o.promises[u],{_html:e.prop(o.elements[u])})}}(window.mag||{},document);

/*
* MagnumJS - By Michael Glazer April 2015
* https://github.com/magnumjs/mag.js
*/
!function(n,e,t,r){function o(n){return"[object Array]"===Object.prototype.toString.call(n)}function i(n){if(""!==n.id)return'id("'+n.id+'")';if(n===t.body)return n.tagName;for(var e=0,r=n.parentNode.childNodes,o=0;o<r.length;o++){var a=r[o];if(a===n)return i(n.parentNode)+"/"+n.tagName+"["+(e+1)+"]";1===a.nodeType&&a.tagName===n.tagName&&e++}}function a(n,e,t,r){var u,s,f;if(n){null==e&&(e={_text:""});var h=c(n);if(f=o(e)){if(v[t+r]&&0===h.length&&(v[t+r].parent.insertAdjacentHTML("beforeend",v[t+r].node),h=c(v[t+r].parent.children)),0===h.length)return;for(s=h[0].parentNode,v[t+r]||(v[t+r]={node:h[0].cloneNode(!0).outerHTML,parent:s});h.length<e.length;)v[t+r]?(s.insertAdjacentHTML("beforeend",v[t+r].node),u=s.lastChild):u=h[0].cloneNode(!0),h.push(u),s&&s.appendChild(u);for(;h.length>e.length;)u=h.pop(),s=u.parentNode,s&&s.removeChild(u)}for(var d=0;d<h.length;d++){var p=i(h[d]);if(f){if(h[d]){if(w[p]&&w[p]===JSON.stringify(e[d]))continue;a(h[d],e[d]),w[p]=JSON.stringify(e[d])}}else w[p]&&w[p]===JSON.stringify(e),l(h[d],e),w[p]=JSON.stringify(e)}return n}}function l(n,e){var t,o;if("function"!=typeof e){if("object"!=typeof e)return l(n,{_text:e});for(var i in e){var c=e[i];c===r&&(c=""),"_"===i[0]&&(t=t||{},t[i.substr(1)]=c)}t&&u(n,t);var s=0;for(var i in e){var c=e[i];if("_"!==i[0]){if(o=h(n,i),"function"==typeof c&&"fun"==c.type)try{c=c()}catch(f){}a(o,c,i,s),s++}}}}function c(n){var e;if(null==n.length&&(n=[n]),!o(n)){e=[];for(var t=0;t<n.length;t+=1)n[t]&&e.push(n[t]);n=e}return n}function u(t,r){s(t,r.text),f(t,r.html),t._events=t._events||[];for(var o in r)if("text"!==o&&"html"!==o)if(0==o.indexOf("on")){if(-1!==t._events.indexOf(o))continue;var i=function(e,t,r){e.call(t,r),n.redraw()}.bind(null,r[o],t);t.addEventListener(o.substr(2),i),t._events.push(o)}else{if("config"==o){var a=!0,l=function(n,e){return function(){return n.apply(n,e)}};e.push(l(r[o],[t,a]));continue}null===r[o]?t.removeAttribute(o):t.setAttribute(o,""+r[o])}}function s(n,e){var t,r;if(n&&null!=e){if(!r){r=[];for(var o=0;o<n.childNodes.length;o+=1)t=n.childNodes[o],t.nodeType===g&&r.push(t)}for(;n.firstChild;)n.removeChild(n.firstChild);"input"===n.nodeName.toLowerCase()?n.setAttribute("value",""+e):n.appendChild(n.ownerDocument.createTextNode(""+e));for(var o=0;o<r.length;o+=1)n.appendChild(r[o])}}function f(n,e){n&&null!=e&&(n.innerHTML=e)}function h(n,e,t){var r=d(n),o=[],i=e;if(!(n.queryCache||{})[e]){n.queryCache=(n.queryCache||{})[e]=[];var a="$"===e[0];"$"===i[0]&&(i=i.substr(1));for(var l=0;l<r.length;l+=1)p(r[l],i)&&o.push(r[l]);if(!o.length||a)for(var l=0;l<r.length&&(o=o.concat(h(r[l],e,!0)),!o.length||a);l++);!t&&!o.length,n.queryCache[e]=o}return n.queryCache[e]}function d(n){for(var e=n.childNodes,t=[],r=0;r<e.length;r+=1)e[r].nodeType===g&&t.push(e[r]);return t}function p(n,e){var t=" "+n.className+" ";return n.id===e||t.indexOf(" "+e+" ")>-1||n.name===e||n.nodeName.toLowerCase()===e.toLowerCase()||n.getAttribute("data-bind")===e}var g=1,v={},w=[];n.fill={fill:a,configs:e},window.mag=n}(window.mag||{},[],document),function(n){function e(){O=null;for(var n=0;n<j.length;n++)j[n]();j.length=0}var t={noMore:!1,useDirtyCheck:!1},r=[],o=[],i=[],a=!1;try{a=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(l){}var c=function(n){var e={};return n&&"[object Function]"==e.toString.call(n)},u=function(n){return"[object Array]"===Object.prototype.toString.call(n)},s=function(n){return"[object Object]"==={}.toString.apply(n)},f=function(n){if(null==n||"object"!=typeof n)return n;var e=n.constructor();for(var t in n)e[t]=n[t];return e},h=function(n,e,t,r){try{Object.observe(n,function(n){n.forEach(function(n){n.name===e&&r(n.object[n.name])})})}catch(o){try{Object.defineProperty(n,e,{get:t,set:function(n){r.call(this,n,!0)},enumerable:!0,configurable:!0})}catch(i){try{Object.prototype.__defineGetter__.call(n,e,t),Object.prototype.__defineSetter__.call(n,e,function(n){r.call(this,n,!0)})}catch(a){p(n,e,r)}}}},d=function(n,e,t){try{Object.defineProperty(n,e,{enumerable:!1,configurable:!0,writable:!1,value:t})}catch(r){n[e]=t}},p=function(n,e,t){o[o.length]={prop:e,object:n,orig:f(n[e]),callback:t}},g=function(){c(arguments[1])?v.apply(this,arguments):u(arguments[1])?w.apply(this,arguments):m.apply(this,arguments)},v=function(n,e,t,r){if("string"!=typeof n&&(n instanceof Object||u(n))){if(u(n)){if(L(n,"__watchall__",e,t),void 0===t||t>0)for(var o=0;o<n.length;o++)v(n[o],e,t,r)}else{var o,i=[];for(o in n)"$val"==o||!a&&"watchers"===o||Object.prototype.hasOwnProperty.call(n,o)&&i.push(o);w(n,i,e,t,r)}r&&F(n,"$$watchlengthsubjectroot",e,t)}},w=function(n,e,t,r,o){if("string"!=typeof n&&(n instanceof Object||u(n)))for(var i=0;i<e.length;i++){var a=e[i];m(n,a,t,r,o)}},m=function(n,e,t,r,o){"string"!=typeof n&&(n instanceof Object||u(n))&&(c(n[e])||(null==n[e]||void 0!==r&&0>=r||v(n[e],t,void 0!==r?r-1:r),L(n,e,t,r),o&&(void 0===r||r>0)&&F(n,e,t,r)))},y=function(){c(arguments[1])?_.apply(this,arguments):u(arguments[1])?b.apply(this,arguments):J.apply(this,arguments)},_=function(n,e){if(!(n instanceof String)&&(n instanceof Object||u(n)))if(u(n)){for(var t=["__watchall__"],r=0;r<n.length;r++)t.push(r);b(n,t,e)}else{var o=function(n){var t=[];for(var r in n)n.hasOwnProperty(r)&&(n[r]instanceof Object?o(n[r]):t.push(r));b(n,t,e)};o(n)}},b=function(n,e,t){for(var r in e)e.hasOwnProperty(r)&&J(n,e[r],t)},j=[],O=null,N=function(){return O||(O=setTimeout(e)),O},C=function(n){null==O&&N(),j[j.length]=n},A=function(){var n=c(arguments[2])?T:S;n.apply(this,arguments)},S=function(n,e,t,r){var o,i=null,a=-1,l=u(n),c=function(t,r,o,c){var u=N();if(a!==u&&(a=u,i={type:"update"},i.value=n,i.splices=null,C(function(){e.call(this,i),i=null})),l&&n===this&&null!==i){if("pop"===r||"shift"===r)o=[],c=[c];else if("push"===r||"unshift"===r)o=[o],c=[];else if("splice"!==r)return;i.splices||(i.splices=[]),i.splices[i.splices.length]={index:t,deleteCount:c?c.length:0,addedCount:o?o.length:0,added:o,deleted:c}}};o=1==t?void 0:0,v(n,c,o,r)},T=function(n,e,t,r,o){n&&e&&(m(n,e,function(n,e,i,a){var l={type:"update"};l.value=i,l.oldvalue=a,(r&&s(i)||u(i))&&S(i,t,r,o),t.call(this,l)},0),(r&&s(n[e])||u(n[e]))&&S(n[e],t,r,o))},L=function(n,e,r,o){var i=!1,a=u(n);n.watchers||(d(n,"watchers",{}),a&&k(n,function(t,r,i,a){if(H(n,t,r,i,a),0!==o&&i&&(s(i)||u(i))){var l,c,f,h,d=n.watchers[e];for((h=n.watchers.__watchall__)&&(d=d?d.concat(h):h),f=d?d.length:0,l=0;f>l;l++)if("splice"!==r)v(i,d[l],void 0===o?o:o-1);else for(c=0;c<i.length;c++)v(i[c],d[l],void 0===o?o:o-1)}})),n.watchers[e]||(n.watchers[e]=[],a||(i=!0));for(var l=0;l<n.watchers[e].length;l++)if(n.watchers[e][l]===r)return;if(n.watchers[e].push(r),i){var c=n[e],f=function(){return c},g=function(r,i){var a=c;if(c=r,0!==o&&n[e]&&(s(n[e])||u(n[e]))&&!n[e].watchers){var l,f=n.watchers[e].length;for(l=0;f>l;l++)v(n[e],n.watchers[e][l],void 0===o?o:o-1)}return M(n,e)?void D(n,e):void(t.noMore||a!==r&&(i?H(n,e,"set",r,a):$(n,e,"set",r,a),t.noMore=!1))};t.useDirtyCheck?p(n,e,g):h(n,e,f,g)}},$=function(n,e,t,r,o){if(void 0!==e){var i,a,l=n.watchers[e];(a=n.watchers.__watchall__)&&(l=l?l.concat(a):a),i=l?l.length:0;for(var c=0;i>c;c++)l[c].call(n,e,t,r,o)}else for(var e in n)n.hasOwnProperty(e)&&$(n,e,t,r,o)},x=["pop","push","reverse","shift","sort","slice","unshift","splice"],P=function(n,e,t,r){d(n,t,function(){var o,i,a,l,c=0;if("splice"===t){var u=arguments[0],s=u+arguments[1];for(a=n.slice(u,s),i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];c=u}else i=arguments.length>0?arguments[0]:void 0;return l=e.apply(n,arguments),"slice"!==t&&("pop"===t?(a=l,c=n.length):"push"===t?c=n.length-1:"shift"===t?a=l:"unshift"!==t&&void 0===i&&(i=l),r.call(n,c,t,i,a)),l})},k=function(n,e){if(c(e)&&n&&!(n instanceof String)&&u(n))for(var t,r=x.length;r--;)t=x[r],P(n,n[t],t,e)},J=function(n,e,t){if(n.watchers[e])if(void 0===t)delete n.watchers[e];else for(var r=0;r<n.watchers[e].length;r++){var o=n.watchers[e][r];o==t&&n.watchers[e].splice(r,1)}B(n,e,t),G(n,e)},q=function(n,e){if(n.watchers){var t="__wjs_suspend__"+(void 0!==e?e:"");n.watchers[t]=!0}},M=function(n,e){return n.watchers&&(n.watchers.__wjs_suspend__||n.watchers["__wjs_suspend__"+e])},D=function(n,e){C(function(){delete n.watchers.__wjs_suspend__,delete n.watchers["__wjs_suspend__"+e]})},E=null,H=function(n,e,t,r,o){i[i.length]={obj:n,prop:e,mode:t,newval:r,oldval:o},null===E&&(E=setTimeout(W))},W=function(){var n=null;E=null;for(var e=0;e<i.length;e++)n=i[e],$(n.obj,n.prop,n.mode,n.newval,n.oldval);n&&(i=[],n=null)},F=function(n,e,t,o){var i;i=f("$$watchlengthsubjectroot"===e?n:n[e]),r.push({obj:n,prop:e,actual:i,watcher:t,level:o})},B=function(n,e,t){for(var o=0;o<r.length;o++){var i=r[o];i.obj==n&&i.prop==e&&i.watcher==t&&r.splice(o,1)}},G=function(n,e){for(var t,r=0;r<o.length;r++){var i=o[r],a=i.object.watchers;t=i.object==n&&i.prop==e&&a&&(!a[e]||0==a[e].length),t&&o.splice(r,1)}};t.watch=g,t.unwatch=y,t.callWatchers=$,t.suspend=q,t.onChange=A,n.watch=t}(window.mag||{}),function(n){var e={modules:[],controllers:[],elements:[]};e.submodule=function(n,e){var t=function(e){return(n.controller||function(){}).apply(this,e)}.bind({},e),r=function(t){arguments.length>1&&(e=e.concat([].slice.call(arguments,1)));var r=n.view.apply(n,e?[t].concat(e):[t]);return e[0]&&null!=e[0].key&&(r.attrs.key=e[0].key),r};t.$original=n.controller;var o={controller:t,view:r};return e[0]&&null!=e[0].key&&(o.attrs={key:e[0].key}),o},e.getArgs=function(n){var t=e.modules[n].controller&&e.modules[n].controller.$$args?[e.controllers[n]].concat(e.modules[n].controller.$$args):[e.controllers[n]];return t},n.mod=e}(window.mag||{}),function(n){function e(n,e,t){var r=(e.getArgs(t),e.modules[t]),o=e.controllers[t];r.view(n,o)}var t={roots:[],templates:{},cache:{}};t.callOnload=function(n){for(var e,t=0;e=n.controllers[t];t++)e.onload&&!e.called&&(e.onload.call(null,n.elements[t]),e.called=1)},t.callConfigs=function(n){for(var e=0,t=n.length;t>e;e++)n[e]()};var r=[];t.redraw=function(n,e,r){n=n||t.module||{},this.fun||(this.fun=a(function(){e.configs.splice(0,e.configs.length),t.doLoop(n,e,r)})),this.fun()},t.doLoop=function(e,r,o){for(var i,a=0;i=t.roots[a];a++)n.running=!0,!e.controllers[a]||t.innerLoop(e,r,a,o)},t.innerLoop=function(n,o,i,a){var l=n.elements[i],c=n.getArgs(i);return r[i]&&r[i]===JSON.stringify(c[0])?!1:(e(l,n,i),r[i]=JSON.stringify(c[0]),t.setupWatch(a,c,o,l,i,n),o.fill(l,c[0]),void t.callConfigs(o.configs))},t.doWatch=function(o,i,a,l){n.running=!0;var c=l.getArgs(a);r[a]&&r[a]===JSON.stringify(c[0])||(e(i,l,a),r[a]=JSON.stringify(c[0]),o.fill(i,c[0]),t.callConfigs(o.configs),t.callOnload(l),n.running=!1)},t.setupWatch=function(n,e,r,o,i,l){n.watch(e[0],a(t.doWatch.bind(null,r,o,i,l)))};var o=window.cancelAnimationFrame||window.clearTimeout,i=window.requestAnimationFrame||window.setTimeout,a=function(n,e){var t,r,a=e||16;return function(){+new Date-t>a||i===window.requestAnimationFrame?(r>0&&o(r),r=i(function(){t=+new Date,n.apply(this,arguments)},a)):(t=+new Date,n.apply(this,arguments))}};n.render=t}(window.mag||{}),function(n,e){var t,r={},o=n.mod,i=n.render,a=n.fill,l=n.watch;n.running=!1,r.init=function(){};var c=!1;r.redraw=function(){c||(c=!0,i.redraw(o||i.module||{},a,l),c=!1)},r.withProp=function(n,e){return function(t){t=t||event;var r=t.currentTarget||this;e(n in r?r[n]:r.getAttribute(n))}},r.prop=function(n){var e=function(){return arguments.length&&(n=arguments[0],r.redraw()),n};return e.type="fun",e.toJSON=function(){return n},e},r.module=function(a,l,c){var u=i.roots.indexOf(a);0>u&&(u=i.roots.length);var s=e.getElementById(a);if(!s)return Error("invalid node");var f=s.parentNode,h=e.createElement("span");if(f.replaceChild(h,s),i.roots[u]=s.id,!l.view)return Error("module requires a view");var d=o.submodule(l,[c||{}]),p=t=d=d||{},g=new d.controller;return p===t&&(o.controllers[u]=g,o.modules[u]=d,o.elements[u]=s),r.redraw(),f.replaceChild(s,h),g.onload&&!n.running&&i.callOnload(o),{_html:s.innerHTML}};var u=function(n){return function(){return r[n].apply(this,arguments)}},s=u("init");s.module=u("module"),s.prop=u("prop"),s.redraw=u("redraw"),s.withProp=u("withProp");for(var f in s)n[f]=s[f]}(window.mag||{},document);

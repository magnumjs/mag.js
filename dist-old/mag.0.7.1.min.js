/*
Mag.JS v0.7.1
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(n,e,t,r){function o(n){return"[object Array]"===Object.prototype.toString.call(n)}function i(n){if(""!==n.id)return'id("'+n.id+'")';if(n===t.body)return n.tagName;var e=0;if(n.parentNode)for(var r=n.parentNode.childNodes,o=0;o<r.length;o++){var l=r[o];if(l===n)return i(n.parentNode)+"/"+n.tagName+"["+(e+1)+"]";1===l.nodeType&&l.tagName===n.tagName&&e++}}function l(n,e,t){var r,u,f;if(n){null==e&&(e={_text:""});var s=c(n);if(f=o(e)){if(p[t]&&0===s.length&&(p[t].parent.insertAdjacentHTML("beforeend",p[t].node),s=c(p[t].parent.children)),0===s.length)return;for(u=s[0].parentNode,p[t]||(p[t]={node:s[0].cloneNode(!0).outerHTML,parent:u});s.length<e.length;)p[t]?(u.insertAdjacentHTML("beforeend",p[t].node),r=u.lastChild):r=s[0].cloneNode(!0),s.push(r),u&&u.appendChild(r);for(;s.length>e.length;)r=s.pop(),(u=r.parentNode)&&(t=i(r),u.removeChild(r),g[t+"-config"]&&g[t+"-config"].configContext&&"function"==typeof g[t+"-config"].configContext.onunload&&g[t+"-config"].configContext.onunload())}for(r=0;r<s.length;r++)t=i(s[r]),f?!s[r]||g[t]&&g[t]===JSON.stringify(e[r])||(l(s[r],e[r]),g[t]=JSON.stringify(e[r])):a(s[r],e);return n}}function a(n,e){var t;if("function"!=typeof e){if("object"!=typeof e)return a(n,{_text:e});for(var c in e){var f=e[c];f===r&&(f=""),"_"===c[0]&&(t=t||{},t[c.substr(1)]=f)}var s=i(n);t&&u(n,t);var d=0;for(c in e)if(f=e[c],"_"!==c[0]){if(t=h(n,c),"function"==typeof f&&"fun"==f.type)try{f=f()}catch(g){}o(f)&&(t=h(n,"$"+c)),l(t,f,s+"/"+c),d++}}}function c(n){var e;if(null==n.length&&(n=[n]),!o(n)){e=[];for(var t=0;t<n.length;t+=1)n[t]&&e.push(n[t]);n=e}return n}function u(t,r){var o=i(t),l=!1;g[o]&&g[o]===JSON.stringify(r)&&(l=!0),t._events=t._events||[];for(var a in r)if("text"!==a&&"html"!==a)if(0==a.indexOf("on")){if(-1===t._events.indexOf(a)||v){var c=function(e,t,r){try{return e.call(t,r)}finally{n.redraw()}}.bind(null,r[a],t);t[a]=c,t._events.push(a)}}else if("config"==a){c=!0,o=i(t),g[o+"-config"]?c=!c:g[o+"-config"]={};var u=g[o+"-config"].configContext=g[o+"-config"].configContext||{};e.push(function(n,e){return function(){return n.apply(n,e)}}(r[a],[t,c,u]))}else l||(null===r[a]?t.removeAttribute(a):t.setAttribute(a,""+r[a]));l||(f(t,r.text),s(t,r.html),g[o]=JSON.stringify(r))}function f(n,e){var t,r;if(t=i(n),n&&null!=e){if(!r){r=[];for(var o=0;o<n.childNodes.length;o+=1)t=n.childNodes[o],t.nodeType===d&&r.push(t)}for(;n.firstChild;)n.removeChild(n.firstChild);for("input"===n.nodeName.toLowerCase()?n.setAttribute("value",""+e):n.appendChild(n.ownerDocument.createTextNode(""+e)),o=0;o<r.length;o+=1)n.appendChild(r[o])}else if("[object Null]"===Object.prototype.toString.call(e)){for(;n.firstChild;)n.removeChild(n.firstChild);g[t+"-config"]&&g[t+"-config"].configContext&&"function"==typeof g[t+"-config"].configContext.onunload&&g[t+"-config"].configContext.onunload()}}function s(n,e){n&&null!=e&&(n.innerHTML=e)}function h(n,e,t){for(var r=n.childNodes,o=[],i=0;i<r.length;i+=1)r[i].nodeType===d&&o.push(r[i]);if(r=[],i=e,!(n.queryCache||{})[e]){n.queryCache=(n.queryCache||{})[e]=[];var l="$"===e[0];"$"===i[0]&&(i=i.substr(1));for(var a=0;a<o.length;a+=1){var c=o[a],u=i,f=" "+c.className+" ";(c.id===u||-1<f.indexOf(" "+u+" ")||c.name===u||c.nodeName.toLowerCase()===u.toLowerCase()||c.getAttribute("data-bind")===u)&&r.push(o[a])}if(!r.length||l)for(a=0;a<o.length&&(r=r.concat(h(o[a],e,!0)),!r.length||l);a++);!t&&!r.length,n.queryCache[e]=r}return n.queryCache[e]}var d=1,g=[],p={},g=[],v=!1;n.fill={fill:l,clear:function(){v=!0},unclear:function(){v=!1},configs:e},window.mag=n}(window.mag||{},[],document),function(n){function e(){b=null;for(var n=0;n<_.length;n++)_[n]();_.length=0}var t={noMore:!1,useDirtyCheck:!1},r=[],o=[],i=[],l=!1;try{l=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(a){}var c=function(n){var e={};return n&&"[object Function]"==e.toString.call(n)},u=function(n){return"[object Array]"===Object.prototype.toString.call(n)},f=function(n){return"[object Object]"==={}.toString.apply(n)},s=function(n){if(null==n||"object"!=typeof n)return n;var e,t=n.constructor();for(e in n)t[e]=n[e];return t},h=function(n,e,t,r){try{Object.observe(n,function(n){n.forEach(function(n){n.name===e&&r(n.object[n.name])})})}catch(o){try{Object.defineProperty(n,e,{get:t,set:function(n){r.call(this,n,!0)},enumerable:!0,configurable:!0})}catch(i){try{Object.prototype.__defineGetter__.call(n,e,t),Object.prototype.__defineSetter__.call(n,e,function(n){r.call(this,n,!0)})}catch(l){g(n,e,r)}}}},d=function(n,e,t){try{Object.defineProperty(n,e,{enumerable:!1,configurable:!0,writable:!1,value:t})}catch(r){n[e]=t}},g=function(n,e,t){o[o.length]={prop:e,object:n,orig:s(n[e]),callback:t}},p=function(n,e,t,r){if("string"!=typeof n&&(n instanceof Object||u(n))){if(u(n)){if(N(n,"__watchall__",e,t),void 0===t||t>0)for(var o=0;o<n.length;o++)p(n[o],e,t,r)}else{var i=[];for(o in n)"$val"==o||!l&&"watchers"===o||Object.prototype.hasOwnProperty.call(n,o)&&i.push(o);v(n,i,e,t,r)}r&&q(n,"$$watchlengthsubjectroot",e,t)}},v=function(n,e,t,r,o){if("string"!=typeof n&&(n instanceof Object||u(n)))for(var i=0;i<e.length;i++)w(n,e[i],t,r,o)},w=function(n,e,t,r,o){"string"!=typeof n&&(n instanceof Object||u(n))&&(c(n[e])||(null==n[e]||void 0!==r&&0>=r||p(n[e],t,void 0!==r?r-1:r),N(n,e,t,r),o&&(void 0===r||r>0)&&q(n,e,t,r)))},m=function(n,e){if(!(n instanceof String)&&(n instanceof Object||u(n)))if(u(n)){for(var t=["__watchall__"],r=0;r<n.length;r++)t.push(r);y(n,t,e)}else{var o=function(n){var t,r=[];for(t in n)n.hasOwnProperty(t)&&(n[t]instanceof Object?o(n[t]):r.push(t));y(n,r,e)};o(n)}},y=function(n,e,t){for(var r in e)e.hasOwnProperty(r)&&$(n,e[r],t)},_=[],b=null,j=function(n){null==b&&(b||(b=setTimeout(e))),_[_.length]=n},O=function(n,t,r,o){var i=null,l=-1,a=u(n);p(n,function(r,o,c,u){var f=(b||(b=setTimeout(e)),b);if(l!==f&&(l=f,i={type:"update"},i.value=n,i.splices=null,j(function(){t.call(this,i),i=null})),a&&n===this&&null!==i){if("pop"===o||"shift"===o)c=[],u=[u];else if("push"===o||"unshift"===o)c=[c],u=[];else if("splice"!==o)return;i.splices||(i.splices=[]),i.splices[i.splices.length]={index:r,deleteCount:u?u.length:0,addedCount:c?c.length:0,added:c,deleted:u}}},1==r?void 0:0,o)},C=function(n,e,t,r,o){n&&e&&(w(n,e,function(n,e,i,l){n={type:"update"},n.value=i,n.oldvalue=l,(r&&f(i)||u(i))&&O(i,t,r,o),t.call(this,n)},0),(r&&f(n[e])||u(n[e]))&&O(n[e],t,r,o))},N=function(n,e,r,o){var i=!1,l=u(n);for(n.watchers||(d(n,"watchers",{}),l&&T(n,function(t,r,i,l){if(k(n,t,r,i,l),0!==o&&i&&(f(i)||u(i))){var a,c;for(t=n.watchers[e],(a=n.watchers.__watchall__)&&(t=t?t.concat(a):a),c=t?t.length:0,a=0;c>a;a++)if("splice"!==r)p(i,t[a],void 0===o?o:o-1);else for(l=0;l<i.length;l++)p(i[l],t[a],void 0===o?o:o-1)}})),n.watchers[e]||(n.watchers[e]=[],l||(i=!0)),l=0;l<n.watchers[e].length;l++)if(n.watchers[e][l]===r)return;if(n.watchers[e].push(r),i){var a=n[e];r=function(){return a},i=function(r,i){var l=a;if(a=r,0!==o&&n[e]&&(f(n[e])||u(n[e]))&&!n[e].watchers){var c,s=n.watchers[e].length;for(c=0;s>c;c++)p(n[e],n.watchers[e][c],void 0===o?o:o-1)}return n.watchers&&(n.watchers.__wjs_suspend__||n.watchers["__wjs_suspend__"+e])?void L(n,e):void(t.noMore||l!==r&&(i?k(n,e,"set",r,l):x(n,e,"set",r,l),t.noMore=!1))},t.useDirtyCheck?g(n,e,i):h(n,e,r,i)}},x=function(n,e,t,r,o){if(void 0!==e){var i,l=n.watchers[e];(i=n.watchers.__watchall__)&&(l=l?l.concat(i):i),i=l?l.length:0;for(var a=0;i>a;a++)l[a].call(n,e,t,r,o)}else for(e in n)n.hasOwnProperty(e)&&x(n,e,t,r,o)},S="pop push reverse shift sort slice unshift splice".split(" "),A=function(n,e,t,r){d(n,t,function(){var o,i,l,a;if(o=0,"splice"===t){var c=arguments[0];for(l=n.slice(c,c+arguments[1]),i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];o=c}else i=0<arguments.length?arguments[0]:void 0;return a=e.apply(n,arguments),"slice"!==t&&("pop"===t?(l=a,o=n.length):"push"===t?o=n.length-1:"shift"===t?l=a:"unshift"!==t&&void 0===i&&(i=a),r.call(n,o,t,i,l)),a})},T=function(n,e){if(c(e)&&n&&!(n instanceof String)&&u(n))for(var t,r=S.length;r--;)t=S[r],A(n,n[t],t,e)},$=function(n,e,t){if(n.watchers[e])if(void 0===t)delete n.watchers[e];else for(var i=0;i<n.watchers[e].length;i++)n.watchers[e][i]==t&&n.watchers[e].splice(i,1);for(i=0;i<r.length;i++){var l=r[i];l.obj==n&&l.prop==e&&l.watcher==t&&r.splice(i,1)}for(t=0;t<o.length;t++)i=o[t],l=i.object.watchers,(i=i.object==n&&i.prop==e&&l&&(!l[e]||0==l[e].length))&&o.splice(t,1)},L=function(n,e){j(function(){delete n.watchers.__wjs_suspend__,delete n.watchers["__wjs_suspend__"+e]})},P=null,k=function(n,e,t,r,o){i[i.length]={obj:n,prop:e,mode:t,newval:r,oldval:o},null===P&&(P=setTimeout(J))},J=function(){var n=null;P=null;for(var e=0;e<i.length;e++)n=i[e],x(n.obj,n.prop,n.mode,n.newval,n.oldval);n&&(i=[])},q=function(n,e,t,o){var i;i=s("$$watchlengthsubjectroot"===e?n:n[e]),r.push({obj:n,prop:e,actual:i,watcher:t,level:o})};t.watch=function(){c(arguments[1])?p.apply(this,arguments):u(arguments[1])?v.apply(this,arguments):w.apply(this,arguments)},t.unwatch=function(){c(arguments[1])?m.apply(this,arguments):u(arguments[1])?y.apply(this,arguments):$.apply(this,arguments)},t.callWatchers=x,t.suspend=function(n,e){n.watchers&&(n.watchers["__wjs_suspend__"+(void 0!==e?e:"")]=!0)},t.onChange=function(){(c(arguments[2])?C:O).apply(this,arguments)},n.watch=t}(window.mag||{}),function(n){var e={modules:[],controllers:[],elements:[],submodule:function(n,e){var t=function(e){return(n.controller||function(){}).apply(this,e)}.bind({},e);return t.$original=n.controller,t={controller:t,view:function(t){1<arguments.length&&(e=e.concat([].slice.call(arguments,1)));var r=n.view.apply(n,e?[t].concat(e):[t]);return e[0]&&null!=e[0].key&&(r.attrs.key=e[0].key),r}},e[0]&&null!=e[0].key&&(t.attrs={key:e[0].key}),t},getArgs:function(n){return e.modules[n].controller&&e.modules[n].controller.$$args?[e.controllers[n]].concat(e.modules[n].controller.$$args):[e.controllers[n]]}};n.mod=e}(window.mag||{}),function(n){var e={roots:[],templates:{},cache:{},callOnload:function(n){for(var e,t=0;e=n.controllers[t];t++)e.onload&&!e.called&&(e.onload.call(null,n.elements[t]),e.called=1)},callConfigs:function(n){for(var e=0,t=n.length;t>e;e++)n[e]()}},t=[];e.redraw=function(n,t,r){n=n||e.module||{},this.fun||(this.fun=i(function(){t.configs.splice(0,t.configs.length),e.doLoop(n,t,r)})),this.fun()},e.doLoop=function(t,r,o){for(var i=0;e.roots[i];i++)n.running=!0,!t.controllers[i]||e.innerLoop(t,r,i,o);r.unclear()},e.clear=function(n,e,r){-1!==n&&t[n]&&r.clear()},e.innerLoop=function(n,r,o,i){var l=n.elements[o],a=n.getArgs(o);return t[o]&&t[o]===JSON.stringify(a[0])?n=!1:((n.getArgs(o),n.modules[o]).view(l,n.controllers[o]),t[o]=JSON.stringify(a[0]),e.setupWatch(i,a,r,l,o,n),r.fill(l,a[0]),e.callConfigs(r.configs),n=void e.callOnload(n)),n},e.doWatch=function(r,o,i,l){n.running=!0;var a=l.getArgs(i);t[i]&&t[i]===JSON.stringify(a[0])||((l.getArgs(i),l.modules[i]).view(o,l.controllers[i]),t[i]=JSON.stringify(a[0]),r.fill(o,a[0]),e.callConfigs(r.configs),n.running=!1)},e.setupWatch=function(n,t,r,o,l,a){n.watch(t[0],i(e.doWatch.bind(null,r,o,l,a)))};var r=window.cancelAnimationFrame||window.clearTimeout,o=window.requestAnimationFrame||window.setTimeout,i=function(n,e){var t,i,l=e||16;return function(){+new Date-t>l||o===window.requestAnimationFrame?(i>0&&r(i),i=o(function(){t=+new Date,n.apply(this,arguments)},l)):(t=+new Date,n.apply(this,arguments),i=o(function(){i=null},l))}};n.render=e}(window.mag||{}),function(n,e){var t={},r=n.mod,o=n.render,i=n.fill,l=n.watch;n.running=!1,t.init=function(){};var a=!1;t.redraw=function(){a||(a=!0,o.redraw(r||o.module||{},i,l),a=!1)},t.withProp=function(n,e){return function(t){t=t||event,t=t.currentTarget||this,e(n in t?t[n]:t.getAttribute(n))}},t.prop=function(n){var e=function(){return arguments.length&&(n=arguments[0],t.redraw()),n};return e.type="fun",e.toJSON=function(){return n},e};var c=[];t.module=function(l,a,u){var f=o.roots.indexOf(l);u&&!u.retain&&o.clear(f,l,i),0>f&&(f=o.roots.length);for(var s,h=!1,d={preventDefault:function(){h=!0}},g=0;s=c[g];g++)s.handler(d),s.controller.onunload=null;if(h)for(g=0;s=c[g];g++)s.controller.onunload=s.handler;else c=[];return h?void 0:(l=e.getElementById(l))?(o.roots[f]=l.id,a.view?(a=r.submodule(a,[u||{}]),u=new a.controller,r.controllers[f]=u,u.onunload&&c.push({controller:u,handler:u.onunload}),r.modules[f]=a,r.elements[f]=l,t.redraw(),u.onload&&!n.running&&o.callOnload(r),{_html:l.innerHTML}):Error("module requires a view")):Error("invalid node")};var u=function(n){return function(){return t[n].apply(this,arguments)}},f=u("init");f.module=u("module"),f.prop=u("prop"),f.redraw=u("redraw"),f.withProp=u("withProp");for(var s in f)n[s]=f[s]}(window.mag||{},document);

/*
Mag.JS v0.22.5
http://github.com/magnumjs/mag.js
(c) Michael Glazer
License: MIT
*/
!function(e,n,t){function i(e,t){if(f[e]&&!t)return f[e];var i=n.getElementById(e);return i&&(f[e]=i),i}var r={values:[],attributes:[],elementMatcher:[]};e.create=function(n,t,i){return function(r,o){return"string"!=typeof r&&(o=r,r=0),e.module(r||n,t,e.utils.merge(i||{},o||{}))}},e.module=function(n,t,r){r=r||{};var o;if(!(o=!e.utils.items.isItem(n))){o=e.utils.items.getItem(n);var a=i(n);o=!e.utils.callLCEvent("onreload",e.mod.getState(o),a,o)}return o&&(o=r.key&&e.utils.items.isItem(n+"."+r.key)?e.utils.items.getItem(n+"."+r.key):e.utils.getItemInstanceId(r.key?n+"."+r.key:n),r.retain||e.mod.clear(o),e.mod.submodule(n,o,t,r),a=i(n),s(o,n),!e.utils.callLCEvent("willload",e.mod.getState(o),a,o,1))?(n=e.mod.getState(o),e.utils.unloaders[o]=e.utils.unloaders[o]||[],n.onunload&&e.utils.unloaders[o].push({controller:n,handler:n.onunload}),e.redraw(a,o,1),e.utils.callLCEvent("didload",e.mod.getState(o),a,o,1),c(o,a,t,e.utils.copy(r))):void 0};var o=function(n,t){return 0>t||t!=e.utils.items.getItem(n)?n==e.mod.getId(t)?!0:!1:!0},a=[];e.begin=function(e){t===a[e]?a[e]=1:a[e]++},e.end=function(n){if(1<a[n])a[n]--;else{a[n]=0;var t=e.utils.items.getItemVal(n);e.redraw(i(t),n)}};var u=[];e.redraw=function(n,i,r){if(!a[i]){if(!n||t===i)throw Error("Mag.JS - Id or node invalid: "+e.utils.items.getItemVal(i));o(n.id,i)&&(r&&e.fill.configs.splice(0,e.fill.configs.length),r&&e.mod.clear(i),n=g(n,i,r),cancelAnimationFrame(u[i]),u[i]=requestAnimationFrame(n))}},e.hookin=function(e,n,t){r[e].push({context:{},handler:t,key:n})},e.hook=function(n,t,i){for(var o=0,a=r[n].length;a>o;o++)e.utils.callHook(r,t,n,o,i)};var l={},d=[],c=function(n,t,i,r){return i=function(n,t,i,r,o){return n=t.id+(r.key?"."+r.key:"")+"."+(o||0),o=l[n]||{},o.id=n,e.utils.items.isItem(n)||(l[n]=o=t.cloneNode(1),o.id=n),o instanceof HTMLElement?(n=e.utils.getItemInstanceId(o.id),e.mod.submodule(o.id,n,i,r),s(n,o.id),e.redraw(o,n,1),o):void 0}.bind({},n,t,i,r),i.getId=function(e){return e}.bind({},n),i.draw=function(n,t,i){e.redraw(n,t,i)}.bind({},t,n),i.getState=function(n){return e.mod.getState(n)}.bind({},n),i.getProps=function(n){return e.mod.getProps(n)}.bind({},n),i.subscribe=function(n,t){e.utils.onLCEvent("didupdate",n,function(i,r){var o=e.utils.merge(e.utils.copy(i),e.utils.copy(r));JSON.stringify(o)!==JSON.stringify(d[n])&&(d[n]=o,t(i,r,d[n]))})}.bind({},n),i},f=[],s=function(n,t){var r=function(n,t){i(t)?e.redraw(i(t),n):e.utils.items.isItem(t)&&e.clear(n)}.bind({},n,t);e.mod.setFrameId(n,r)};e.clear=function(n){cancelAnimationFrame(u[n]),e.mod.setFrameId(n,null),e.utils.items.removeItem(n),e.mod.clear(n),e.fill.clearCache(e.mod.getId(n))};var g=function(n,t,r){return function(n,t,r){if(i(n.id,1),o(n.id,t)&&n){var a=e.mod.getState(t);if(!e.utils.callLCEvent("isupdate",a,n,t)){var u=e.mod.getProps(t),u=e.utils.merge(e.utils.copy(u),e.utils.copy(a));if(e.mod.iscached(t,u)&&!r)return 0;if(r=!e.utils.callLCEvent("willupdate",a,n,t)){e.mod.callView(n,t),e.fill.setId(n.id),e.fill.run(n,a),r=n.id;var l,u=e.fill.configs;for(l in u)-1<l.indexOf('id("'+r+'")/')&&u[l]();l=n.id;for(var d in e.fill.cached)-1<d.indexOf('id("'+l+'")/')&&-1<d.indexOf("-config")&&e.fill.cached[d].configContext&&(e.utils.unloaders[t]=e.utils.unloaders[t]||[],e.utils.unloaders[t].push({controller:e.fill.cached[d].configContext,handler:e.fill.cached[d].configContext.onunload}));e.utils.callLCEvent("didupdate",a,n,t),r=n&&n.parentNode}r&&(n=m(n.parentNode))&&e.redraw(n,e.utils.items.getItem(n.id))}}}.bind({},n,t,r)},m=function(e){return e.id?e:e.parentNode?m(e.parentNode):t};e.getNode=i,window.mag=e}(window.mag||{},document),function(e){function n(n,t){var i=n.name;if("undefined"==n.object[n.name]&&!~e.fill.ignorekeys.indexOf(i.toString())){var r,o=e.fill.find(t,i),i="$"===i[0],a=[];return o.reverse().forEach(function(e,n){o[n]&&(o[n].value&&0<o[n].value.length?(r=o[n].value,!o[n].type||"checkbox"!=o[n].type&&"radio"!=o[n].type||(r={_value:r,_checked:o[n].checked},a.push(r))):o[n].innerText&&0<o[n].innerText.length?r=o[n].innerText:o[0].innerHTML&&0<o[n].innerHTML.length&&(r=o[n].innerHTML))}),0<a.length&&i?a:r}}function t(t,i,u){var l=document.getElementById(u);if("undefined"!=typeof Proxy){u=function(t,i,u){var d=JSON.stringify(u.object);if(d!==a[i]){if(a[i]=d,"get"==u.type&&"props"!=t)return n(u,l);"set"==u.type&&u.oldValue&&"function"==typeof u.oldValue.draw&&u.object[u.name]&&!u.object[u.name].draw&&(t=u.oldValue.getId(),e.utils.callLCEvent("onunload",e.mod.getState(t),e.getNode(e.mod.getId(t)),t),e.clear(t)),t=r.getFrameId(i),"function"==typeof t&&(cancelAnimationFrame(o[i]),o[i]=requestAnimationFrame(t))}};var d=r.getProps(i),d=e.proxy(d,u.bind({},"props",i));r.setProps(i,d),i=e.proxy({},u.bind({},"state",i)),t=new t(i)}else t=new t({});return t}var i=[],r={cache:[],getState:function(e){return i[e][1]},setState:function(e,n){i[e][1]=n},getView:function(e){return i[e][0]},getProps:function(e){return i[e][2]},setProps:function(e,n){return i[e][2]=n},remove:function(e){i.splice(e,1)},getId:function(e){return i[e]&&i[e][3]},exists:function(e){return void 0!==i[e]?!0:!1},setFrameId:function(e,n){i[e][4]=n},getFrameId:function(e){return i[e][4]},submodule:function(e,n,o,a){return i[n]?(r.setProps(n,a),i[n]):(i[n]=[0,0,0,0,0],r.setProps(n,a),a=function(e,n,t){o.view.call(o,n,r.getProps(e),t)}.bind({},n),i[n][0]=a,i[n][1]=t(function(e){return(o.controller||function(){}).call(e,r.getProps(n))||e},n,e),i[n][3]=e,i[n])}},o=[],a=[];r.iscached=function(e,n){return r.cache[e]&&r.cache[e]===JSON.stringify(n)?!0:void(r.cache[e]=JSON.stringify(n))},r.clear=function(e){e>-1&&r.cache[e]&&r.cache.splice(e,1)};var u=[];r.callView=function(n,t){var i=r.getView(t);u[t]||(e.props.attachToArgs(t,r.getState(t),n),u[t]=1),i(r.getState(t),n)},e.mod=r}(window.mag||{}),function(e){function n(e){for(var n in e)if(e[n]&&-1!==["INPUT","SELECT","TEXTAREA"].indexOf(e[n].tagName))return e[n];return!1}var t={},i=function(n,t){for(var i=1;i<n.length;i+=2){var r=n[i+1];t=e.fill.find(t,n[i]),t=t[r]}return t},r=function(t,r,o,a){return o=(""+o).split("."),3>o.length?(o=parseInt(o.pop()),o=isNaN(o)?0:o,r=e.fill.find(a[o]?a[o]:a,r)):(a=i(o,a),r=e.fill.find(a,r)),(r=n(r))&&!r.eventOnFocus&&(o=-1<["radio","checkbox"].indexOf(r.type),a=function(n,i){this.__magnum__=this.__magnum__||{},this.__magnum__.dirty||(this.__magnum__.dirty=1),i&&(t._checked=this.checked,e.redraw(n,e.utils.items.getItem(n.id),1))}.bind(r,a,o),o?r.addEventListener("click",a,!1):r.addEventListener("focus",a,!1),r.eventOnFocus=1),r},o=function(t,i,o,a){var u=o[i];"_value"===i&&(i=t.split(".").pop());var l=e.fill.find(a,i),l=n(l);if("function"!=typeof u&&l){var d=r.bind({},o,i,t,a);d(),Object.defineProperty(o,i,{configurable:!0,get:function(){var n=d();return n&&"undefined"!==n.value&&n.__magnum__&&n.__magnum__.dirty&&n.value!==u?(u=n.value,e.redraw(a,t,1),n.value):u},set:function(e){var n=d();n&&"undefined"!==n.value&&n.value!==e&&e!==u&&(n.value=e,u=e)}})}},a=function(e,n,t){for(var i in n){var r=n[i];"object"==typeof r?a(e+"."+i,r,t):o.bind({},e,i,n,t)()}};t.attachToArgs=a,e.props=t}(window.mag||{},window),function(e){var n={callHook:function(e,n,t,i,r,o){r.change=!1,e[t][i].key==n&&(o=JSON.stringify({v:r.value,k:r.key}),e[t][i].handler.call(e[t][i].context,r),o!==JSON.stringify({v:r.value,k:r.key})&&(r.change=!0))},unloaders:[]},t=[];n.onLCEvent=function(e,n,i){t[e+"-"+n]=i},n.callLCEvent=function(i,r,o,a,u){var l=!1,d={preventDefault:function(){l=!0}};if(r&&r[i]&&(r[i].call(r,d,o,e.mod.getProps(a)),u&&(r[i]=0)),t[i+"-"+a]&&t[i+"-"+a](e.mod.getState(a),e.mod.getProps(a)),l)for(r=0;i=n.unloaders[a][r];r++)i.controller.onunload&&(i.handler.call(i.controller,o),i.controller.onunload=0);return l},n.debounce=function(e,n){var t=null;return function(){var i=this,r=arguments;cancelAnimationFrame(t),t=requestAnimationFrame(function(){e.apply(i,r)},n)}},n.copy=function(e){return Object.assign({},e)},n.merge=function(e,n){return Object.assign(e,n)};var i={i:[],isItem:function(e){return-1<i.i.indexOf(e)},setItem:function(e){i.i[i.i.length]=e},getItem:function(e){return i.i.indexOf(e)},getItemVal:function(e){return i.i[e]},removeItem:function(e){i.i.splice(i.i.indexOf(e),1)}};n.items=i,n.getItemInstanceIdAll=function(){return i.i},n.getItemInstanceId=function(e){return i.isItem(e)?i.getItem(e):(i.setItem(e),i.getItem(e))},e.utils=n}(window.mag||{}),function(e,n,t,i){function r(e){return Array.isArray&&Array.isArray(e)||"[object Array]"==={}.toString.call(e)}function o(e,n){return e[C]=e[C]||{},(!e[C].uid||n)&&(e[C].uid=performance.now()),e[C].uid}function a(e,n){var t=o(e,n);if(S[t])t=S[t];else{var i,r=S,a="";i=l(e);var u=e.parentNode&&[].indexOf.call(e.parentNode.children,e);i&&(a+='id("'+i.id+'")'),i=a+("/"+e.tagName+"["+(u+1)+"]"),t=r[t]=i}return t}function u(e,n,t){return e=o(e,t),T[_.id]=T[_.id]||[],T[_.id][e]&&T[_.id][e]==n?1:(T[_.id][e]=n,i)}function l(e){return e.id?e:e.parentNode?l(e.parentNode):i}function d(e){if(""!==e.id)return'id("'+e.id+'")';if(e===t.body)return e.tagName;var n=0;if(e.parentNode)for(var i=e.parentNode.childNodes,r=0;r<i.length;r++){var o=i[r];if(o===e)return d(e.parentNode)+"/"+e.tagName+"["+(n+1)+"]";1===o.nodeType&&o.tagName===e.tagName&&n++}}function c(e){var n=d(e);e.parentNode.removeChild(e),k[n+"-config"]&&k[n+"-config"].configContext&&typeof k[n+"-config"].configContext.onunload===O&&k[n+"-config"].configContext.onunload(k[n+"-config"].configContext,e,n)}function f(e){return(e=e&&parseInt(e.split("[").pop().slice(0,-1)))?parseInt(e)-1:0}function s(e){return e&&e[C]&&e[C].isChildOfArray?e:e.parentNode?s(e.parentNode):i}function g(e,n,i){if(!u(e,n.outerHTML,i)&&!t.getElementById(n.id)){for(;e.lastChild;)e.removeChild(e.lastChild);e.appendChild(n)}}function m(n,t,o){var a,u=f(o);if(t&&t.nodeType==w)return g(n,t),i;if("function"==typeof t){var l=(a=s(n.parentNode))&&a.getAttribute("key");return a&&l&&(u=+l.split(C)[1]),(t=t(u))&&t.nodeType&&t.nodeType==w?(g(n,t),n[C]=n[C]||{},n[C].isChildOfArray=!0,n[C].dataPass={index:u},i):(l=/<[a-z][\s\S]*>/i.test(t)?"_html":"_text",u={},u[l]=t,m(n,u,o))}if("object"!=typeof t)return m(n,{_text:t},o);for(l in t)u=t[l],u===i?u="":null===u&&-1===["onunload"].indexOf(l)?(n[C].detached=n[C].detached||[],n[C].detached[l]=1,p(n,l)):n[C].detached&&n[C].detached[l]&&(v(n,l),n[C].detached[l]=0),"_"===l[0]&&(a=a||{},a[l.substr(1)]=u);a&&b(n,a,o);for(l in t)if(u=t[l],!~_.ignorekeys.indexOf(l)&&"_"!==l[0]){a=N(n,l);var d={key:l,value:u,node:n};e.hook("values","*",d),d.change&&(u=d.value),r(u)&&(a=N(n,"$"+l)),_.run(a,u,o+"/"+l)}}function v(e,n){N(e,n).forEach(function(e){var n=o(e);if(E[n]){for(var t in E[n])e.appendChild(E[n][t]);delete E[n]}})}function p(e,n){N(e,n).forEach(function(e){var n=o(e);for(e.children.length&&(E[n]=h(e.children));e.lastChild;)c(e.lastChild)})}function h(e){var n;if(null==e.length&&(e=[e]),!r(e)){n=[];for(var t=0;t<e.length;t+=1)e[t]&&n.push(e[t]);e=n}return e}function y(n,i,r){return function(n,i,r){var o=s(i),u=o&&d(o),l=f(u),c=a(i),g=f(c),o={path:u,data:((o||{})[C]||[]).dataPass,node:o,index:l},c=c&&-1<c.indexOf("id(")&&c.split('id("')[1].split('")')[0],u=t.getElementById(c);return n=n.call(i,r,g,i,o),e.redraw(u,e.utils.items.getItem(c),1),n}.bind({},i[r],n)}function b(t,i,r){var o,a=f(r);for(o in i)if("text"!==o&&"html"!==o)if(0==o.indexOf("on"))t[o.toLowerCase()]=y(t,i,o);else if("config"==o){r=d(t);var a=f(r),u=!0;k[r+"-config"]?u=!1:k[r+"-config"]={};var l=k[r+"-config"].configContext=k[r+"-config"].configContext||{};n[r]=function(e,n){return function(){return e.apply(e,n)}}(i[o],[t,u,l,a])}else r={key:o,value:i[o],node:t},e.hook("attributes",o,r),r.change&&(o=r.key,i[o]=r.value),null===i[o]?t.removeAttribute(o):(o in t&&(t[o]=i[o]),t.setAttribute(o,""+i[o]));I(t,i.text),x(t,i.html)}function I(e,n){var t,i;if(e&&null!=n&&!u(e,n)){if(!i){i=[];for(var r=0;r<e.childNodes.length;r+=1)t=e.childNodes[r],t.nodeType===w&&i.push(t)}for(;e.lastChild;)e.removeChild(e.lastChild);for("INPUT"===e.nodeName?e.value=""+n:e.appendChild(e.ownerDocument.createTextNode(""+n)),r=0;r<i.length;r+=1)e.appendChild(i[r]);"SELECT"===e.nodeName&&(e.value=""+n)}}function x(e,n){e&&null!=n&&!u(e,n)&&(e.innerHTML=n)}function N(n,t,i){var r=[];if(n){var o=n.childNodes;if(o)for(var a=0;a<o.length;a+=1)o[a].nodeType===w&&r.push(o[a])}var o=[],a=t,u="$"===t[0];"$"===a[0]&&(a=a.substr(1));for(var l=0;l<r.length;l+=1){var d=r[l],c=a,f=" "+d.className+" ";(d.id===c||-1<f.indexOf(" "+c+" ")||d.name===c||d.nodeName.toLowerCase()===c.toLowerCase()||d.getAttribute("data-bind")===c)&&o.push(r[l])}if(!o.length||u)for(l=0;l<r.length&&(o=o.concat(N(r[l],t,!0)),!o.length||u);l++);return i||o.length||(n={key:t,value:o,node:n},e.hook("elementMatcher",t,n),n.change&&(o=n.value)),o}var _={ignorekeys:"Symbol(Symbol.toStringTag) nodeType toJSON onunload onreload willupdate didupdate didload willload isupdate".split(" ")},w=1,k=[],C="__magnum__",O="function",S=[],T=[],A={};_.run=function(e,n,t){var o,u,l;if(e){null==n&&(n={_text:""});var d=h(e);if(l=r(n)){if(A[t]&&0===d.length&&(A[t].parent.insertAdjacentHTML("beforeend",A[t].node),d=h(A[t].parent.children)),0===d.length)return;for(u=d[0].parentNode,A[t]||(A[t]={node:d[0].cloneNode(!0).outerHTML,parent:u});d.length<n.length;)A[t]?(u.insertAdjacentHTML("beforeend",A[t].node),o=u.lastChild):o=d[0].cloneNode(!0),d.push(o),u&&u.appendChild(o);if(d.map(function(e){return e.__key}),t=n.map(function(e){return e._key}),(d.length==n.length||-1!==t.indexOf(i))&&(n=n.map(function(e,n){if("object"==typeof e){if(d[n].__key&&void 0===e._key)return e._key=d[n].__key,e;void 0===e._key&&(e._key=C+n),d[n].__key=e._key}return e})),d.length>n.length)if(0===n.length||"object"!=typeof n[0])for(;d.length>n.length;)o=d.pop(),(u=o.parentNode)&&c(o);else var f=[],s=n.map(function(e){return e._key}),d=(d.map(function(e){return e.__key}),d.filter(function(e){return-1===s.indexOf(e.__key)||-1!==f.indexOf(e.__key)?(f.push(e.__key),c(e),!1):(f.push(e.__key),!0)}))}for(t=0;t<d.length;t++)l?d[t]&&_.run(d[t],n[t]):(n&&"object"==typeof n&&-1!==Object.keys(n).indexOf("_key")&&(d[t][C]=d[t][C]||{},d[t][C].isChildOfArray=!0,d[t][C].dataPass=n),o=a(d[t]),m(d[t],n,o));return e}};var E=[];_.configs=n,_.find=N,_.setId=function(e){_.id=e},_.clearCache=function(e){T[e]&&delete T[e]},e.fill=_}(window.mag||{},[],document),function(e,n){function t(n,t){var i=[];return new Proxy(n,{get:function(e,n){var r=e[n],o=t({type:"get",object:{},name:n,oldValue:i[n]});return void 0!==o&&(r=o),r},deleteProperty:function(e,n){return t({type:"delete",name:n,object:e,oldValue:i[n]}),delete e[n]},set:function(n,r,o){return JSON.stringify(o)!==JSON.stringify(n[r])&&(i[r]=n[r]&&e.utils.copy(n[r])),t({type:"set",name:r,object:n,oldValue:i[r]}),n[r]=o,!0}})}function i(e,n){for(var i in e)Array.isArray(e[i])&&101>e[i].length&&(e[i]=t(e[i],n));return t(e,n)}e.proxy=function(t,r){return t&&n.Proxy?i(t,function(n){return"object"==typeof n.object[n.name]&&(n.object[n.name]=e.proxy(n.object[n.name],r)),r(n)}):void 0}}(window.mag||{},window);
